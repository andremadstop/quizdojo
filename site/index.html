<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' https: http://localhost:8000 http://127.0.0.1:8000; font-src 'self' data:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'">
<title>PrÃ¼fungstrainer v42.0</title>

<!-- CSS: Variables -->
<link rel="stylesheet" href="css/variables.css">

<!-- CSS: Base & Typography -->
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/typography.css">

<!-- CSS: Components & Layout -->
<link rel="stylesheet" href="css/components.css">
<link rel="stylesheet" href="css/layout.css">

<!-- CSS: Special UI -->
<link rel="stylesheet" href="css/gates.css">
<link rel="stylesheet" href="css/animations.css">
<link rel="stylesheet" href="css/notifications.css">
<link rel="stylesheet" href="css/modals.css">

<!-- CSS: Mode-specific styles -->
<link rel="stylesheet" href="css/modes/swipe.css">
<link rel="stylesheet" href="css/modes/exam.css">
<link rel="stylesheet" href="css/modes/leitner.css">
<link rel="stylesheet" href="css/modes/duel.css">
<link rel="stylesheet" href="css/modes/training.css">
</head>
<body class="gate-open auth-required">

<!-- Loading Spinner Overlay -->
<div id="loaderOverlay" class="loader-overlay hidden">
  <div class="loader"></div>
</div>

<!-- Toast Notifications Container -->
<div id="toastContainer" class="toast-container"></div>

<!-- Icon Sprite (Lucide Icons) -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <symbol id="icon-bomb" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="13" r="9"/><path d="M14.35 4.65 16.3 2.7a2.41 2.41 0 0 1 3.4 0l1.6 1.6a2.4 2.4 0 0 1 0 3.4l-1.95 1.95"/><path d="m22 2-1.5 1.5"/>
  </symbol>
  <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M20 6 9 17l-5-5"/>
  </symbol>
  <symbol id="icon-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
  </symbol>
  <symbol id="icon-zap" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>
  </symbol>
  <symbol id="icon-star" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
  </symbol>
  <symbol id="icon-timer" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/>
  </symbol>
  <symbol id="icon-trash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/>
  </symbol>
  <symbol id="icon-repeat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/>
  </symbol>
  <symbol id="icon-target" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>
  </symbol>
  <symbol id="icon-help-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/>
  </symbol>
  <symbol id="icon-info" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
  </symbol>
  <symbol id="icon-pause" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>
  </symbol>
</svg>

<div id="profileGate" class="gate active" aria-hidden="false">
  <div class="langmenu">
    <button class="btn langbtn" id="btnLangMenuGate" title="Sprache wechseln" data-i18n-title="aria.langMenu" data-i18n-aria="aria.langMenu">ğŸŒ <span id="langLabelGate">DE</span></button>
    <div class="langdrop" id="langMenuGate">
      <button data-lang="de">Deutsch</button>
      <button data-lang="en">English</button>
      <button data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
    </div>
  </div>

  <div class="gate-hero">
    <h1 class="gate-title">ğŸ‹ï¸ PrÃ¼fungstrainer</h1>
    <p class="gate-subtitle" data-i18n="gate.subtitle">Bitte einloggen oder Account anlegen.</p>
  </div>

  <div class="gate-box">
    <div id="gateLoginFields">
      <input type="text" id="gateLoginEmail" placeholder="Benutzername oder E-Mail" autocomplete="username email" />
      <input type="password" id="gateLoginPassword" placeholder="Passwort" autocomplete="current-password" />
      <button class="btn primary" id="btnGateLogin" style="width:100%" data-i18n="gate.login.btn">Login</button>
      <button class="linklike" id="btnGateForgotLink" style="margin-top:8px; font-size:13px" data-i18n="gate.forgot.link">Passwort vergessen?</button>
    </div>

    <div id="gateRegisterFields" class="hidden">
      <input type="text" id="gateRegisterUsername" placeholder="Benutzername" autocomplete="username" />
      <input type="text" id="gateRegisterEmail" placeholder="E-Mail" autocomplete="email" />
      <input type="password" id="gateRegisterPassword" placeholder="Passwort" autocomplete="new-password" />
      <input type="password" id="gateRegisterPassword2" placeholder="Passwort wiederholen" autocomplete="new-password" />
      <button class="btn primary" id="btnGateRegister" style="width:100%" data-i18n="gate.register.btn">Account anlegen</button>
    </div>

    <div id="gateForgotFields" class="hidden">
      <input type="text" id="gateForgotEmail" placeholder="E-Mail" autocomplete="email" />
      <button class="btn primary" id="btnGateForgotSend" style="width:100%" data-i18n="gate.forgot.btn">Reset-Link senden</button>
    </div>

    <div id="gateResetFields" class="hidden">
      <input type="password" id="gateResetPassword" placeholder="Neues Passwort" autocomplete="new-password" />
      <input type="password" id="gateResetPassword2" placeholder="Passwort wiederholen" autocomplete="new-password" />
      <button class="btn primary" id="btnGateReset" style="width:100%" data-i18n="gate.reset.btn">Passwort setzen</button>
    </div>

    <div class="gate-toggle">
      <button class="linklike" id="btnGateToggleMode" data-i18n="gate.register.link">Account anlegen</button>
    </div>
  </div>

  <div class="gate-footer">
    <div class="muted" style="font-size:12px; margin-bottom:8px" data-i18n="gate.disclaimer">Privates Projekt zu Schulungszwecken.</div>
    <div class="muted" style="font-size:11px">
      [Your Name] Â· <a href="mailto:contact@example.com" style="color:var(--muted)">contact@example.com</a>
    </div>
  </div>
</div>
<header>
  <div class="wrap headerbar">
    <h1 class="header-title">ğŸ‹ï¸ PrÃ¼fungstrainer v42.0</h1>
    <div class="controls">
      <div class="control-group">
        <div class="langmenu">
          <button class="btn langbtn" id="btnLangMenu" title="Sprache wechseln" data-i18n-title="aria.langMenu" data-i18n-aria="aria.langMenu">ğŸŒ <span id="langLabel">DE</span></button>
          <div class="langdrop" id="langMenu">
            <button data-lang="de">Deutsch</button>
            <button data-lang="en">English</button>
            <button data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
          </div>
        </div>
        <button id="btnTextSize" class="btn" title="TextgrÃ¶ÃŸe" data-i18n-title="aria.textSize" data-i18n-aria="aria.textSize">Aa <span id="textSizeLabel">M</span></button>
        <button id="btnMenusToggle" class="btn" title="MenÃ¼s ein/aus" data-i18n-title="nav.toggle" data-i18n-aria="nav.toggle">â˜°</button>
        <button id="btnTheme" class="btn" title="Hell/Dunkel umschalten" data-i18n-aria="theme.title">ğŸŒ—</button>
      </div>
      <div class="control-group">
        <button id="btnAccountTop" class="btn iconbtn" title="Account" data-i18n-aria="aria.accountOpen">ğŸ‘¤ <span class="badge-dot" id="accountBadge" hidden></span></button>
      </div>
    </div>
  </div>
</header>
<main class="wrap">
  <div class="tabbar">
    <div class="tabicons">
      <button class="btn tabbtn active" data-tab="train" title="Training">ğŸ¯ <span class="label">Training</span></button>
      <button class="btn tabbtn" data-tab="swipe" title="Swipe-Quiz">ğŸ‘† <span class="label" data-i18n="nav.swipe">Swipe</span></button>
      <button class="btn tabbtn" data-tab="exam" title="PrÃ¼fung">ğŸ“ <span class="label">PrÃ¼fung</span></button>
      <button class="btn tabbtn" data-tab="leitner" title="Lernkasten">ğŸ“š <span class="label" data-i18n="nav.leitner">Lernkasten</span></button>
      <button class="btn tabbtn" data-tab="community" title="Community">ğŸ† <span class="label" data-i18n="nav.community">Community</span> <span class="badge-count" id="communityBadge" hidden>0</span></button>
      <button class="btn tabbtn admin-only" data-tab="pool" title="Pool-Editor">ğŸ—‚ï¸ <span class="label" data-i18n="nav.pool">Fragenpoolâ€‘Editor</span></button>
      <button class="btn tabbtn" data-tab="about" title="Impressum">â„¹ï¸ <span class="label">Impressum</span></button>
      <button class="btn tabbtn" data-tab="hilfe" title="Hilfe">â“ <span class="label">Hilfe</span></button>
    </div>
  </div>
  <div id="defaultImportNotice" class="muted" style="margin:8px 0; display:none" data-i18n="data.defaultImport">
    Initiale DatensÃ¤tze werden geladenâ€¦
  </div>
  <!-- TRAINING -->
  <section id="tab-train" class="active">
    <div class="panel">
      <div class="row" style="justify-content:space-between; align-items:flex-start">
        <div class="grow">
          <div class="row" style="align-items:center; gap:8px; margin-bottom:6px">
            <h3 class="title" data-i18n="train.title">Training â€“ eine Frage nach der anderen</h3>
            <button class="btn iconbtn" id="btnTrainInfo" title="Hotkeys & Hinweise" data-i18n-aria="aria.infoTrain">?</button>
          </div>
          <select id="trainPoolSelect" aria-label="Aktiver Fragenpool"></select>
        </div>
        <div class="row" style="gap:8px; align-items:center">
          <button class="btn toggle hoverlabel" id="btnTrainShuffle" aria-pressed="false" title="Zufall"><span aria-hidden="true">ğŸ²</span> <span class="label" data-i18n="train.shuffle">Zufall</span></button>
          <button class="btn hoverlabel" id="btnTrainResetStats" title="Training-Statistik zurÃ¼cksetzen (nur aktueller Pool)"><span aria-hidden="true">âŸ²</span> <span class="label" data-i18n="train.reset">Training zurÃ¼cksetzen</span></button>
          <button class="btn hoverlabel" id="btnTrainWrongToggle" title="Nur Fragen zeigen, die du in den letzten 48h falsch beantwortet hast"><span aria-hidden="true">â—</span> <span class="label" data-i18n="train.wrongToggle">Nur falsche (48h)</span></button>
          <button class="btn hoverlabel" id="btnTrainLaterToggle" title="Nur Fragen zeigen, die du bewusst fÃ¼r spÃ¤ter markiert hast"><span aria-hidden="true">â­</span> <span class="label" data-i18n="train.laterToggle">FÃ¼r spÃ¤ter lernen</span></button>
        </div>
      </div>
      <div id="trainProgress" class="muted" style="margin:8px 0 10px"></div>
      <div class="bar"><span id="trainBar" style="width:0%"></span></div>
    </div>
    <div id="trainCard" class="panel">
      <div id="trainQuestionWrap"></div>
      <div class="hr"></div>
      <div id="trainExplain" class="muted" style="display:none; margin-bottom:8px;"></div>
      <div class="row" id="trainBottomBar" style="justify-content:space-between; gap:8px; align-items:center">
        <div class="row" style="gap:8px; align-items:center">
          <span id="trainCategory" class="pill" style="display:none"></span>
          <button class="btn" id="btnTrainExplain" style="display:none" data-i18n="train.explain">ErklÃ¤rung/LÃ¶sungshinweis</button>
          <button class="btn toggle hoverlabel" id="btnTrainLaterMark" aria-pressed="false" title="FÃ¼r spÃ¤ter merken">
            <span aria-hidden="true">â­</span>
            <span class="label" data-i18n="train.laterMark">FÃ¼r spÃ¤ter merken</span>
          </button>
        </div>
        <div class="row" style="gap:8px">
          <button class="btn" id="btnTrainPrev" data-i18n="train.prev">ZurÃ¼ck</button>
          <button class="btn" id="btnTrainCheck" data-i18n="train.check">Antwort prÃ¼fen</button>
          <button class="btn" id="btnTrainNext" data-i18n="train.next">Weiter</button>
        </div>
      </div>

    </div>
  </section>
  <!-- SWIPE -->
  <section id="tab-swipe">
    <div class="panel">
      <div class="row" style="justify-content:space-between; align-items:center">
        <h3 class="title" data-i18n="swipe.title">Swipe-Quiz â€” Wisch & Lern</h3>
        <select id="swipePoolSelect" aria-label="Swipe-Pool"></select>
      </div>
      <div id="swipeArena" class="swipe-arena">
        <div id="swipeCard" class="swipe-card">
          <div class="swipe-card-front">
            <div class="row" style="justify-content:flex-end; margin-bottom:12px">
              <div id="swipeLangToggle" class="q-lang-toggle"></div>
            </div>
            <div class="swipe-statement" id="swipeStatement"></div>
            <div class="swipe-category muted" id="swipeCategory"></div>
          </div>
          <div class="swipe-hint">
            <span class="swipe-hint-left" data-i18n="swipe.hintLeft">â† Falsch</span>
            <span class="swipe-hint-right" data-i18n="swipe.hintRight">Richtig â†’</span>
          </div>
        </div>
        <div id="swipeBack" class="swipe-card swipe-card-back hidden">
          <div id="swipeBackResult" class="swipe-back-result"></div>
          <div id="swipeBackExplanation" class="swipe-back-explanation"></div>
          <div class="swipe-back-actions">
            <button class="btn" id="btnSwipeLeitner" data-i18n="swipe.addLeitner">ğŸ“š In Lernkasten</button>
            <button class="btn primary" id="btnSwipeNext" data-i18n="swipe.next">Weiter â†’</button>
          </div>
        </div>
        <div id="swipeResult" class="swipe-card swipe-result-card hidden"></div>
      </div>
      <div class="swipe-controls" id="swipeControls">
        <button class="btn swipe-btn swipe-btn-false" id="btnSwipeFalse" data-i18n="swipe.false">âŒ Falsch</button>
        <button class="btn swipe-btn swipe-btn-true" id="btnSwipeTrue" data-i18n="swipe.true">âœ… Richtig</button>
      </div>
      <div class="swipe-progress">
        <span id="swipeProgress">0 / 0</span>
        <span id="swipeScore" class="swipe-score"></span>
      </div>
    </div>

    <!-- SPEEDRUN MODE -->
    <div class="panel" id="speedrunPanel">
      <h3 class="title" data-i18n="speedrun.title">âš¡ Speedrun</h3>
      <div class="muted" data-i18n="speedrun.subtitle">Maximale Punkte in minimaler Zeit</div>

      <!-- Setup -->
      <div id="speedrunSetup">
        <div class="field">
          <label data-i18n="speedrun.pool">Pool</label>
          <select id="speedrunPoolSelect"></select>
        </div>
        <div class="field">
          <label data-i18n="speedrun.duration">Dauer</label>
          <div class="row" style="gap:8px">
            <button class="btn" data-duration="1" style="flex:1; justify-content:center">1 Min âš¡</button>
            <button class="btn primary" data-duration="5" style="flex:1; justify-content:center">5 Min âš¡âš¡</button>
            <button class="btn" data-duration="10" style="flex:1; justify-content:center">10 Min âš¡âš¡âš¡</button>
          </div>
        </div>
        <button class="btn primary" id="btnSpeedrunStart" data-i18n="speedrun.start" style="margin-top:16px">Start</button>
      </div>

      <!-- Active Speedrun -->
      <div id="speedrunActive" class="hidden" style="position:relative; padding-top:40px">
        <button class="btn iconbtn" id="btnSpeedrunAbort" title="Abbrechen" style="position:absolute; top:8px; right:8px; z-index:1000">
          <svg class="icon" width="20" height="20"><use href="#icon-x"></use></svg>
        </button>
        <div style="margin-bottom:16px">
          <span class="pill" id="speedrunTimer"><svg class="icon icon--sm" width="16" height="16"><use href="#icon-timer"></use></svg> 00:00</span>
        </div>

        <!-- Swipe Card (reuse swipe card structure) -->
        <div class="swipe-arena" style="position:relative">
          <div id="speedrunCard" class="swipe-card">
            <div class="swipe-card-front">
              <div class="swipe-statement" id="speedrunStatement"></div>
              <div class="swipe-category muted" id="speedrunCategory"></div>
            </div>
            <div class="swipe-hint">
              <span class="swipe-hint-left">â† Falsch</span>
              <span class="swipe-hint-right">Richtig â†’</span>
            </div>
          </div>

          <!-- Back with brief feedback -->
          <div id="speedrunBack" class="swipe-card swipe-card-back hidden">
            <div id="speedrunBackResult" class="swipe-back-result"></div>
          </div>
        </div>

        <div class="swipe-controls">
          <button class="btn swipe-btn swipe-btn-false" id="btnSpeedrunFalse">âŒ Falsch</button>
          <button class="btn swipe-btn swipe-btn-true" id="btnSpeedrunTrue">âœ… Richtig</button>
        </div>
        <span class="pill" id="speedrunScore" style="position:absolute; bottom:12px; right:12px; z-index:100">âœ… 0  âŒ 0</span>
      </div>

      <!-- Result -->
      <div id="speedrunResult" class="hidden">
        <div class="swipe-result">
          <h3 data-i18n="speedrun.done">Zeit abgelaufen!</h3>
          <div id="speedrunResultScore" class="swipe-result-score"></div>
          <div id="speedrunResultStats"></div>
          <button class="btn primary" id="btnSpeedrunRestart" data-i18n="speedrun.restart">Nochmal</button>
        </div>
      </div>
    </div>
  </section>
  <!-- ACCOUNT -->
  <section id="tab-account">
    <div class="panel">
      <h3 class="title" data-i18n="account.title">Account</h3>
      <div class="account-header" style="gap:12px; align-items:center; flex-wrap:wrap">
        <span id="userBadge" class="pill">Nicht angemeldet</span>
        <div class="row" style="gap:10px; align-items:center; flex-wrap:wrap; margin-left:auto">
          <label class="sr-only" for="displayName" data-i18n="account.displayName">Anzeigename</label>
          <input type="text" id="displayName" placeholder="z. B. Andre" maxlength="32" style="min-width:220px; flex:1 1 240px" />
          <button class="btn" id="btnSaveLeaderboard" data-i18n="account.save">Speichern</button>
          <button id="btnLogoutAccount" class="btn" data-i18n="account.logout">Logout</button>
        </div>
      </div>
      <div class="account-fields" style="margin-top:12px">
        <div class="account-col">
          <label class="row" id="leaderboardOptInRow" style="gap:6px; align-items:center">
            <input type="checkbox" id="leaderboardOptIn" />
            <span data-i18n="account.leaderboardOptIn">In Ranglisten anzeigen</span>
          </label>
        </div>
      </div>
      <div class="hr"></div>
      <div class="muted" data-i18n="account.note">
        Hier kommen spÃ¤ter Funktionen wie Passwort Ã¤ndern, Account lÃ¶schen oder 2FA.
      </div>
    </div>
    <div class="panel" id="accountReviewPanel">
      <h3 class="title" data-i18n="review.title">Fehler & Merkliste</h3>
      <div class="row" style="align-items:center; gap:10px; flex-wrap:wrap">
        <label data-i18n="review.poolLabel">Pool</label>
        <select id="reviewPoolSelect" style="min-width:220px"></select>
        <button class="btn" id="btnReviewRefresh" data-i18n="review.refresh">Aktualisieren</button>
        <button class="btn" id="btnReviewResetHidden" data-i18n="review.resetHidden">Versteckte anzeigen</button>
        <button class="btn" id="btnReviewResetPool" data-i18n="review.resetPool">Pool-Statistik zurÃ¼cksetzen</button>
      </div>
      <div class="muted" style="margin-top:8px" data-i18n="review.hint">Hier siehst du deine falsch beantworteten Fragen (letzte 48h) und die â€FÃ¼r spÃ¤ter lernenâ€œâ€‘Merkliste.</div>
      <div class="hr"></div>
      <div class="qa-lists">
        <div class="qa-list" id="reviewWrongList">
          <div class="titleRow">
            <div data-i18n="review.wrongTitle">Falsch beantwortet (48h)</div>
            <div class="count" id="reviewWrongCount">0</div>
          </div>
          <div class="muted" id="reviewWrongEmpty" data-i18n="review.wrongEmpty">Keine falsch beantworteten Fragen.</div>
          <div id="reviewWrongItems"></div>
        </div>
        <div class="qa-list" id="reviewLaterList">
          <div class="titleRow">
            <div data-i18n="review.laterTitle">FÃ¼r spÃ¤ter lernen</div>
            <div class="count" id="reviewLaterCount">0</div>
          </div>
          <div class="muted" id="reviewLaterEmpty" data-i18n="review.laterEmpty">Keine Fragen markiert.</div>
          <div id="reviewLaterItems"></div>
        </div>
      </div>
    </div>
    <div class="panel">
      <h3 class="title" data-i18n="account.statsTitle">Statistik</h3>
      <div id="userStats" class="grid two"></div>
    </div>
  </section>
  <!-- COMMUNITY -->
  <section id="tab-community">
    <div class="panel" id="gamifyPanel">
      <h3 class="title" data-i18n="community.progressTitle">Mein Fortschritt</h3>
      <div class="row" style="align-items:center; gap:8px; flex-wrap:wrap">
        <span class="pill" data-i18n="gamify.xp">XP</span>
        <span id="xpValue" class="mono">â€“</span>
        <span class="pill" data-i18n="gamify.level">Level</span>
        <span id="levelValue" class="mono">â€“</span>
        <span class="pill" data-i18n="gamify.streakDaily">Daily</span>
        <span id="streakDailyValue" class="mono">â€“</span>
        <span class="pill" data-i18n="gamify.streakWeekly">Weekly</span>
        <span id="streakWeeklyValue" class="mono">â€“</span>
      </div>
      <div class="muted" data-i18n="gamify.streakHint">Daily: 10 Antworten Â· Weekly: 4 aktive Tage (lokale Zeitzone)</div>
      <div class="bar" style="margin-top:10px"><span id="levelProgress" style="width:0%"></span></div>
      <div class="muted" id="levelHint" data-i18n="gamify.levelHint">Level 0 Â· 0/10 XP</div>
      <div class="muted" data-i18n="gamify.lastAward">Letzte XPâ€‘Vergabe</div>
      <div id="lastAward" class="mono">â€“</div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnGamifyRefresh" data-i18n="gamify.refresh">Aktualisieren</button>
      </div>
    </div>
    <div class="panel" id="badgePanel">
      <h3 class="title" data-i18n="community.badgesTitle">Meine Badges</h3>
      <div id="badgeGrid" class="badge-grid">â€“</div>
    </div>
    <div class="panel" id="friendsPanel">
      <h3 class="title" data-i18n="community.friendsTitle">Freunde</h3>
      <div class="muted" data-i18n="community.friendsAuto">Alle Nutzer sind automatisch befreundet.</div>
      <div style="margin-top:10px">
        <div class="muted" data-i18n="community.friendsList">Meine Freunde</div>
        <div id="friendsList" class="list"></div>
      </div>
    </div>
    <div class="panel" id="duelPanel">
      <h3 class="title" data-i18n="community.duelsTitle">Duelle</h3>
      <div class="grid two">
        <div class="duel-panel">
          <div class="muted" data-i18n="community.duelsCreate">Neues Duell</div>
          <div class="field">
            <label data-i18n="community.duelsFriend">Freund</label>
            <select id="duelFriendSelect"></select>
          </div>
          <div class="field">
            <label data-i18n="community.duelsPool">Pool</label>
            <select id="duelPoolSelect"></select>
          </div>
          <div class="field">
            <label data-i18n="community.duelsCount">Fragen</label>
            <select id="duelCountSelect">
              <option value="3">3</option>
              <option value="5" selected>5</option>
              <option value="10">10</option>
            </select>
          </div>
          <div class="row" style="gap:8px; flex-wrap:wrap">
            <button class="btn primary" id="btnDuelCreate" data-i18n="community.duelsChallenge">Herausfordern</button>
            <button class="btn" id="btnDuelOpen" data-i18n="community.duelsQuick">Schnelles Duell</button>
          </div>
          <div class="muted" id="duelCreateHint" data-i18n="community.duelsHint">Schnelles Duell erstellt eine offene Herausforderung.</div>
        </div>
        <div class="duel-panel">
          <div class="muted" data-i18n="community.duelsIncoming">Offene Einladungen</div>
          <div id="duelIncomingList" class="list"></div>
          <div class="hr"></div>
          <div class="muted" data-i18n="community.duelsActive">Laufende Duelle</div>
          <div id="duelActiveList" class="list"></div>
          <div class="hr"></div>
          <div class="muted" data-i18n="community.duelsFinished">Letzte Ergebnisse</div>
          <div id="duelFinishedList" class="list"></div>
          <div class="row" style="margin-top:8px; justify-content:flex-end">
            <button class="btn" id="btnDuelReset" data-i18n="community.duelsReset">Duelle zurÃ¼cksetzen</button>
          </div>
        </div>
      </div>
      <div class="hr"></div>
      <div id="duelPlay" class="duel-play hidden">
        <div class="row" style="justify-content:space-between; gap:8px; align-items:center">
          <div>
            <span id="duelStatus" class="tag">â€“</span>
            <span id="duelProgress" class="pill">1 / 5</span>
            <span id="duelOpponent" class="pill">â€“</span>
          </div>
          <button class="btn" id="btnDuelExit" data-i18n="community.duelsExit">ZurÃ¼ck</button>
        </div>
        <div class="hr"></div>
        <div id="duelQuestionWrap"></div>
        <div class="hr"></div>
        <div class="row" style="justify-content:flex-end; gap:8px">
          <button class="btn primary" id="btnDuelAnswer" data-i18n="community.duelsAnswer">Antworten</button>
          <button class="btn" id="btnDuelNext" data-i18n="community.duelsNext">Weiter</button>
        </div>
      </div>
      <div id="duelResult" class="duel-play hidden"></div>
    </div>
    <div class="panel" id="leaderboardPanel">
      <h3 class="title" data-i18n="community.leaderboardsTitle">Leaderboards</h3>
      <div class="muted" data-i18n="leaderboard.note">Nur Nutzer mit Optâ€‘in werden angezeigt.</div>
      <div class="grid two">
        <div>
          <div class="muted" data-i18n="leaderboard.xp">XPâ€‘Rangliste</div>
          <ol id="leaderboardXp" class="leaderboard"></ol>
        </div>
        <div>
          <div class="muted" data-i18n="leaderboard.streak">Streakâ€‘Rangliste</div>
          <ol id="leaderboardStreak" class="leaderboard"></ol>
        </div>
        <div>
          <div class="muted" data-i18n="leaderboard.pool">Poolâ€‘Score (aktiver Pool)</div>
          <ol id="leaderboardPool" class="leaderboard"></ol>
        </div>
      </div>
    </div>
    <div class="panel" id="contestPanel">
      <h3 class="title" data-i18n="community.contestsTitle">Contests</h3>
      <div id="contestList" class="grid two"></div>
      <div class="hr"></div>
      <div class="muted" data-i18n="community.contestLeaderboardTitle">Contestâ€‘Rangliste</div>
      <ol id="contestLeaderboard" class="leaderboard"></ol>
    </div>

    <!-- Speedrun Stats Panel -->
    <div class="panel">
      <h3 class="title" data-i18n="speedrun.statsTitle">Meine Speedrun-Stats</h3>
      <div id="speedrunStatsWrap">â€“</div>
    </div>

    <!-- Speedrun Leaderboard -->
    <div class="panel">
      <h3 class="title" data-i18n="speedrun.leaderboardTitle">Speedrun Leaderboard</h3>
      <div class="row" style="gap:8px; margin-bottom:12px">
        <button class="btn btn-sm" data-lb-duration="1">1 Min</button>
        <button class="btn btn-sm primary" data-lb-duration="5">5 Min</button>
        <button class="btn btn-sm" data-lb-duration="10">10 Min</button>
      </div>
      <ol id="speedrunLeaderboard" class="leaderboard"></ol>
    </div>
  </section>
  <!-- EXAM -->
  <section id="tab-exam">
    <div class="panel">
      <div class="exam-header">
        <div class="exam-left">
          <div class="row" style="align-items:center; gap:8px; margin-bottom:6px">
            <h3 class="title" data-i18n="exam.title">PrÃ¼fung (Poolâ€‘basiert)</h3>
            <button class="btn iconbtn" id="btnExamInfo" title="Hinweise & Hotkeys" data-i18n-aria="aria.infoExam">?</button>
          </div>
          <label class="sr-only" data-i18n="label.activePool">Aktiver Fragenpool</label>
          <select id="examPoolSelect" aria-label="Aktiver Fragenpool"></select>
        </div>
        <div class="exam-right">
          <div class="field">
            <label data-i18n="exam.count">Anzahl Fragen</label>
            <input type="number" id="examCount" value="10" min="1" step="1" style="width:120px">
          </div>
          <div class="field">
            <label data-i18n="exam.time">Zeitlimit (Minuten, 0 = kein Limit)</label>
            <input type="number" id="examMinutes" value="30" min="0" step="1" style="width:150px">
          </div>
          <div class="field" style="justify-content:flex-end">
            <button class="btn primary" id="btnStartExam"><span aria-hidden="true">â–¶</span> <span data-i18n="exam.start">Start</span></button>
          </div>
        </div>
      </div>
    </div>
    <div id="examArea" class="panel hidden" style="position:relative; padding-top:40px">
      <div style="position:absolute; top:8px; right:8px; z-index:1000; display:flex; gap:4px">
        <button class="btn iconbtn" id="btnExamPause" title="Pausieren" style="display:none">
          <svg class="icon" width="20" height="20"><use href="#icon-pause"></use></svg>
        </button>
        <button class="btn iconbtn" id="btnExamAbort" title="Abbrechen">
          <svg class="icon" width="20" height="20"><use href="#icon-x"></use></svg>
        </button>
      </div>
      <div class="row" style="gap:8px; align-items:center; margin-bottom:12px">
        <span id="examTimer" class="pill">â³ kein Limit</span>
        <span id="examIndex" class="pill">â€“ / â€“</span>
        <span id="examAnswered" class="pill">Beantwortet: 0 / 0</span>
        <span id="examPool" class="pill">â€“</span>
      </div>
      <div class="hr"></div>
      <div id="examNav" class="navgrid"></div>
      <div class="hr"></div>
      <div id="examQuestionWrap"></div>
      <div class="hr"></div>
      <div class="row" style="justify-content:flex-end; gap:8px">
        <button class="btn" id="btnExamPrev" data-i18n="exam.prev">ZurÃ¼ck</button>
        <button class="btn" id="btnExamNext" data-i18n="exam.next">Weiter</button>
      </div>
    </div>
    <div id="examResult" class="panel hidden"></div>
    <div class="panel">
      <h3 class="title" data-i18n="account.examStats">PrÃ¼fungsstatistik</h3>
      <div id="examSessions" class="muted">â€“</div>
    </div>
  </section>
  <!-- LEITNER -->
  <section id="tab-leitner">
    <div class="panel row">
      <div class="grow">
        <div class="row" style="align-items:center; gap:8px; margin-bottom:6px">
          <h3 class="title" data-i18n="leitner.title">LernkÃ¤sten â€“ Sets pro Pool</h3>
          <button class="btn iconbtn" id="btnLeitnerInfo" title="Hinweise" data-i18n-aria="aria.infoLeitner">?</button>
        </div>
        <div class="muted" data-i18n="leitner.due">Boxen stehen fÃ¼r Lernstufen: Box1 = neu/schwierig, Box5 = sehr sicher.</div>
        <div class="row" style="gap:8px; flex-wrap:wrap; margin-top:8px">
          <div class="field" style="min-width:220px; flex:1 1 240px">
            <label data-i18n="leitner.setLabel">Lernkasten-Set</label>
            <select id="leitnerSetSelect"></select>
          </div>
          <div class="field" style="min-width:200px; flex:1 1 220px">
            <label data-i18n="leitner.setMode">Modus</label>
            <div id="leitnerSetModeLabel" class="pill">â€“</div>
          </div>
          <div class="row" style="gap:8px; align-items:center">
            <button class="btn warn" id="btnLeitnerSetDelete" data-i18n="leitner.setDelete">Lernkasten lÃ¶schen</button>
            <button class="btn warn" id="btnLeitnerReset" data-i18n="leitner.reset">Lernkasten zurÃ¼cksetzen</button>
          </div>
        </div>
        <div class="hr"></div>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <div class="field" style="min-width:180px; flex:1 1 200px">
            <label data-i18n="leitner.setName">Name</label>
            <input type="text" id="leitnerSetName" placeholder="z. B. Netzwerk-Grundlagen" />
          </div>
          <div class="field" style="min-width:220px; flex:1 1 240px">
            <label data-i18n="leitner.setPool">Pool</label>
            <select id="leitnerSetPool"></select>
          </div>
          <div class="field" style="min-width:180px; flex:1 1 200px">
            <label data-i18n="leitner.setModeSelect">Modus wÃ¤hlen</label>
            <select id="leitnerSetMode">
              <option value="simple" data-i18n="leitner.modeSimple">Simple</option>
              <option value="classic" data-i18n="leitner.modeClassic">Klassisch (fÃ¤llig)</option>
            </select>
          </div>
          <div class="row" style="align-items:center">
            <button class="btn primary" id="btnLeitnerSetCreate" data-i18n="leitner.setCreate">Lernkasten anlegen</button>
          </div>
        </div>
      </div>
      <div class="row" style="align-items:center; gap:10px; flex-wrap:wrap"></div>
    </div>
    <div id="leitnerStats" class="panel"></div>
    <div class="panel" id="leitnerSetCardsPanel">
      <h3 class="title" data-i18n="leitner.setsTitle">Lernkastenâ€‘Sets</h3>
      <div id="leitnerSetCards" class="leitner-set-grid"></div>
      <div id="leitnerSetCardsEmpty" class="muted" data-i18n="leitner.setsEmpty" style="display:none">Noch keine LernkÃ¤sten angelegt.</div>
    </div>
    <div id="leitnerSession" class="panel hidden">
      <div id="leitnerQuestionWrap"></div>
      <div class="hr"></div>
      <div class="row" style="justify-content:space-between; gap:8px; flex-wrap:wrap">
        <div class="row" style="gap:8px">
          <button class="btn primary" id="btnLeitnerNext" data-i18n="leitner.next">Weiter</button>
        </div>
        <div class="row" style="gap:8px">
          <button class="btn" id="btnLeitnerSkip" data-i18n="leitner.skip">Ãœberspringen</button>
        </div>
      </div>
    </div>
    <div id="leitnerInfoOverlay" class="info-overlay" aria-hidden="true">
      <div class="info-card">
        <div class="head">
          <div style="font-weight:700" data-i18n="leitner.infoTitle">Lernkasten â€“ so funktioniertâ€™s</div>
          <button class="btn" id="btnLeitnerInfoClose">âœ•</button>
        </div>
        <div class="muted" style="white-space:pre-line; margin-top:8px" data-i18n="leitner.info"></div>
      </div>
    </div>
  </section>
  <!-- FRAGENPOOLâ€‘EDITOR -->
  <section id="tab-pool" class="admin-only">
    <div class="panel">
      <h3 class="title" data-i18n="pool.title">Fragenpool verwalten</h3>
      <div class="row">
        <div style="min-width:220px">
          <label data-i18n="pool.select">Pool auswÃ¤hlen</label>
          <select id="poolSelect"></select>
        </div>
        <div style="min-width:240px">
          <label data-i18n="pool.name">Poolname</label>
          <input type="text" id="poolName" placeholder="z. B. ITâ€‘Grundschutz" />
        </div>
        <div class="row" style="align-self:flex-end">
          <button class="btn admin-only" id="btnPoolCreate" data-i18n="pool.create">Anlegen/Aktualisieren</button>
          <button class="btn warn admin-only" id="btnPoolDelete" data-i18n="pool.delete">Pool lÃ¶schen</button>
          <button class="btn" id="btnPoolExport" data-i18n="pool.export">Pool exportieren</button>
          <label class="btn admin-only" style="cursor:pointer"><span data-i18n="pool.import">Pool importieren</span>
            <input id="poolImportFile" type="file" accept="application/json" class="hidden"/>
          </label>
          <label class="btn admin-only" style="cursor:pointer"><span data-i18n="pool.importCsv">CSV importieren</span>
            <input id="poolImportCsvFile" type="file" accept="text/csv" class="hidden"/>
          </label>
          <button class="btn subtle" id="btnPoolAiPrompt" title="Lass dir von einer KI Fragenpools generieren. Klick hier, um den Prompt herunterzuladen." data-i18n-title="pool.aiPromptTip">
            âœ¨ <span data-i18n="pool.aiPrompt">AIâ€‘Pool erstellen</span>
          </button>
        </div>
      </div>
      <div class="muted" data-i18n="pool.desc">Jeder Pool hat eigene Fragen, Lernkastenâ€‘Boxen und Statistiken.</div>
    </div>
    <div class="panel">
      <h3 class="title" data-i18n="pool.edit">Frage bearbeiten/erstellen</h3>
      <div id="lockBanner" class="panel hidden admin-only" style="display:flex;align-items:center;justify-content:space-between;gap:10px;background:#0f1624;border:1px dashed #2a3a56">
        <div data-i18n="pool.lockedLogin">ğŸ”’ Editor ist gesperrt. Bitte einloggen, um zu bearbeiten.</div>
        <button id="unlockInline" class="btn hidden" data-i18n="pool.unlock">Editor entsperren</button>
      </div>
      <div id="editorBlock" class="disabledOverlay">
        <div class="grid">
          <div>
            <label data-i18n="pool.question">Fragetext</label>
            <textarea id="qText" placeholder="Deine Frage â€¦"></textarea>
          </div>
          <div class="grid two">
            <div>
              <label data-i18n="pool.category">Kategorie (optional)</label>
              <input type="text" id="qCat" placeholder="z. B. Grundlagen, Recht, Technik â€¦">
            </div>
            <div>
              <label data-i18n="pool.explain">ErklÃ¤rung/LÃ¶sungshinweis (optional)</label>
              <input type="text" id="qHint" placeholder="Kurzinfo, warum die LÃ¶sung korrekt ist â€¦">
            </div>
          </div>
          <div>
            <label data-i18n="pool.answers">Antwortoptionen</label>
            <div id="answers" class="answers"></div>
            <div class="row">
              <button class="btn admin-only" id="btnAddAnswer" data-i18n="pool.addAnswer">+ Antwort hinzufÃ¼gen</button>
              <span class="muted" data-i18n="pool.answerHint">Markiere <b>korrekt</b> per Checkbox. (Im Training/der PrÃ¼fung bleibt verborgen, ob Single/Multiple.)</span>
            </div>
          </div>
          <div class="row admin-only" style="justify-content:flex-end; gap:8px">
            <button class="btn" id="btnNew" data-i18n="pool.new">Neu</button>
            <button class="btn" id="btnSave" data-i18n="pool.save">Speichern</button>
            <button class="btn warn" id="btnDelete" data-i18n="pool.remove">LÃ¶schen</button>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <h3 class="title" data-i18n="pool.bulk.title">Stapelimport (unterhalb der Einzelbearbeitung)</h3>
      <div class="grid">
        <div>
          <label data-i18n="pool.bulk.paste">EinfÃ¼gen (Freitext)</label>
          <textarea id="bulkText" class="mono" placeholder="# Format
Frage
+ Richtige Antwort
Falsche Antwort
+ Noch eine richtige
---
NÃ¤chste Frage
â€¦"></textarea>
          <div class="muted">
            <b data-i18n="pool.bulk.auto">Auto-Erkennung korrekt:</b> <span data-i18n="pool.bulk.auto.desc">PrÃ¤fix</span>
            <kbd aria-label="Plus-Zeichen">+</kbd>, <kbd aria-label="Eckige Klammer mit x">[x]</kbd>, <kbd aria-label="Runde Klammer mit x">(x)</kbd> <span data-i18n="pool.bulk.auto.or">oder</span> <kbd aria-label="Haken">âœ”</kbd> <span data-i18n="pool.bulk.auto.ok">â†’ korrekt.</span>
            <span data-i18n="pool.bulk.sep">Trennung zwischen Fragen mit</span> <kbd aria-label="Drei Bindestriche">---</kbd>.
          </div>
        </div>
        <div class="grid two">
          <div>
            <label data-i18n="pool.bulk.cat">Kategorie (optional, fÃ¼r alle neuen)</label>
            <input type="text" id="bulkCat" placeholder="Kategorie fÃ¼r importierte Fragen">
          </div>
          <div class="row admin-only" style="align-items:end; gap:8px">
            <button class="btn" id="btnParseBulk" data-i18n="pool.bulk.preview">Vorschau erzeugen</button>
            <button class="btn primary" id="btnImportBulk" data-i18n="pool.bulk.import">In aktuellen Pool importieren</button>
          </div>
        </div>
        <div>
          <label data-i18n="pool.bulk.previewLabel">Vorschau</label>
          <div id="bulkPreview" class="panel mono" style="white-space:pre; max-height:240px; overflow:auto" data-i18n="pool.bulk.previewEmpty">Noch keine Vorschau.</div>
        </div>
      </div>
    </div>
    <div class="panel">
      <h3 class="title" data-i18n="pool.list">Vorhandene Fragen (aktiver Pool)</h3>
      <div class="row" style="gap:8px; align-items:center; margin-bottom:8px">
        <input id="poolListFilter" type="text" placeholder="Suche in Fragen..." style="max-width:320px" />
        <button class="btn" id="poolListClear">Reset</button>
      </div>
      <div id="listWrap" class="mono"></div>
    </div>
  </section>
  <!-- DATA -->
  <section id="tab-data">
    <div class="panel">
      <h3 class="title" data-i18n="data.title">Datenverwaltung</h3>
      <div class="grid two">
        <div class="panel" style="margin:0">
          <h4 style="margin:0 0 8px 0" data-i18n="data.exportTitle">Backup erstellen</h4>
          <div class="muted" data-i18n="data.backupDesc">Sichert alle Pools inkl. Stats & Lernkasten als JSON.</div>
          <div class="row" style="gap:8px; margin-top:10px">
            <button class="btn" id="btnExportAllPools" data-i18n="data.exportAll">Alle Pools exportieren</button>
            <a id="downloadLink" class="btn" download="trainer_export.json" href="#" data-i18n="data.download">Download</a>
          </div>
        </div>
        <div class="panel" style="margin:0">
          <h4 style="margin:0 0 8px 0" data-i18n="data.importTitle">Backup einspielen</h4>
          <div class="muted" data-i18n="data.importDesc">JSONâ€‘Datei auswÃ¤hlen und importieren.</div>
          <input type="file" id="fileImportAll" accept="application/json" style="margin-top:10px">
          <div class="row" style="margin-top:8px; gap:8px">
            <button class="btn" id="btnImportAll" data-i18n="data.importAll">Alle Pools importieren</button>
          </div>
          <div class="panel" style="margin:10px 0 0 0">
            <div style="font-weight:600" data-i18n="data.dangerTitle">Achtung</div>
            <div class="muted" data-i18n="data.dangerDesc">â€Alles lÃ¶schenâ€œ entfernt alle Pools & Statistiken unwiderruflich.</div>
            <div class="row" style="margin-top:8px; gap:8px">
              <button class="btn warn" id="btnWipeAll" data-i18n="data.wipeAll">Alles lÃ¶schen</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <h3 class="title" data-i18n="data.server">Serverâ€‘DatensÃ¤tze</h3>
      <div id="datasetList" class="grid"></div>
      <div class="muted" data-i18n="data.serverHint">Importiert DatensÃ¤tze direkt vom Server.</div>
      <div class="muted" style="margin-top:6px" data-i18n="data.serverHintAudit">Vor dem Import lÃ¤uft automatisch ein PrÃ¼fbericht (strict). Bei Fehlern wird der Import abgebrochen.</div>
    </div>
    <div class="panel">
      <h3 class="title">Serverâ€‘Speicherung</h3>
      <div class="muted">Pools, Fragen, Lernkasten und Statistiken liegen auf dem Server. Lokal werden nur Theme, Sprache und Profil gespeichert.</div>
    </div>
  </section>
  <!-- ABOUT & ADMIN -->
  <section id="tab-about">
    <div class="panel">
      <h3 class="title" data-i18n="impressum.title">Impressum</h3>
      <div class="panel" style="margin:0">
        <h4 style="margin:0 0 8px 0" data-i18n="impressum.subtitle">Angaben gemÃ¤ÃŸ Â§ 5 TMG</h4>
        <div class="muted" data-i18n="impressum.body">
          [Your Name]<br>
          [Your Address]<br>
          [Your City, Postal Code]<br>
          Eâ€‘Mail: <a href="mailto:contact@example.com">contact@example.com</a>
        </div>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="impressum.privacyTitle">Datenschutzhinweis (DSGVO)</h4>
        <ul class="muted" style="margin:0 0 12px 0; padding-left:18px">
          <li data-i18n="impressum.privacy.li1">Personenbezogene Daten: Benutzername, Eâ€‘Mailâ€‘Adresse (bei Registrierung) und Lernfortschritt werden serverseitig gespeichert.</li>
          <li data-i18n="impressum.privacy.li2">Zweck: Bereitstellung der Lernplattform, Speicherung des Lernfortschritts, Accountâ€‘Verwaltung.</li>
          <li data-i18n="impressum.privacy.li3">Rechtsgrundlage: Einwilligung (Art. 6 Abs. 1 lit. a DSGVO) durch Registrierung.</li>
          <li data-i18n="impressum.privacy.li4">Speicherdauer: Daten werden gespeichert, solange dein Account besteht. LÃ¶schung auf Anfrage per Eâ€‘Mail.</li>
          <li data-i18n="impressum.privacy.li5">Keine Weitergabe an Dritte. Keine Trackingâ€‘Cookies, keine Analyseâ€‘Tools.</li>
          <li data-i18n="impressum.privacy.li6">Deine Rechte: Auskunft, Berichtigung, LÃ¶schung, EinschrÃ¤nkung, DatenÃ¼bertragbarkeit und Widerspruch. Kontakt: <a href="mailto:contact@example.com">contact@example.com</a></li>
          <li data-i18n="impressum.privacy.li7">Hosting: Server in Deutschland.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="impressum.infoTitle">Info & Lizenz (GPLâ€‘3.0)</h4>
        <ul class="muted" style="margin:0 0 12px 0; padding-left:18px">
          <li data-i18n="impressum.info.li1">Singleâ€‘Pageâ€‘App mit Serverâ€‘API, 6 Modi: Training, PrÃ¼fung, Swipe, Lernkasten, Duelle, Community.</li>
          <li data-i18n="impressum.info.li2">Pools, Lernkastenâ€‘Status und Statistiken liegen serverseitig pro Account.</li>
          <li data-i18n="impressum.info.li3">Import/Export als JSON. KIâ€‘gestÃ¼tzte Poolâ€‘Erstellung mÃ¶glich.</li>
          <li data-i18n="impressum.info.li4">3 Sprachen (DE/EN/RU) â€” UI und Fragen einzeln umschaltbar.</li>
          <li data-i18n="impressum.info.li5">Bilder in Fragen werden unterstÃ¼tzt.</li>
          <li data-i18n="impressum.licenseNote">Lizenz: GPLâ€‘3.0.</li>
        </ul>
        <p style="font-size:1.15em; font-style:italic; margin:16px 0 8px 0; line-height:1.5; color:var(--text)" data-i18n="impressum.quote">Der bloÃŸe Besitz von Wissen ist nicht genug; wichtig ist die FÃ¤higkeit, Wissen anzuwenden.</p>
        <p class="muted" style="margin:0 0 12px 0; font-size:13px" data-i18n="impressum.vibeNote">Auch ohne Webdesign-Diplom kann man heute Erstaunliches bauen â€” ich bin der Beweis. Wenn was klemmt: erst selbst denken, dann den zweiten Kopf dazuholen. Feedback, das persÃ¶nlich oder konstruktiv ist, landet direkt im Danke-Ordner.</p>
      </div>
    </div>
  </section>
  <!-- HELP -->
  <section id="tab-hilfe">
    <div class="panel">
      <h3 class="title" data-i18n="help.title">Hilfe & Anleitung</h3>
      <div class="panel" style="margin:0">
        <h4 style="margin:0 0 8px 0" data-i18n="help.overview.title">KurzÃ¼bersicht</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.overview.li1">Training = freies Ãœben, Swipe = Wischâ€‘Quiz (Richtig/Falsch), Speedrun = Zeitrennen (1/5/10 Min), PrÃ¼fung = simulierte Tests, Lernkasten = Karteikarten.</li>
          <li data-i18n="help.overview.li2">Alle LernstÃ¤nde (Statistik, Lernkasten, Falsch/SpÃ¤ter) sind pro Account gespeichert.</li>
          <li data-i18n="help.overview.li3">Fragenpools sind die Grundlage fÃ¼r alle Modi. Jede Frage kann per Sprachâ€‘Toggle (DE/EN/RU) einzeln umgeschaltet werden.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.hotkeys.title">Hotkeys</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.hotkeys.train">Training: â†/â†’ oder N/P blÃ¤ttern Â· 1â€“9/0 toggeln Â· C prÃ¼fen Â· Enter weiter</li>
          <li data-i18n="help.hotkeys.exam">PrÃ¼fung: â†/â†’ oder N/P blÃ¤ttern Â· 1â€“9/0 toggeln Â· Enter weiter</li>
          <li data-i18n="help.hotkeys.swipe">Swipe & Speedrun: â†’ oder R = Richtig Â· â† oder L = Falsch Â· Leertaste = Weiter</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.training.title">Training</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.training.li1">Eine Frage pro Ansicht, Antworten kÃ¶nnen gemischt werden.</li>
          <li data-i18n="help.training.li2">â€Antwort prÃ¼fenâ€œ zeigt richtig/falsch und (falls vorhanden) eine ErklÃ¤rung.</li>
          <li data-i18n="help.training.li3">â€Nur falsche (48h)â€œ und â€FÃ¼r spÃ¤ter lernenâ€œ filtern die Fragenliste.</li>
          <li data-i18n="help.training.li4">Mit â­ kannst du Fragen fÃ¼r spÃ¤ter markieren.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.exam.title">PrÃ¼fung</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.exam.li1">Lege Anzahl Fragen und Zeitlimit fest, dann â€Start".</li>
          <li data-i18n="help.exam.li2">Navigator zeigt alle Fragen, beantwortete werden markiert.</li>
          <li data-i18n="help.exam.li3">Die PrÃ¼fung wird automatisch abgegeben, sobald alle Fragen beantwortet sind.</li>
          <li data-i18n="help.exam.li4">Bei aktivem Timer lÃ¤uft eine orange ZÃ¼ndschnur um die PrÃ¼fung â€” wenn du alle Fragen vor Ablauf beantwortest, entschÃ¤rfst du die Bombe! ğŸ’£</li>
          <li data-i18n="help.exam.li5">In der PrÃ¼fungsstatistik (Account-Tab) kannst du alte PrÃ¼fungen wiederholen oder lÃ¶schen.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.swipe.title">Swipeâ€‘Modus</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.swipe.li1">Wischâ€‘Quiz im Tinderâ€‘Stil: Aussage lesen, nach rechts wischen (Richtig) oder links (Falsch).</li>
          <li data-i18n="help.swipe.li2">Nach dem Wischen dreht sich die Karte um und zeigt die ErklÃ¤rung. Du bestimmst das Tempo â€” klicke â€Weiter" wenn du fertig bist.</li>
          <li data-i18n="help.swipe.li3">Auf der KartenrÃ¼ckseite kannst du die Frage direkt in deinen Lernkasten legen.</li>
          <li data-i18n="help.swipe.li4">Tastatur: â†’/R = Richtig, â†/L = Falsch, Leertaste = Weiter. Touch: Wischen oder Buttons.</li>
          <li data-i18n="help.swipe.li5">Swipeâ€‘Pools werden durch den Prefix â€Swipe:" im Poolnamen erkannt.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.speedrun.title">Speedrunâ€‘Modus</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.speedrun.li1">Zeitrennen im Swipe-Tab: WÃ¤hle 1, 5 oder 10 Minuten und sammle so viele richtige Antworten wie mÃ¶glich.</li>
          <li data-i18n="help.speedrun.li2">Keine ErklÃ¤rungen â€” nur schnelles Feedback (âœ…/âŒ), dann direkt zur nÃ¤chsten Frage.</li>
          <li data-i18n="help.speedrun.li3">Eine orange ZÃ¼ndschnur lÃ¤uft um das Panel und zeigt die verbleibende Zeit. Bei 0:00 endet das Rennen automatisch.</li>
          <li data-i18n="help.speedrun.li4">Wenn du alle Fragen vor Ablauf beantwortest, entschÃ¤rfst du die Speedrun-Bombe! ğŸ’£</li>
          <li data-i18n="help.speedrun.li5">Deine Bestleistungen und Stats findest du im Community-Tab, ebenso das Leaderboard fÃ¼r jede Dauer.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.leitner.title">Lernkastenâ€‘System</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.leitner.li1">Klicke eine Box an, um genau diese Fragen zu lernen.</li>
          <li data-i18n="help.leitner.li2">Richtig â†’ eine Box weiter, falsch â†’ eine Box zurÃ¼ck.</li>
          <li data-i18n="help.leitner.li3">â€Ãœberspringen" lÃ¤sst die Frage in der aktuellen Box.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.community.title">Community</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.community.li1">Im Communityâ€‘Tab findest du Fortschritt, Badges und Ranglisten.</li>
          <li data-i18n="help.community.li2">Freunde: Suche nach Username/Anzeigename und sende Anfragen.</li>
          <li data-i18n="help.community.li3">Duelle: Freund auswÃ¤hlen oder â€Schnelles Duellâ€œ starten, Einladungen annehmen.</li>
          <li data-i18n="help.community.li4">Ergebnisse zeigen korrekte Antworten + Zeit; XP werden automatisch vergeben.</li>
          <li data-i18n="help.community.li5">Ranglisten zeigen nur Nutzer mit Optâ€‘in (Accountâ€‘Bereich).</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.review.title">Fehler & Merkliste</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.review.li1">Im Accountâ€‘Bereich findest du â€Falsch beantwortet (48h)â€œ und â€FÃ¼r spÃ¤ter lernenâ€œ.</li>
          <li data-i18n="help.review.li2">Listen sind pro Pool und kÃ¶nnen dort bereinigt werden.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.pools.title">Fragenpools & Editor</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.pools.li1">Training/PrÃ¼fung/Lernkasten arbeiten mit dem aktuell ausgewÃ¤hlten Pool.</li>
          <li data-i18n="help.pools.li2">Im Editor kannst du Fragen anlegen, Ã¤ndern und lÃ¶schen.</li>
          <li data-i18n="help.pools.li3">â€Stapelimportâ€œ erlaubt viele Fragen im Textformat zu importieren.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.import.title">Import/Export</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.import.li1">â€Pool exportierenâ€œ bzw. â€Alle Pools exportierenâ€œ fÃ¼r Backups.</li>
          <li data-i18n="help.import.li2">Serverâ€‘DatensÃ¤tze kÃ¶nnen direkt importiert werden.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.lang.title">Sprache</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.lang.li1">Die UIâ€‘Sprache (Icon oben rechts) Ã¤ndert nur die OberflÃ¤che.</li>
          <li data-i18n="help.lang.li2">Jede Frage hat einen Sprachâ€‘Toggle (DE/EN/RU Buttons), mit dem du die Ãœbersetzung direkt an der Frage umschalten kannst.</li>
          <li data-i18n="help.lang.li3">Pools enthalten alle Sprachvarianten â€” kein Poolâ€‘Wechsel nÃ¶tig.</li>
        </ul>
        <div class="hr"></div>
        <h4 style="margin:0 0 8px 0" data-i18n="help.admin.title">Editorâ€‘Rechte</h4>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li data-i18n="help.admin.li1">Zum Bearbeiten, Importieren oder LÃ¶schen musst du eingeloggt sein.</li>
        </ul>
      </div>
    </div>
  </section>
</main>
<footer data-i18n="footer.credits">
  PrÃ¼fungstrainer v42.0 â€¢ MIT â€¢ APIâ€‘basiert â€¢ Made with â¤ï¸ â€¢ Credits: Andre Stiebitz
</footer>
<div id="appModal" class="modal-backdrop hidden" aria-hidden="true" role="alertdialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalText">
  <div class="modal" role="document" tabindex="-1">
    <div class="title" id="modalTitle" data-i18n="modal.title">Hinweis</div>
    <div id="modalText" class="muted"></div>
    <div class="row" style="justify-content:flex-end; margin-top:12px">
      <button class="btn primary" id="modalOk" data-i18n="modal.ok">OK</button>
    </div>
  </div>
</div>
<script src="qa_lists.js"></script>
<script>
/** ----------------------------
 *  State / Helpers
 *  ---------------------------- */
const PROFILE_DEFAULT = 'default';
const PROFILE_KEY = 'trainer.profile.current';
const THEME_KEY = 'trainer.theme';
const TEXT_SCALE_KEY = 'trainer.text.scale';
const MENU_KEY = 'trainer.menus.hidden';
const LANG_KEY = (id) => `trainer.lang.${id}`; // UI language
const POOL_LANG_KEY = (id) => `trainer.pool.lang.${id}`;
const TAB_KEY = (id) => `trainer.tab.${id}`;
const LEITNER_SET_KEY = (id) => `trainer.leitner.set.${id}`;
const REFRESH_KEY = 'trainer.refreshToken';
const API_BASE = (() => {
  if (window.API_BASE) return window.API_BASE;
  const stored = localStorage.getItem('API_BASE');
  if (stored) return stored;
  const local = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
  return local ? 'http://localhost:8000' : (location.origin + '/api');
})();
const RESET_TOKEN = (() => {
  const url = new URL(window.location.href);
  return url.searchParams.get('reset');
})();
let accessToken = null;
const _tokenStore = localStorage;
let currentUser = null;
let isAdmin = false;
let CURRENT_LANG = 'de';
let POOL_LANG = 'de';
let GATE_MODE = 'login';
let LOGIN_AT = null;
const SESSION_START = Date.now();
const ENABLE_GAMIFY = true;
const ENABLE_LEADERBOARDS = true;
function showModal(message){
  const modal = $('#appModal');
  const text = $('#modalText');
  if(!modal || !text){ return; }
  window._lastFocus = document.activeElement;
  text.textContent = String(message || '');
  modal.classList.remove('hidden');
  modal.setAttribute('aria-hidden','false');
  modal.removeAttribute('inert');
  if(window._modalKeyHandler){ modal.removeEventListener('keydown', window._modalKeyHandler); }
  window._modalKeyHandler = (event)=>{
    if(event.key === 'Escape'){
      event.preventDefault();
      hideModal();
      return;
    }
    if(event.key !== 'Tab'){ return; }
    const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if(!focusable.length){ return; }
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if(event.shiftKey && document.activeElement === first){
      event.preventDefault();
      last.focus();
    }else if(!event.shiftKey && document.activeElement === last){
      event.preventDefault();
      first.focus();
    }
  };
  modal.addEventListener('keydown', window._modalKeyHandler);
  const ok = $('#modalOk');
  if(ok){ ok.focus(); }
}
function hideModal(){
  const modal = $('#appModal');
  if(!modal){ return; }
  const active = document.activeElement;
  if(active && modal.contains(active)){ active.blur(); }
  modal.classList.add('hidden');
  modal.setAttribute('aria-hidden','true');
  modal.setAttribute('inert','');
  if(window._modalKeyHandler){
    modal.removeEventListener('keydown', window._modalKeyHandler);
    window._modalKeyHandler = null;
  }
  if(window._lastFocus && typeof window._lastFocus.focus === 'function'){
    window._lastFocus.focus();
    window._lastFocus = null;
  }
}
window.alert = showModal;
function showConfirm(message, confirmText = 'OK', cancelText = 'Abbrechen'){
  return new Promise((resolve) => {
    const modal = $('#appModal');
    const text = $('#modalText');
    const title = $('#modalTitle');
    if(!modal || !text || !title){ resolve(false); return; }

    window._lastFocus = document.activeElement;
    title.textContent = 'BestÃ¤tigung';
    text.textContent = String(message || '');
    modal.classList.remove('hidden');
    modal.setAttribute('aria-hidden','false');
    modal.removeAttribute('inert');

    // Replace buttons with confirm/cancel
    const buttonRow = modal.querySelector('.row');
    if(!buttonRow){ resolve(false); return; }

    buttonRow.innerHTML = `
      <button class="btn" id="modalCancel">${cancelText}</button>
      <button class="btn warn" id="modalConfirm">${confirmText}</button>
    `;

    const btnConfirm = $('#modalConfirm');
    const btnCancel = $('#modalCancel');

    const cleanup = () => {
      if(window._modalKeyHandler){
        modal.removeEventListener('keydown', window._modalKeyHandler);
        window._modalKeyHandler = null;
      }
    };

    const handleConfirm = () => {
      cleanup();
      hideModal();
      // Restore original OK button
      buttonRow.innerHTML = '<button class="btn primary" id="modalOk" data-i18n="modal.ok">OK</button>';
      $('#modalOk')?.addEventListener('click', hideModal);
      resolve(true);
    };

    const handleCancel = () => {
      cleanup();
      hideModal();
      // Restore original OK button
      buttonRow.innerHTML = '<button class="btn primary" id="modalOk" data-i18n="modal.ok">OK</button>';
      $('#modalOk')?.addEventListener('click', hideModal);
      resolve(false);
    };

    btnConfirm?.addEventListener('click', handleConfirm);
    btnCancel?.addEventListener('click', handleCancel);

    // Keyboard handler
    window._modalKeyHandler = (event) => {
      if(event.key === 'Escape'){
        event.preventDefault();
        handleCancel();
        return;
      }
      if(event.key === 'Enter'){
        event.preventDefault();
        handleConfirm();
        return;
      }
      if(event.key !== 'Tab'){ return; }
      const focusable = modal.querySelectorAll('button');
      if(!focusable.length){ return; }
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      if(event.shiftKey){
        if(document.activeElement === first){
          event.preventDefault();
          last.focus();
        }
      }else{
        if(document.activeElement === last){
          event.preventDefault();
          first.focus();
        }
      }
    };

    modal.addEventListener('keydown', window._modalKeyHandler);
    btnCancel?.focus();
  });
}
function sanitizeProfileId(id){
  return (id || '').toString().toLowerCase().replace(/[^a-z0-9_-]/g, '').slice(0, 32) || PROFILE_DEFAULT;
}
const PROFILE_ID = (() => {
  const stored = localStorage.getItem(PROFILE_KEY) || PROFILE_DEFAULT;
  return sanitizeProfileId(stored);
})();
const I18N = {
  de: {
    'nav.train': 'Training',
    'nav.swipe': 'Swipe',
    'nav.speedrun': 'Speedrun',
    'nav.exam': 'PrÃ¼fung',
    'nav.leitner': 'LernkÃ¤sten',
    'speedrun.title': 'âš¡ Speedrun',
    'speedrun.subtitle': 'Maximale Punkte in minimaler Zeit',
    'speedrun.pool': 'Pool',
    'speedrun.duration': 'Dauer',
    'speedrun.start': 'Start',
    'speedrun.done': 'Zeit abgelaufen!',
    'speedrun.restart': 'Nochmal',
    'speedrun.statsTitle': 'Meine Speedrun-Stats',
    'speedrun.leaderboardTitle': 'Leaderboard',
    'speedrun.abortConfirm': 'Speedrun wirklich abbrechen?',
    'speedrun.aborted': 'Speedrun abgebrochen',
    'nav.community': 'Community',
    'nav.pool': 'Fragenpoolâ€‘Editor',
    'nav.data': 'Import/Export',
    'nav.about': 'Impressum',
    'nav.help': 'Hilfe',
    'nav.account': 'Account',
    'modal.confirm': 'BestÃ¤tigen',
    'modal.cancel': 'Abbrechen',
    'community.progressTitle': 'Mein Fortschritt',
    'community.badgesTitle': 'Meine Badges',
    'community.leaderboardsTitle': 'Leaderboards',
    'community.contestsTitle': 'Contests',
    'community.contestLeaderboardTitle': 'Contestâ€‘Rangliste',
    'community.contestsEmpty': 'Keine aktiven oder kommenden Contests.',
    'community.contestJoin': 'Teilnehmen',
    'community.contestJoined': 'Teilnahme gespeichert.',
    'community.contestView': 'Rangliste',
    'community.contestStarts': 'Start',
    'community.contestEnds': 'Ende',
    'community.contestStatusActive': 'LÃ¤uft',
    'community.contestStatusUpcoming': 'Startet bald',
    'community.contestStatusEnded': 'Beendet',
    'community.contestNoEntries': 'Noch keine EintrÃ¤ge.',
    'community.contestPool': 'Pool',
    'community.contestGlobal': 'Global',
    'community.friendsTitle': 'Freunde',
    'community.friendsAuto': 'Alle Nutzer sind automatisch befreundet.',
    'community.friendsList': 'Meine Freunde',
    'community.friendLevel': 'Level',
    'community.friendLastActive': 'Letzte AktivitÃ¤t',
    'community.friendsEmpty': 'Noch keine Freunde.',
    'community.friendLoadErr': 'Freunde konnten nicht geladen werden.',
    'community.duelsTitle': 'Duelle',
    'community.duelsCreate': 'Neues Duell',
    'community.duelsFriend': 'Freund',
    'community.duelsPool': 'Pool',
    'community.duelsCount': 'Fragen',
    'community.duelsChallenge': 'Herausfordern',
    'community.duelsQuick': 'Schnelles Duell',
    'community.duelsHint': 'Schnelles Duell erstellt eine offene Herausforderung.',
    'community.duelsIncoming': 'Offene Einladungen',
    'community.duelsActive': 'Laufende Duelle',
    'community.duelsFinished': 'Letzte Ergebnisse',
    'community.duelsReset': 'Duelle zurÃ¼cksetzen',
    'community.duelsResetConfirm': 'Alle deine Duelle lÃ¶schen? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden.',
    'community.duelsResetDone': 'Duelle gelÃ¶scht.',
    'community.duelsResetErr': 'Duelle konnten nicht gelÃ¶scht werden:',
    'community.duelsExit': 'ZurÃ¼ck',
    'community.duelsAnswer': 'Antworten',
    'community.duelsNext': 'Weiter',
    'community.duelsPlay': 'Spielen',
    'community.duelsView': 'Details',
    'community.duelsDelete': 'LÃ¶schen',
    'community.duelsDeleteConfirm': 'Dieses Duell wirklich lÃ¶schen?',
    'community.duelsAccept': 'Annehmen',
    'community.duelsIncomingEmpty': 'Keine offenen Einladungen.',
    'community.duelsActiveEmpty': 'Keine laufenden Duelle.',
    'community.duelsFinishedEmpty': 'Keine Ergebnisse.',
    'community.duelsCreated': 'Duell erstellt.',
    'community.duelsOpenCreated': 'Offene Herausforderung erstellt.',
    'community.duelsCreateErr': 'Duell konnte nicht erstellt werden:',
    'community.duelsNoFriend': 'Bitte einen Freund auswÃ¤hlen.',
    'community.duelsNoFriends': 'Keine Freunde verfÃ¼gbar.',
    'community.duelsNoPool': 'Bitte einen Pool auswÃ¤hlen.',
    'community.duelsNeedAnswer': 'Bitte zuerst eine Antwort auswÃ¤hlen.',
    'community.duelsCorrect': 'Richtig!',
    'community.duelsWrong': 'Falsch.',
    'community.duelsAnswerErr': 'Antwort fehlgeschlagen:',
    'community.duelsLoadErr': 'Duelle konnten nicht geladen werden.',
    'community.duelsOpponent': 'Gegner:',
    'community.duelsOpponentUnknown': 'Unbekannt',
    'community.duelsOpponentShort': 'Gegner',
    'community.duelsYou': 'Du',
    'community.duelsClose': 'SchlieÃŸen',
    'community.duelsWaiting': 'Warte auf Gegnerâ€¦',
    'community.duelsWin': 'Gewonnen',
    'community.duelsLose': 'Verloren',
    'community.duelsDraw': 'Unentschieden',
    'community.duelStatus.waiting': 'Wartet',
    'community.duelStatus.active': 'Aktiv',
    'community.duelStatus.finished': 'Beendet',
    'community.duelStatus.expired': 'Abgelaufen',
    'time.justNow': 'gerade eben',
    'time.minutesAgo': 'vor {n} Min.',
    'time.hoursAgo': 'vor {n} Std.',
    'time.daysAgo': 'vor {n} Tagen',
    'badge.earned': 'Verdient',
    'badge.locked': 'Noch nicht verdient',
    'badge.none': 'Keine Badges verfÃ¼gbar.',
    'label.activePool': 'Aktiver Fragenpool',
    'train.title': 'Training â€“ eine Frage nach der anderen',
    'train.activePool': 'Aktiver Pool:',
    'train.info': 'Training: WÃ¤hle eine Antwort und prÃ¼fe sie mit â€Antwort prÃ¼fenâ€œ. â€Nur falsche (48h)â€œ zeigt Fragen, die du in den letzten 48h falsch beantwortet hast. â€FÃ¼r spÃ¤ter lernenâ€œ zeigt Fragen, die du mit â­ markiert hast. Hotkeys: â†/â†’, N/P, 1â€“9/0, C (prÃ¼fen), Enter (weiter).',
    'train.shuffle': 'Zufall',
    'train.reset': 'Training zurÃ¼cksetzen',
    'train.wrongToggle': 'Nur falsche (48h)',
    'train.laterToggle': 'FÃ¼r spÃ¤ter lernen',
    'train.laterMark': 'FÃ¼r spÃ¤ter merken',
    'train.empty': 'Keine Fragen im Pool.',
    'train.wrongEmpty': 'Keine falsch beantworteten Fragen in den letzten 48 Stunden.',
    'train.laterEmpty': 'Keine Fragen fÃ¼r spÃ¤teres Lernen.',
    'train.explain': 'ErklÃ¤rung/LÃ¶sungshinweis',
    'train.prev': 'ZurÃ¼ck',
    'train.check': 'Antwort prÃ¼fen',
    'train.next': 'Weiter',
    'swipe.title': 'Swipe-Quiz â€” Wisch & Lern',
    'swipe.hintLeft': 'â† Falsch',
    'swipe.hintRight': 'Richtig â†’',
    'swipe.true': 'âœ… Richtig',
    'swipe.false': 'âŒ Falsch',
    'swipe.correctMsg': 'Stimmt!',
    'swipe.wrongMsg': 'Leider falsch.',
    'swipe.next': 'Weiter â†’',
    'swipe.addLeitner': 'ğŸ“š In Lernkasten',
    'swipe.addedLeitner': 'âœ“ Gemerkt',
    'swipe.done': 'Runde abgeschlossen!',
    'swipe.restart': 'Nochmal spielen',
    'swipe.total': 'gesamt',
    'swipe.noPools': 'Keine Swipe-Pools vorhanden',
    'exam.title': 'PrÃ¼fung (Poolâ€‘basiert)',
    'exam.info': 'PrÃ¼fung: Lege Anzahl Fragen und Zeitlimit fest, dann â€Startâ€œ. Navigator zeigt alle Fragen; beantwortete werden markiert. Hotkeys: â†/â†’, N/P, 1â€“9/0, Enter (weiter), E (abgeben).',
    'exam.count': 'Anzahl Fragen',
    'exam.time': 'Zeitlimit (Minuten, 0 = kein Limit)',
    'exam.start': 'Start',
    'exam.prev': 'ZurÃ¼ck',
    'exam.next': 'Weiter',
    'exam.submit': 'Abgeben',
    'exam.answered': 'Beantwortet: 0',
    'exam.pool': 'Pool: â€“',
    'exam.answeredLabel': 'Beantwortet:',
    'exam.poolLabel': 'Pool:',
    'exam.focusMode': 'Fokus',
    'exam.focusModeExit': 'Fokus beenden',
    'exam.abortConfirm': 'PrÃ¼fung wirklich abbrechen?',
    'exam.aborted': 'PrÃ¼fung abgebrochen',
    'leitner.title': 'LernkÃ¤sten â€“ Sets pro Pool',
    'leitner.due': 'Zwei Modi: â€Einfachâ€œ ohne FÃ¤lligkeit und â€Klassischâ€œ mit Wiederholungsplan (Box 1/2/3/4/5 = 1/2/5/8/14 Tage).',
    'leitner.guide': 'Kurz erklÃ¤rt:\n1) Jede Frage liegt in einer Box (1â€“5). Box 1 = neu/schwierig, Box 5 = sehr sicher.\n2) Du wÃ¤hlst ein Lernkastenâ€‘Set (Pool + Modus).\n3) Klick auf eine Box = du lernst nur diese Box.\n4) Antwort wÃ¤hlen â†’ â€Weiterâ€œ. Richtig = eine Box weiter, falsch = eine Box zurÃ¼ck.\n5) â€Ãœberspringenâ€œ lÃ¤sst die Frage in der aktuellen Box.',
    'leitner.infoTitle': 'Lernkasten â€“ so funktioniertâ€™s',
    'leitner.info': 'LernkÃ¤sten sind Lernstufen mit 5 Boxen. Du legst zuerst ein Lernkastenâ€‘Set an (Pool + Modus), danach lernst du boxweise.\n\nModus â€Einfachâ€œ:\n- Keine FÃ¤lligkeit. Jede Frage ist jederzeit verfÃ¼gbar.\n- Richtig = eine Box weiter, falsch = eine Box zurÃ¼ck.\n\nModus â€Klassischâ€œ:\n- Fragen werden nach einem Zeitplan fÃ¤llig.\n- Intervalle (gÃ¤ngig): Box 1/2/3/4/5 = 1/2/5/8/14 Tage.\n- Nur fÃ¤llige Fragen erscheinen.\n\nBedienung:\n1) Set auswÃ¤hlen â†’ Box anklicken.\n2) Antwort wÃ¤hlen â†’ â€Weiterâ€œ.\n3) â€Ãœberspringenâ€œ hÃ¤lt die Frage in derselben Box.',
    'leitner.allSelected': 'Alle in Auswahl',
    'leitner.reset': 'Lernkasten zurÃ¼cksetzen',
    'leitner.resetConfirm': 'Lernkasten-Status fÃ¼r dieses Set wirklich zurÃ¼cksetzen?',
    'leitner.resetOk': 'Lernkasten-Status zurÃ¼ckgesetzt.',
    'leitner.resetErr': 'Reset fehlgeschlagen:',
    'leitner.setLabel': 'Lernkasten-Set',
    'leitner.setMode': 'Modus',
    'leitner.setName': 'Name',
    'leitner.setPool': 'Pool',
    'leitner.setModeSelect': 'Modus wÃ¤hlen',
    'leitner.setCreate': 'Lernkasten anlegen',
    'leitner.setsTitle': 'Lernkastenâ€‘Sets',
    'leitner.setsEmpty': 'Noch keine LernkÃ¤sten angelegt.',
    'leitner.setDelete': 'Lernkasten lÃ¶schen',
    'leitner.setDeleteConfirm': 'Dieses Lernkasten-Set wirklich lÃ¶schen?',
    'leitner.setDeleteErr': 'Lernkasten konnte nicht gelÃ¶scht werden:',
    'leitner.setCreateErr': 'Lernkasten konnte nicht angelegt werden:',
    'leitner.setNameNeed': 'Bitte einen Namen eingeben.',
    'leitner.setPoolNeed': 'Bitte einen Pool auswÃ¤hlen.',
    'leitner.setEmpty': 'Noch keine LernkÃ¤sten angelegt.',
    'leitner.setMissing': 'Bitte zuerst ein Lernkasten-Set auswÃ¤hlen.',
    'leitner.modeSimple': 'Einfach (ohne FÃ¤lligkeit)',
    'leitner.modeClassic': 'Klassisch (mit FÃ¤lligkeit)',
    'leitner.modeSimpleShort': 'Einfach',
    'leitner.modeClassicShort': 'Klassisch',
    'leitner.multiHint': 'Hinweis: Mehrfachauswahl mÃ¶glich.',
    'leitner.next': 'Weiter',
    'leitner.needAnswer': 'Bitte zuerst eine Antwort auswÃ¤hlen.',
    'leitner.skip': 'Ãœberspringen',
    'leitner.poolEmpty': 'Keine passenden Fragen in der Auswahl.',
    'leitner.dueEmpty': 'Keine fÃ¤lligen Fragen in der Auswahl.',
    'leitner.setEmptyHint': 'Bitte zuerst ein Lernkastenâ€‘Set anlegen oder auswÃ¤hlen.',
    'question.translationUnavailable': 'Ãœbersetzung nicht verfÃ¼gbar.',
    'pool.title': 'Fragenpool verwalten',
    'pool.select': 'Pool auswÃ¤hlen',
    'pool.name': 'Poolname',
    'pool.create': 'Anlegen/Aktualisieren',
    'pool.delete': 'Pool lÃ¶schen',
    'pool.export': 'Pool exportieren',
    'pool.import': 'Pool importieren',
    'pool.importCsv': 'CSV importieren',
    'pool.desc': 'Jeder Pool hat eigene Fragen, Lernkastenâ€‘Boxen und Statistiken.',
    'pool.aiPrompt': 'AIâ€‘Pool erstellen',
    'pool.aiPromptTip': 'Lass dir von einer KI Fragenpools generieren. Klick hier, um den Prompt herunterzuladen.',
    'pool.noneForLang': 'Keine Pools fÃ¼r Sprache.',
    'lang.originalPrefix': 'Originalsprache',
    'lang.name.de': 'Deutsch',
    'lang.name.en': 'Englisch',
    'lang.name.ru': 'Russisch',
    'pool.edit': 'Frage bearbeiten/erstellen',
    'pool.lockedLogin': 'ğŸ”’ Editor ist gesperrt. Bitte einloggen, um zu bearbeiten.',
    'pool.lockedNoPerm': 'ğŸ”’ Keine Schreibrechte fÃ¼r diesen Pool.',
    'pool.noPermission': 'Keine Schreibrechte fÃ¼r diesen Pool.',
    'pool.unlock': 'Editor entsperren',
    'pool.question': 'Fragetext',
    'pool.category': 'Kategorie (optional)',
    'pool.explain': 'ErklÃ¤rung/LÃ¶sungshinweis (optional)',
    'pool.answers': 'Antwortoptionen',
    'pool.addAnswer': '+ Antwort hinzufÃ¼gen',
    'pool.answerHint': 'Markiere korrekt per Checkbox. (Im Training/der PrÃ¼fung bleibt verborgen, ob Single/Multiple.)',
    'pool.new': 'Neu',
    'pool.save': 'Speichern',
    'pool.remove': 'LÃ¶schen',
    'pool.bulk.title': 'Stapelimport (unterhalb der Einzelbearbeitung)',
    'pool.bulk.paste': 'EinfÃ¼gen (Freitext)',
    'pool.bulk.auto': 'Auto-Erkennung korrekt:',
    'pool.bulk.auto.desc': 'PrÃ¤fix',
    'pool.bulk.auto.or': 'oder',
    'pool.bulk.auto.ok': 'â†’ korrekt.',
    'pool.bulk.sep': 'Trennung zwischen Fragen mit',
    'pool.bulk.cat': 'Kategorie (optional, fÃ¼r alle neuen)',
    'pool.bulk.preview': 'Vorschau erzeugen',
    'pool.bulk.import': 'In aktuellen Pool importieren',
    'pool.bulk.previewLabel': 'Vorschau',
    'pool.bulk.previewEmpty': 'Noch keine Vorschau.',
    'pool.list': 'Vorhandene Fragen (aktiver Pool)',
    'data.title': 'Datenverwaltung',
    'data.exportTitle': 'Backup erstellen',
    'data.exportAll': 'Alle Pools exportieren',
    'data.download': 'Download',
    'data.backupDesc': 'Sichert alle Pools inkl. Stats & Lernkasten als JSON.',
    'data.importTitle': 'Backup einspielen',
    'data.importAll': 'Alle Pools importieren',
    'data.importDesc': 'JSONâ€‘Datei auswÃ¤hlen und importieren.',
    'data.dangerTitle': 'Achtung',
    'data.dangerDesc': 'â€Alles lÃ¶schenâ€œ entfernt alle Pools & Statistiken unwiderruflich.',
    'data.wipeAll': 'Alles lÃ¶schen',
    'data.server': 'Serverâ€‘DatensÃ¤tze',
    'data.serverHint': 'Importiert DatensÃ¤tze direkt vom Server.',
    'data.serverHintAudit': 'Vor dem Import lÃ¤uft automatisch ein PrÃ¼fbericht (strict). Bei Fehlern wird der Import abgebrochen.',
    'data.dataset.new': 'Als neuen Pool importieren',
    'data.dataset.append': 'Zum aktiven Pool hinzufÃ¼gen',
    'data.defaultImport': 'Initiale DatensÃ¤tze werden geladenâ€¦',
    'gate.title': 'Profil auswÃ¤hlen',
    'gate.subtitle': 'Bereit, dein Wissen zu testen? Sammle XP, fordere Freunde heraus und werde Experte.',
    'gate.title': 'Willkommen',
    'gate.subtitle': 'Bereit, dein Wissen zu testen? Sammle XP, fordere Freunde heraus und werde Experte.',
    'gate.disclaimer': 'Privates Projekt zu Schulungszwecken. Kein Anspruch auf fehlerfreien Betrieb.',
    'gate.account.title': 'Account',
    'gate.account.subtitle': 'Login oder neuen Account anlegen.',
    'gate.login.identifier': 'Benutzername oder Eâ€‘Mail',
    'gate.login.password': 'Passwort',
    'gate.login.btn': 'Login',
    'gate.forgot.link': 'Passwort vergessen?',
    'gate.forgot.email': 'Eâ€‘Mail',
    'gate.forgot.btn': 'Resetâ€‘Link senden',
    'gate.forgot.needEmail': 'Bitte Eâ€‘Mail eingeben.',
    'gate.forgot.sent': 'Wenn ein Konto existiert, wurde ein Link gesendet.',
    'gate.reset.password': 'Neues Passwort',
    'gate.reset.password2': 'Passwort wiederholen',
    'gate.reset.btn': 'Passwort setzen',
    'gate.reset.needPw': 'Bitte beide PasswÃ¶rter eingeben.',
    'gate.reset.noMatch': 'PasswÃ¶rter stimmen nicht Ã¼berein.',
    'gate.reset.noToken': 'Resetâ€‘Token fehlt.',
    'gate.reset.ok': 'Passwort gesetzt. Bitte einloggen.',
    'gate.reset.err': 'Reset fehlgeschlagen.',
    'gate.register.title': 'Account erstellen',
    'gate.register.username': 'Benutzername',
    'gate.register.email': 'Eâ€‘Mail',
    'gate.register.password': 'Passwort',
    'gate.register.password2': 'Passwort wiederholen',
    'gate.register.btn': 'Account anlegen',
    'gate.register.link': 'Account anlegen',
    'gate.register.success': 'Account erstellt. Bitte jetzt einloggen.',
    'gate.login.link': 'Zum Login zurÃ¼ck',
    'about.openStart': 'Startseite Ã¶ffnen',
    'account.title': 'Account',
    'account.logout': 'Logout',
    'account.note': 'Hier kommen spÃ¤ter Funktionen wie Passwort Ã¤ndern, Account lÃ¶schen oder 2FA.',
    'account.leaderboardOptIn': 'In Ranglisten anzeigen',
    'account.displayName': 'Anzeigename',
    'account.save': 'Speichern',
    'account.saveOk': 'Einstellungen gespeichert.',
    'account.saveErr': 'Speichern fehlgeschlagen.',
    'account.prefsTitle': 'Pools',
    'account.langCurrent': 'Aktive Sprache',
    'account.langEnableEn': 'Englisch aktivieren',
    'account.langEnableRu': 'Russisch aktivieren',
    'account.langHint': 'Sprache stellst du oben rechts um. Pools sind gruppiert und gelten pro Bereich.',
    'account.poolHint': 'WÃ¤hle die Poolâ€‘Gruppen, die du verwenden mÃ¶chtest.',
    'review.title': 'Fehler & Merkliste',
    'review.poolLabel': 'Pool',
    'review.refresh': 'Aktualisieren',
    'review.resetHidden': 'Versteckte anzeigen',
    'review.hint': 'Hier siehst du deine falsch beantworteten Fragen (letzte 48h) und die â€FÃ¼r spÃ¤ter lernenâ€œ-Merkliste.',
    'review.wrongTitle': 'Falsch beantwortet (48h)',
    'review.wrongEmpty': 'Keine falsch beantworteten Fragen.',
    'review.laterTitle': 'FÃ¼r spÃ¤ter lernen',
    'review.laterEmpty': 'Keine Fragen markiert.',
    'review.actionLater': 'FÃ¼r spÃ¤ter merken',
    'review.actionUnmark': 'Entmarkieren',
    'review.actionHide': 'Ausblenden',
    'review.actionHiddenInfo': 'Ausgeblendet (lokal)',
    'review.loginRequired': 'Bitte einloggen.',
    'review.resetPool': 'Pool-Statistik zurÃ¼cksetzen',
    'review.resetPoolConfirm': 'Das lÃ¶scht Trainingsstatistik, Lernkasten und â€FÃ¼r spÃ¤terâ€œ im aktiven Pool. Fortfahren?',
    'review.resetPoolOk': 'Pool-Statistik zurÃ¼ckgesetzt.',
    'review.resetPoolErr': 'ZurÃ¼cksetzen fehlgeschlagen.',
    'account.poolEmpty': 'Keine Pools verfÃ¼gbar.',
    'account.poolSelected': 'AusgewÃ¤hlte Pools',
    'account.poolMore': 'Weitere Pools anzeigen',
    'account.langDisabled': 'Diese Sprache ist im Account nicht aktiviert.',
    'account.prefsApply': 'BestÃ¤tigen',
    'account.prefsReset': 'Auf Standard zurÃ¼cksetzen',
    'account.prefsReload': 'Neu laden',
    'account.prefsApplied': 'Einstellungen Ã¼bernommen.',
    'account.statsTitle': 'Meine Statistiken',
    'account.statsLoading': 'Statistiken werden geladenâ€¦',
    'account.statTotalAnswered': 'Beantwortet',
    'account.statAccuracy': 'Richtig',
    'account.statActiveDays': 'Aktive Tage',
    'account.statWrong': 'Falsch',
    'account.statExams': 'PrÃ¼fungen',
    'account.statMemberSince': 'Dabei seit',
    'account.statTopPools': 'Top Pools',
    'account.statLastActive': 'Zuletzt aktiv',
    'account.statTopPoolsEmpty': 'Noch keine AktivitÃ¤ten.',
    'account.statLoadErr': 'Statistiken konnten nicht geladen werden.',
    'account.examStats': 'PrÃ¼fungsstatistik',
    'gamify.title': 'Gamification',
    'gamify.xp': 'XP',
    'gamify.level': 'Level',
    'gamify.streakDaily': 'TÃ¤glich',
    'gamify.streakWeekly': 'WÃ¶chentlich',
    'gamify.streakHint': 'Daily: 10 Antworten Â· Weekly: 4 aktive Tage (lokale Zeitzone)',
    'gamify.levelHint': 'Level 0 Â· 0/10 XP',
    'gamify.levelPrefix': 'Level',
    'gamify.lastAward': 'Letzte XPâ€‘Vergabe',
    'gamify.badges': 'Badges',
    'gamify.badgesEmpty': 'Noch keine Badges gesammelt.',
    'badge.erste_100': 'Erste 100 richtige',
    'badge.konsequent': '7 Tage Streak',
    'badge.pruefungssicher': '3 PrÃ¼fungen â‰¥80%',
    'gamify.refresh': 'Aktualisieren',
    'leaderboard.title': 'Ranglisten',
    'leaderboard.note': 'Nur Nutzer mit Optâ€‘in werden angezeigt.',
    'leaderboard.xp': 'Globalâ€‘Score',
    'leaderboard.streak': 'Wochenscore',
    'leaderboard.pool': 'Poolâ€‘Score (aktiver Pool)',
    'leaderboard.poolEmpty': 'Kein aktiver Pool.',
    'leaderboard.empty': 'Noch keine EintrÃ¤ge.',
    'leaderboard.error': 'Konnte nicht geladen werden.',
    'leaderboard.login': 'Bitte einloggen, um Ranglisten zu sehen.',
    'leaderboard.anon': 'Unbekannt',
    'modal.title': 'Hinweis',
    'modal.ok': 'OK',
    'account.examEmpty': 'Noch keine PrÃ¼fungen vorhanden.',
    'account.examSummary': 'Ergebnis',
    'account.examWrong': 'Falsch',
    'account.examMarkWrong': 'Falsche merken',
    'account.examMarked': 'FÃ¼r spÃ¤ter markiert:',
    'account.examError': 'PrÃ¼fungen konnten nicht geladen werden.',
    'footer.credits': 'PrÃ¼fungstrainer v42.0 â€¢ GPLâ€‘3.0 â€¢ APIâ€‘basiert â€¢ Made with â¤ï¸ â€¢ Credits: Andre Stiebitz',
    'impressum.title': 'Impressum',
    'impressum.subtitle': 'Angaben gemÃ¤ÃŸ Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Eâ€‘Mail: <a href="mailto:contact@example.com">contact@example.com</a>',
    'impressum.privacyTitle': 'Datenschutzhinweis (DSGVO)',
    'impressum.privacy.li1': 'Personenbezogene Daten: Benutzername, Eâ€‘Mailâ€‘Adresse (bei Registrierung) und Lernfortschritt werden serverseitig gespeichert.',
    'impressum.privacy.li2': 'Zweck: Bereitstellung der Lernplattform, Speicherung des Lernfortschritts, Accountâ€‘Verwaltung.',
    'impressum.privacy.li3': 'Rechtsgrundlage: Einwilligung (Art. 6 Abs. 1 lit. a DSGVO) durch Registrierung.',
    'impressum.privacy.li4': 'Speicherdauer: Daten werden gespeichert, solange dein Account besteht. LÃ¶schung auf Anfrage per Eâ€‘Mail.',
    'impressum.privacy.li5': 'Keine Weitergabe an Dritte. Keine Trackingâ€‘Cookies, keine Analyseâ€‘Tools.',
    'impressum.privacy.li6': 'Deine Rechte: Auskunft, Berichtigung, LÃ¶schung, EinschrÃ¤nkung, DatenÃ¼bertragbarkeit und Widerspruch. Kontakt: contact@example.com',
    'impressum.privacy.li7': 'Hosting: Server in Deutschland.',
    'impressum.infoTitle': 'Info & Lizenz (GPLâ€‘3.0)',
    'impressum.info.li1': 'Singleâ€‘Pageâ€‘App mit Serverâ€‘API, 6 Modi: Training, PrÃ¼fung, Swipe, Lernkasten, Duelle, Community.',
    'impressum.info.li2': 'Pools, Lernkastenâ€‘Status und Statistiken liegen serverseitig pro Account.',
    'impressum.info.li3': 'Import/Export als JSON. KIâ€‘gestÃ¼tzte Poolâ€‘Erstellung mÃ¶glich.',
    'impressum.info.li4': '3 Sprachen (DE/EN/RU) â€” UI und Fragen einzeln umschaltbar.',
    'impressum.info.li5': 'Bilder in Fragen werden unterstÃ¼tzt.',
    'impressum.licenseNote': 'Lizenz: GPLâ€‘3.0.',
    'impressum.quote': 'Der bloÃŸe Besitz von Wissen ist nicht genug; wichtig ist die FÃ¤higkeit, Wissen anzuwenden.',
    'impressum.vibeNote': 'Auch ohne Webdesign-Diplom kann man heute Erstaunliches bauen â€” ich bin der Beweis. Wenn was klemmt: erst selbst denken, dann den zweiten Kopf dazuholen. Feedback, das persÃ¶nlich oder konstruktiv ist, landet direkt im Danke-Ordner.',
    'help.title': 'Hilfe & Anleitung',
    'help.overview.title': 'KurzÃ¼bersicht',
    'help.overview.li1': 'Training = freies Ãœben, Swipe = Wischâ€‘Quiz (Richtig/Falsch), Speedrun = Zeitrennen (1/5/10 Min), PrÃ¼fung = simulierte Tests, Lernkasten = Karteikarten.',
    'help.overview.li2': 'Alle LernstÃ¤nde (Statistik, Lernkasten, Falsch/SpÃ¤ter) sind pro Account gespeichert.',
    'help.overview.li3': 'Fragenpools sind die Grundlage fÃ¼r alle Modi. Jede Frage kann per Sprachâ€‘Toggle (DE/EN/RU) einzeln umgeschaltet werden.',
    'help.hotkeys.title': 'Hotkeys',
    'help.hotkeys.train': 'Training: â†/â†’ oder N/P blÃ¤ttern Â· 1â€“9/0 toggeln Â· C prÃ¼fen Â· Enter weiter',
    'help.hotkeys.exam': 'PrÃ¼fung: â†/â†’ oder N/P blÃ¤ttern Â· 1â€“9/0 toggeln Â· Enter weiter',
    'help.hotkeys.swipe': 'Swipe & Speedrun: â†’ oder R = Richtig Â· â† oder L = Falsch Â· Leertaste = Weiter',
    'help.training.title': 'Training',
    'help.training.li1': 'Eine Frage pro Ansicht, Antworten kÃ¶nnen gemischt werden.',
    'help.training.li2': 'â€Antwort prÃ¼fen" zeigt richtig/falsch und (falls vorhanden) eine ErklÃ¤rung.',
    'help.training.li3': 'â€Nur falsche (48h)" und â€FÃ¼r spÃ¤ter lernen" filtern die Fragenliste.',
    'help.training.li4': 'Mit â­ kannst du Fragen fÃ¼r spÃ¤ter markieren.',
    'help.exam.title': 'PrÃ¼fung',
    'help.exam.li1': 'Lege Anzahl Fragen und Zeitlimit fest, dann â€Start".',
    'help.exam.li2': 'Navigator zeigt alle Fragen, beantwortete werden markiert.',
    'help.exam.li3': 'Die PrÃ¼fung wird automatisch abgegeben, sobald alle Fragen beantwortet sind.',
    'help.exam.li4': 'Bei aktivem Timer lÃ¤uft eine orange ZÃ¼ndschnur um die PrÃ¼fung â€” wenn du alle Fragen vor Ablauf beantwortest, entschÃ¤rfst du die Bombe! ğŸ’£',
    'help.exam.li5': 'In der PrÃ¼fungsstatistik (Account-Tab) kannst du alte PrÃ¼fungen wiederholen oder lÃ¶schen.',
    'help.swipe.title': 'Swipeâ€‘Modus',
    'help.swipe.li1': 'Wischâ€‘Quiz im Tinderâ€‘Stil: Aussage lesen, nach rechts wischen (Richtig) oder links (Falsch).',
    'help.swipe.li2': 'Nach dem Wischen dreht sich die Karte um und zeigt die ErklÃ¤rung. Du bestimmst das Tempo â€” klicke â€Weiter" wenn du fertig bist.',
    'help.swipe.li3': 'Auf der KartenrÃ¼ckseite kannst du die Frage direkt in deinen Lernkasten legen.',
    'help.swipe.li4': 'Tastatur: â†’/R = Richtig, â†/L = Falsch, Leertaste = Weiter. Touch: Wischen oder Buttons.',
    'help.swipe.li5': 'Swipeâ€‘Pools werden durch den Prefix â€Swipe:" im Poolnamen erkannt.',
    'help.speedrun.title': 'Speedrunâ€‘Modus',
    'help.speedrun.li1': 'Zeitrennen im Swipe-Tab: WÃ¤hle 1, 5 oder 10 Minuten und sammle so viele richtige Antworten wie mÃ¶glich.',
    'help.speedrun.li2': 'Keine ErklÃ¤rungen â€” nur schnelles Feedback (âœ…/âŒ), dann direkt zur nÃ¤chsten Frage.',
    'help.speedrun.li3': 'Eine orange ZÃ¼ndschnur lÃ¤uft um das Panel und zeigt die verbleibende Zeit. Bei 0:00 endet das Rennen automatisch.',
    'help.speedrun.li4': 'Wenn du alle Fragen vor Ablauf beantwortest, entschÃ¤rfst du die Speedrun-Bombe! ğŸ’£',
    'help.speedrun.li5': 'Deine Bestleistungen und Stats findest du im Community-Tab, ebenso das Leaderboard fÃ¼r jede Dauer.',
    'help.leitner.title': 'Lernkastenâ€‘System',
    'help.leitner.li1': 'Erstelle ein Lernkastenâ€‘Set (Pool + Modus) und wÃ¤hle es aus.',
    'help.leitner.li2': 'â€Einfach" = ohne FÃ¤lligkeit, â€Klassisch" = Zeitplan (1/2/5/8/14 Tage).',
    'help.leitner.li3': 'Box anklicken â†’ nur diese Fragen. Richtig = eine Box weiter, falsch = eine Box zurÃ¼ck.',
    'help.community.title': 'Community',
    'help.community.li1': 'Im Communityâ€‘Tab findest du Fortschritt, Badges und Ranglisten.',
    'help.community.li2': 'Freunde: Alle Nutzer sind automatisch befreundet.',
    'help.community.li3': 'Duelle: Freund auswÃ¤hlen oder â€Schnelles Duell" starten, Einladungen annehmen.',
    'help.community.li4': 'Ergebnisse zeigen korrekte Antworten + Zeit; XP werden automatisch vergeben.',
    'help.community.li5': 'Ranglisten zeigen nur Nutzer mit Optâ€‘in (Accountâ€‘Bereich).',
    'help.review.title': 'Fehler & Merkliste',
    'help.review.li1': 'Im Accountâ€‘Bereich findest du â€Falsch beantwortet (48h)" und â€FÃ¼r spÃ¤ter lernen".',
    'help.review.li2': 'Listen sind pro Pool und kÃ¶nnen dort bereinigt werden.',
    'help.pools.title': 'Fragenpools & Editor',
    'help.pools.li1': 'Training/PrÃ¼fung/Swipe/Lernkasten arbeiten mit dem aktuell ausgewÃ¤hlten Pool.',
    'help.pools.li2': 'Im Editor kannst du Fragen anlegen, Ã¤ndern und lÃ¶schen.',
    'help.pools.li3': 'â€Stapelimport" oder â€AIâ€‘Pool erstellen" fÃ¼r neue Pools.',
    'help.import.title': 'Import/Export',
    'help.import.li1': 'â€Pool exportieren" bzw. â€Alle Pools exportieren" fÃ¼r Backups.',
    'help.import.li2': 'Serverâ€‘DatensÃ¤tze kÃ¶nnen direkt importiert werden.',
    'help.lang.title': 'Sprache',
    'help.lang.li1': 'Die UIâ€‘Sprache (Icon oben rechts) Ã¤ndert nur die OberflÃ¤che.',
    'help.lang.li2': 'Jede Frage hat einen Sprachâ€‘Toggle (DE/EN/RU Buttons), mit dem du die Ãœbersetzung direkt an der Frage umschalten kannst.',
    'help.lang.li3': 'Pools enthalten alle Sprachvarianten â€” kein Poolâ€‘Wechsel nÃ¶tig.',
    'help.admin.title': 'Editorâ€‘Rechte',
    'help.admin.li1': 'Zum Bearbeiten, Importieren oder LÃ¶schen musst du eingeloggt sein.',
    'impressum.subtitle': 'Angaben gemÃ¤ÃŸ Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Eâ€‘Mail: <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'impressum.short': '[Your Name] Â· [Your Address] Â· [Your City, Postal Code] Â· <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'api.title': 'APIâ€‘Verbindung',
    'api.label': 'APIâ€‘URL',
    'api.save': 'Speichern',
    'api.test': 'Testen',
    'api.hint': 'Standard ist dieselbe Domain mit /api.',
    'profile.label': 'Profil',
    'aria.langMenu': 'Sprache wechseln',
    'aria.textSize': 'TextgrÃ¶ÃŸe Ã¤ndern',
    'aria.accountOpen': 'Account Ã¶ffnen',
    'aria.infoTrain': 'Hotkeys & Hinweise',
    'aria.infoExam': 'Hinweise & Hotkeys',
    'aria.infoLeitner': 'Hinweise',
    'theme.title': 'Hell/Dunkel umschalten',
    'nav.toggle': 'MenÃ¼ ein/aus'
  },
  en: {
    'nav.train': 'Training',
    'nav.swipe': 'Swipe',
    'nav.speedrun': 'Speedrun',
    'nav.exam': 'Exam',
    'nav.leitner': 'Learning Boxes',
    'speedrun.title': 'âš¡ Speedrun',
    'speedrun.subtitle': 'Maximum points in minimum time',
    'speedrun.pool': 'Pool',
    'speedrun.duration': 'Duration',
    'speedrun.start': 'Start',
    'speedrun.done': 'Time expired!',
    'speedrun.restart': 'Retry',
    'speedrun.statsTitle': 'My Speedrun Stats',
    'speedrun.leaderboardTitle': 'Leaderboard',
    'speedrun.abortConfirm': 'Really abort speedrun?',
    'speedrun.aborted': 'Speedrun aborted',
    'nav.community': 'Community',
    'nav.pool': 'Question Pool Editor',
    'nav.data': 'Import/Export',
    'nav.about': 'Imprint',
    'nav.help': 'Help',
    'nav.account': 'Account',
    'modal.confirm': 'Confirm',
    'modal.cancel': 'Cancel',
    'community.progressTitle': 'My Progress',
    'community.badgesTitle': 'My Badges',
    'community.leaderboardsTitle': 'Leaderboards',
    'community.contestsTitle': 'Contests',
    'community.contestLeaderboardTitle': 'Contest leaderboard',
    'community.contestsEmpty': 'No active or upcoming contests.',
    'community.contestJoin': 'Join',
    'community.contestJoined': 'Joined.',
    'community.contestView': 'Leaderboard',
    'community.contestStarts': 'Starts',
    'community.contestEnds': 'Ends',
    'community.contestStatusActive': 'Active',
    'community.contestStatusUpcoming': 'Upcoming',
    'community.contestStatusEnded': 'Ended',
    'community.contestNoEntries': 'No entries yet.',
    'community.contestPool': 'Pool',
    'community.contestGlobal': 'Global',
    'community.friendsTitle': 'Friends',
    'community.friendsAuto': 'All users are automatically friends.',
    'community.friendsList': 'My friends',
    'community.friendLevel': 'Level',
    'community.friendLastActive': 'Last active',
    'community.friendsEmpty': 'No friends yet.',
    'community.friendLoadErr': 'Could not load friends.',
    'community.duelsTitle': 'Duels',
    'community.duelsCreate': 'New duel',
    'community.duelsFriend': 'Friend',
    'community.duelsPool': 'Pool',
    'community.duelsCount': 'Questions',
    'community.duelsChallenge': 'Challenge',
    'community.duelsQuick': 'Quick duel',
    'community.duelsHint': 'Quick duel creates an open challenge.',
    'community.duelsIncoming': 'Incoming',
    'community.duelsActive': 'Active duels',
    'community.duelsFinished': 'Recent results',
    'community.duelsReset': 'Reset duels',
    'community.duelsResetConfirm': 'Delete all your duels? This cannot be undone.',
    'community.duelsResetDone': 'Duels deleted.',
    'community.duelsResetErr': 'Could not delete duels:',
    'community.duelsExit': 'Back',
    'community.duelsAnswer': 'Answer',
    'community.duelsNext': 'Next',
    'community.duelsPlay': 'Play',
    'community.duelsView': 'Details',
    'community.duelsDelete': 'Delete',
    'community.duelsDeleteConfirm': 'Delete this duel?',
    'community.duelsAccept': 'Accept',
    'community.duelsIncomingEmpty': 'No incoming duels.',
    'community.duelsActiveEmpty': 'No active duels.',
    'community.duelsFinishedEmpty': 'No results yet.',
    'community.duelsCreated': 'Duel created.',
    'community.duelsOpenCreated': 'Open challenge created.',
    'community.duelsCreateErr': 'Could not create duel:',
    'community.duelsNoFriend': 'Please select a friend.',
    'community.duelsNoFriends': 'No friends available.',
    'community.duelsNoPool': 'Please select a pool.',
    'community.duelsNeedAnswer': 'Please choose an answer first.',
    'community.duelsCorrect': 'Correct!',
    'community.duelsWrong': 'Wrong.',
    'community.duelsAnswerErr': 'Answer failed:',
    'community.duelsLoadErr': 'Could not load duels.',
    'community.duelsOpponent': 'Opponent:',
    'community.duelsOpponentUnknown': 'Unknown',
    'community.duelsOpponentShort': 'Opponent',
    'community.duelsYou': 'You',
    'community.duelsClose': 'Close',
    'community.duelsWaiting': 'Waiting for opponentâ€¦',
    'community.duelsWin': 'Won',
    'community.duelsLose': 'Lost',
    'community.duelsDraw': 'Draw',
    'community.duelStatus.waiting': 'Waiting',
    'community.duelStatus.active': 'Active',
    'community.duelStatus.finished': 'Finished',
    'community.duelStatus.expired': 'Expired',
    'time.justNow': 'just now',
    'time.minutesAgo': '{n} min ago',
    'time.hoursAgo': '{n} h ago',
    'time.daysAgo': '{n} d ago',
    'badge.earned': 'Earned',
    'badge.locked': 'Not earned yet',
    'badge.none': 'No badges available.',
    'label.activePool': 'Active question pool',
    'train.title': 'Training â€“ one question at a time',
    'train.activePool': 'Active pool:',
    'train.info': 'Training: Pick an answer and check it with â€œCheck answerâ€. â€œWrong only (48h)â€ shows questions you missed in the last 48h. â€œLearn laterâ€ shows questions you marked with â­. Hotkeys: â†/â†’, N/P, 1â€“9/0, C (check), Enter (next).',
    'train.shuffle': 'Random',
    'train.reset': 'Reset training',
    'train.wrongToggle': 'Wrong only (48h)',
    'train.laterToggle': 'Later learn',
    'train.laterMark': 'Mark for later',
    'train.empty': 'No questions in pool.',
    'train.wrongEmpty': 'No wrong answers in the last 48 hours.',
    'train.laterEmpty': 'No questions marked for later.',
    'train.explain': 'Explanation / hint',
    'train.prev': 'Back',
    'train.check': 'Check answer',
    'train.next': 'Next',
    'swipe.title': 'Swipe Quiz â€” Swipe & Learn',
    'swipe.hintLeft': 'â† False',
    'swipe.hintRight': 'True â†’',
    'swipe.true': 'âœ… True',
    'swipe.false': 'âŒ False',
    'swipe.correctMsg': 'Correct!',
    'swipe.wrongMsg': 'Wrong.',
    'swipe.next': 'Next â†’',
    'swipe.addLeitner': 'ğŸ“š Add to study box',
    'swipe.addedLeitner': 'âœ“ Saved',
    'swipe.done': 'Round complete!',
    'swipe.restart': 'Play again',
    'swipe.total': 'total',
    'swipe.noPools': 'No swipe pools available',
    'exam.title': 'Exam (pool-based)',
    'exam.info': 'Exam: Choose number of questions and an optional time limit, then start. Navigator lets you jump; answered are marked. Hotkeys: â†/â†’, N/P, 1â€“9/0, Enter (next), E (submit).',
    'exam.count': 'Number of questions',
    'exam.time': 'Time limit (minutes, 0 = none)',
    'exam.start': 'Start',
    'exam.prev': 'Back',
    'exam.next': 'Next',
    'exam.submit': 'Submit',
    'exam.answered': 'Answered: 0',
    'exam.pool': 'Pool: â€“',
    'exam.answeredLabel': 'Answered:',
    'exam.poolLabel': 'Pool:',
    'exam.focusMode': 'Focus',
    'exam.focusModeExit': 'Exit Focus',
    'exam.abortConfirm': 'Really abort exam?',
    'exam.aborted': 'Exam aborted',
    'leitner.title': 'Learning Boxes â€“ sets per pool',
    'leitner.due': 'Two modes: â€œSimpleâ€ without due dates and â€œClassicâ€ with a review plan (Box 1/2/3/4/5 = 1/2/5/8/14 days).',
    'leitner.guide': 'Quick overview:\n1) Each question sits in a box (1â€“5). Box 1 = new/hard, Box 5 = very solid.\n2) Pick a learningâ€‘box set (pool + mode).\n3) Click a box to study that box only.\n4) Choose an answer â†’ â€œNextâ€. Correct = one box forward, wrong = one box back.\n5) â€œSkipâ€ keeps the question in the current box.',
    'leitner.infoTitle': 'Learning boxes â€“ how it works',
    'leitner.info': 'Learning boxes are five levels. First create a set (pool + mode), then study box by box.\n\nMode â€œSimpleâ€:\n- No due dates. Every question is always available.\n- Correct = one box forward, wrong = one box back.\n\nMode â€œClassicâ€:\n- Questions become due by a fixed schedule.\n- Intervals (common): Box 1/2/3/4/5 = 1/2/5/8/14 days.\n- Only due questions appear.\n\nHow to use:\n1) Select a set â†’ click a box.\n2) Choose an answer â†’ â€œNextâ€.\n3) â€œSkipâ€ keeps the question in the same box.',
    'leitner.allSelected': 'All from selection',
    'leitner.reset': 'Reset learning boxes',
    'leitner.resetConfirm': 'Reset this learning box set?',
    'leitner.resetOk': 'Learning box reset.',
    'leitner.resetErr': 'Reset failed:',
    'leitner.setLabel': 'Learning box set',
    'leitner.setMode': 'Mode',
    'leitner.setName': 'Name',
    'leitner.setPool': 'Pool',
    'leitner.setModeSelect': 'Choose mode',
    'leitner.setCreate': 'Create learning box',
    'leitner.setsTitle': 'Learning box sets',
    'leitner.setsEmpty': 'No learning boxes created yet.',
    'leitner.setDelete': 'Delete learning box',
    'leitner.setDeleteConfirm': 'Delete this learning box set?',
    'leitner.setDeleteErr': 'Could not delete learning box:',
    'leitner.setCreateErr': 'Could not create learning box:',
    'leitner.setNameNeed': 'Please enter a name.',
    'leitner.setPoolNeed': 'Please select a pool.',
    'leitner.setEmpty': 'No learning boxes yet.',
    'leitner.setMissing': 'Please select a learning box set first.',
    'leitner.modeSimple': 'Simple (no due)',
    'leitner.modeClassic': 'Classic (with due)',
    'leitner.modeSimpleShort': 'Simple',
    'leitner.modeClassicShort': 'Classic',
    'leitner.multiHint': 'Note: Multiple answers may be correct.',
    'leitner.next': 'Next',
    'leitner.needAnswer': 'Please select an answer first.',
    'leitner.skip': 'Skip',
    'leitner.poolEmpty': 'No matching questions in the selection.',
    'leitner.dueEmpty': 'No due questions in the selection.',
    'leitner.setEmptyHint': 'Please create or select a learningâ€‘box set first.',
    'question.translationUnavailable': 'Translation not available.',
    'pool.title': 'Manage question pools',
    'pool.select': 'Select pool',
    'pool.name': 'Pool name',
    'pool.create': 'Create/Update',
    'pool.delete': 'Delete pool',
    'pool.export': 'Export pool',
    'pool.import': 'Import pool',
    'pool.importCsv': 'Import CSV',
    'pool.desc': 'Each pool has its own questions, learning boxes and stats.',
    'pool.aiPrompt': 'Create AI pool',
    'pool.aiPromptTip': 'Let an AI generate question pools. Click to download the prompt.',
    'pool.noneForLang': 'No pools for this language.',
    'lang.originalPrefix': 'Original language',
    'lang.name.de': 'German',
    'lang.name.en': 'English',
    'lang.name.ru': 'Russian',
    'pool.edit': 'Edit/Create question',
    'pool.lockedLogin': 'ğŸ”’ Editor is locked. Please log in to edit.',
    'pool.lockedNoPerm': 'ğŸ”’ You do not have write access to this pool.',
    'pool.noPermission': 'You do not have write access to this pool.',
    'pool.unlock': 'Unlock editor',
    'pool.question': 'Question text',
    'pool.category': 'Category (optional)',
    'pool.explain': 'Explanation/Hint (optional)',
    'pool.answers': 'Answer options',
    'pool.addAnswer': '+ Add answer',
    'pool.answerHint': 'Mark correct with a checkbox. (Training/exam hides single vs multiple.)',
    'pool.new': 'New',
    'pool.save': 'Save',
    'pool.remove': 'Delete',
    'pool.bulk.title': 'Bulk import (below single edit)',
    'pool.bulk.paste': 'Paste (free text)',
    'pool.bulk.auto': 'Auto-detect correct:',
    'pool.bulk.auto.desc': 'Prefix',
    'pool.bulk.auto.or': 'or',
    'pool.bulk.auto.ok': 'â†’ correct.',
    'pool.bulk.sep': 'Separate questions with',
    'pool.bulk.cat': 'Category (optional, for all new)',
    'pool.bulk.preview': 'Generate preview',
    'pool.bulk.import': 'Import into current pool',
    'pool.bulk.previewLabel': 'Preview',
    'pool.bulk.previewEmpty': 'No preview yet.',
    'pool.list': 'Existing questions (active pool)',
    'data.title': 'Data management',
    'data.exportTitle': 'Create backup',
    'data.exportAll': 'Export all pools',
    'data.download': 'Download',
    'data.backupDesc': 'Backs up all pools incl. stats & learning boxes as JSON.',
    'data.importTitle': 'Restore backup',
    'data.importAll': 'Import all pools',
    'data.importDesc': 'Select a JSON file and import.',
    'data.dangerTitle': 'Warning',
    'data.dangerDesc': 'â€œDelete allâ€ removes all pools and stats permanently.',
    'data.wipeAll': 'Delete all',
    'data.server': 'Server datasets',
    'data.serverHint': 'Import datasets directly from server.',
    'data.serverHintAudit': 'A strict audit runs before import. If it fails, the import is blocked.',
    'data.dataset.new': 'Import as new pool',
    'data.dataset.append': 'Append to active pool',
    'data.defaultImport': 'Loading initial datasetsâ€¦',
    'gate.title': 'Choose Profile',
    'gate.subtitle': 'Ready to test your knowledge? Earn XP, challenge friends, and become an expert.',
    'gate.title': 'Welcome',
    'gate.subtitle': 'Ready to test your knowledge? Earn XP, challenge friends, and become an expert.',
    'gate.disclaimer': 'Private project for training purposes. No guarantee of error-free operation.',
    'gate.account.title': 'Account',
    'gate.account.subtitle': 'Login or create a new account.',
    'gate.login.identifier': 'Username or email',
    'gate.login.password': 'Password',
    'gate.login.btn': 'Login',
    'gate.forgot.link': 'Forgot password?',
    'gate.forgot.email': 'Email',
    'gate.forgot.btn': 'Send reset link',
    'gate.forgot.needEmail': 'Please enter your email.',
    'gate.forgot.sent': 'If an account exists, a link was sent.',
    'gate.reset.password': 'New password',
    'gate.reset.password2': 'Confirm password',
    'gate.reset.btn': 'Set password',
    'gate.reset.needPw': 'Please enter both passwords.',
    'gate.reset.noMatch': 'Passwords do not match.',
    'gate.reset.noToken': 'Reset token missing.',
    'gate.reset.ok': 'Password set. Please log in.',
    'gate.reset.err': 'Reset failed.',
    'gate.register.title': 'Create account',
    'gate.register.username': 'Username',
    'gate.register.email': 'Email',
    'gate.register.password': 'Password',
    'gate.register.password2': 'Repeat password',
    'gate.register.btn': 'Create account',
    'gate.register.link': 'Create account',
    'gate.register.success': 'Account created. Please sign in now.',
    'gate.login.link': 'Back to login',
    'about.openStart': 'Open start page',
    'account.title': 'Account',
    'account.logout': 'Logout',
    'account.note': 'Here you can later change your password, delete the account, or enable 2FA.',
    'account.leaderboardOptIn': 'Show in leaderboards',
    'account.displayName': 'Display name',
    'account.save': 'Save',
    'account.saveOk': 'Settings saved.',
    'account.saveErr': 'Save failed.',
    'account.prefsTitle': 'Pools',
    'account.langCurrent': 'Active language',
    'account.langEnableEn': 'Enable English',
    'account.langEnableRu': 'Enable Russian',
    'account.langHint': 'Change the language in the top-right. Pools are grouped per area.',
    'account.poolHint': 'Choose the pool groups you want to use.',
    'review.title': 'Wrong Answers & Later List',
    'review.poolLabel': 'Pool',
    'review.refresh': 'Refresh',
    'review.resetHidden': 'Show hidden',
    'review.hint': 'Shows your wrong answers (last 48h) and the â€œLearn laterâ€ list.',
    'review.wrongTitle': 'Wrong answers (48h)',
    'review.wrongEmpty': 'No wrong answers.',
    'review.laterTitle': 'Learn later',
    'review.laterEmpty': 'No questions marked.',
    'review.actionLater': 'Mark for later',
    'review.actionUnmark': 'Unmark',
    'review.actionHide': 'Hide',
    'review.actionHiddenInfo': 'Hidden (local)',
    'review.loginRequired': 'Please log in.',
    'review.resetPool': 'Reset pool stats',
    'review.resetPoolConfirm': 'This clears training stats, learning boxes, and â€œLearn laterâ€ for the active pool. Continue?',
    'review.resetPoolOk': 'Pool stats reset.',
    'review.resetPoolErr': 'Reset failed.',
    'account.poolEmpty': 'No pools available.',
    'account.poolSelected': 'Selected pools',
    'account.poolMore': 'Show more pools',
    'account.langDisabled': 'This language is not enabled in your account.',
    'account.prefsApply': 'Apply',
    'account.prefsReset': 'Reset to defaults',
    'account.prefsReload': 'Reload',
    'account.prefsApplied': 'Settings applied.',
    'account.statsTitle': 'My Statistics',
    'account.statsLoading': 'Loading statisticsâ€¦',
    'account.statTotalAnswered': 'Answered',
    'account.statAccuracy': 'Correct',
    'account.statActiveDays': 'Active days',
    'account.statWrong': 'Wrong',
    'account.statExams': 'Exams',
    'account.statMemberSince': 'Member since',
    'account.statTopPools': 'Top Pools',
    'account.statLastActive': 'Last active',
    'account.statTopPoolsEmpty': 'No activity yet.',
    'account.statLoadErr': 'Failed to load statistics.',
    'account.examStats': 'Exam history',
    'gamify.title': 'Gamification',
    'gamify.xp': 'XP',
    'gamify.level': 'Level',
    'gamify.streakDaily': 'Daily streak',
    'gamify.streakWeekly': 'Weekly streak',
    'gamify.streakHint': 'Daily: 10 answers Â· Weekly: 4 active days (local time)',
    'gamify.levelHint': 'Level 0 Â· 0/10 XP',
    'gamify.levelPrefix': 'Level',
    'gamify.lastAward': 'Last XP award',
    'gamify.badges': 'Badges',
    'gamify.badgesEmpty': 'No badges earned yet.',
    'badge.erste_100': 'First 100 correct',
    'badge.konsequent': '7â€‘day streak',
    'badge.pruefungssicher': '3 exams â‰¥80%',
    'gamify.refresh': 'Refresh',
    'leaderboard.title': 'Leaderboards',
    'leaderboard.note': 'Only optâ€‘in users are shown.',
    'leaderboard.xp': 'Global score',
    'leaderboard.streak': 'Weekly score',
    'leaderboard.pool': 'Pool score (active pool)',
    'leaderboard.poolEmpty': 'No active pool.',
    'leaderboard.empty': 'No entries yet.',
    'leaderboard.error': 'Could not load.',
    'leaderboard.login': 'Please log in to view leaderboards.',
    'leaderboard.anon': 'Unknown',
    'modal.title': 'Notice',
    'modal.ok': 'OK',
    'account.examEmpty': 'No exams yet.',
    'account.examSummary': 'Result',
    'account.examWrong': 'Wrong',
    'account.examMarkWrong': 'Mark wrong',
    'account.examMarked': 'Marked for later:',
    'account.examError': 'Exam history could not be loaded.',
    'footer.credits': 'PrÃ¼fungstrainer v42.0 â€¢ GPLâ€‘3.0 â€¢ APIâ€‘based â€¢ Made with â¤ï¸ â€¢ Credits: Andre Stiebitz',
    'impressum.title': 'Imprint',
    'impressum.subtitle': 'Information in accordance with Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Email: <a href="mailto:contact@example.com">contact@example.com</a>',
    'impressum.privacyTitle': 'Privacy Notice (GDPR)',
    'impressum.privacy.li1': 'Personal data: Username, email address (on registration) and learning progress are stored on the server.',
    'impressum.privacy.li2': 'Purpose: Providing the learning platform, storing learning progress, account management.',
    'impressum.privacy.li3': 'Legal basis: Consent (Art. 6(1)(a) GDPR) through registration.',
    'impressum.privacy.li4': 'Retention: Data is stored as long as your account exists. Deletion on request via email.',
    'impressum.privacy.li5': 'No sharing with third parties. No tracking cookies, no analytics tools.',
    'impressum.privacy.li6': 'Your rights: Access, rectification, erasure, restriction, data portability, and objection. Contact: contact@example.com',
    'impressum.privacy.li7': 'Hosting: Server in Germany.',
    'impressum.infoTitle': 'Info & License (GPLâ€‘3.0)',
    'impressum.info.li1': 'Singleâ€‘page app with server API, 6 modes: Training, Exam, Swipe, Learning Boxes, Duels, Community.',
    'impressum.info.li2': 'Pools, learning box status and stats are stored per account on the server.',
    'impressum.info.li3': 'Import/export as JSON. AIâ€‘powered pool creation available.',
    'impressum.info.li4': '3 languages (DE/EN/RU) â€” UI and questions individually switchable.',
    'impressum.info.li5': 'Images in questions are supported.',
    'impressum.licenseNote': 'License: GPLâ€‘3.0.',
    'impressum.quote': 'The mere possession of knowledge is not enough; the ability to use knowledge is what matters.',
    'impressum.vibeNote': 'You can build amazing things today even without a web design degree â€” I\'m living proof. When something\'s stuck: think for yourself first, then bring in the second brain. Feedback that\'s personal or constructive goes straight to the thank-you folder.',
    'help.title': 'Help & Guide',
    'help.overview.title': 'Quick overview',
    'help.overview.li1': 'Training = free practice, Swipe = swipe quiz (True/False), Speedrun = time trial (1/5/10 min), Exam = simulated tests, Learning Boxes = flashcards.',
    'help.overview.li2': 'All progress (stats, learning boxes, wrong/later) is stored per account.',
    'help.overview.li3': 'Question pools are the basis for all modes. Each question can be toggled between languages (DE/EN/RU) individually.',
    'help.hotkeys.title': 'Hotkeys',
    'help.hotkeys.train': 'Training: â†/â†’ or N/P Â· 1â€“9/0 toggle Â· C check Â· Enter next',
    'help.hotkeys.exam': 'Exam: â†/â†’ or N/P Â· 1â€“9/0 toggle Â· Enter next',
    'help.hotkeys.swipe': 'Swipe & Speedrun: â†’ or R = True Â· â† or L = False Â· Space = Next',
    'help.training.title': 'Training',
    'help.training.li1': 'One question per view; answers can be shuffled.',
    'help.training.li2': '"Check answer" shows correct/incorrect and optional explanation.',
    'help.training.li3': '"Wrong only (48h)" and "Learn later" filter the list.',
    'help.training.li4': 'Use â­ to mark questions for later.',
    'help.exam.title': 'Exam',
    'help.exam.li1': 'Choose number of questions and time limit, then start.',
    'help.exam.li2': 'Navigator shows all questions; answered are marked.',
    'help.exam.li3': 'The exam auto-submits once all questions are answered.',
    'help.exam.li4': 'With timer active, an orange fuse runs around the exam panel â€” answer all questions before time expires to defuse the bomb! ğŸ’£',
    'help.exam.li5': 'In exam statistics (Account tab) you can repeat or delete old exams.',
    'help.swipe.title': 'Swipe Mode',
    'help.swipe.li1': 'Tinderâ€‘style swipe quiz: read the statement, swipe right (True) or left (False).',
    'help.swipe.li2': 'After swiping, the card flips to show the explanation. You control the pace â€” tap "Next" when ready.',
    'help.swipe.li3': 'On the card back you can add the question directly to your learning box.',
    'help.swipe.li4': 'Keyboard: â†’/R = True, â†/L = False, Space = Next. Touch: swipe or buttons.',
    'help.swipe.li5': 'Swipe pools are identified by the "Swipe:" prefix in the pool name.',
    'help.speedrun.title': 'Speedrun Mode',
    'help.speedrun.li1': 'Time trial in Swipe tab: Choose 1, 5, or 10 minutes and collect as many correct answers as possible.',
    'help.speedrun.li2': 'No explanations â€” just quick feedback (âœ…/âŒ), then next question immediately.',
    'help.speedrun.li3': 'An orange fuse runs around the panel showing remaining time. At 0:00 the race ends automatically.',
    'help.speedrun.li4': 'If you answer all questions before time expires, you defuse the speedrun bomb! ğŸ’£',
    'help.speedrun.li5': 'Your best scores and stats are in the Community tab, along with leaderboards for each duration.',
    'help.leitner.title': 'Learning Boxes',
    'help.leitner.li1': 'Create a learningâ€‘box set (pool + mode) and select it.',
    'help.leitner.li2': '"Simple" = no due dates, "Classic" = schedule (1/2/5/8/14 days).',
    'help.leitner.li3': 'Click a box to study it. Correct = one box forward, wrong = one box back.',
    'help.community.title': 'Community',
    'help.community.li1': 'Community tab shows progress, badges, and leaderboards.',
    'help.community.li2': 'Friends: all users are automatically friends.',
    'help.community.li3': 'Duels: challenge a friend or start a quick duel and accept invites.',
    'help.community.li4': 'Results show correctness + time; XP is granted automatically.',
    'help.community.li5': 'Leaderboards show only users with optâ€‘in (Account tab).',
    'help.review.title': 'Wrong & Later list',
    'help.review.li1': 'In Account you find "Wrong (48h)" and "Learn later".',
    'help.review.li2': 'Lists are pool-based and can be cleaned there.',
    'help.pools.title': 'Pools & Editor',
    'help.pools.li1': 'Training/Exam/Swipe/Learning boxes use the currently selected pool.',
    'help.pools.li2': 'In the editor you can create, edit, and delete questions.',
    'help.pools.li3': '"Bulk import" or "AI Pool" to create new pools.',
    'help.import.title': 'Import/Export',
    'help.import.li1': '"Export pool" or "Export all pools" for backups.',
    'help.import.li2': 'Server datasets can be imported directly.',
    'help.lang.title': 'Language',
    'help.lang.li1': 'The UI language (icon topâ€‘right) changes only the interface.',
    'help.lang.li2': 'Each question has a language toggle (DE/EN/RU buttons) to switch the translation directly on the question.',
    'help.lang.li3': 'Pools contain all language variants â€” no pool switching needed.',
    'help.admin.title': 'Editor access',
    'help.admin.li1': 'To edit, import or delete, you must be logged in.',
    'impressum.subtitle': 'Information per Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Email: <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'impressum.short': '[Your Name] Â· [Your Address] Â· [Your City, Postal Code] Â· <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'api.title': 'API connection',
    'api.label': 'API URL',
    'api.save': 'Save',
    'api.test': 'Test',
    'api.hint': 'Default is same domain with /api.',
    'profile.label': 'Profile',
    'aria.langMenu': 'Switch language',
    'aria.textSize': 'Change text size',
    'aria.accountOpen': 'Open account',
    'aria.infoTrain': 'Hotkeys and tips',
    'aria.infoExam': 'Tips and hotkeys',
    'aria.infoLeitner': 'Tips',
    'theme.title': 'Toggle light/dark',
    'nav.toggle': 'Toggle menu'
  },
  ru: {
    'nav.train': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°',
    'nav.swipe': 'Ğ¡Ğ²Ğ°Ğ¹Ğ¿',
    'nav.speedrun': 'Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½',
    'nav.exam': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½',
    'nav.leitner': 'Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    'speedrun.title': 'âš¡ Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½',
    'speedrun.subtitle': 'ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ·Ğ° Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸',
    'speedrun.pool': 'ĞĞ°Ğ±Ğ¾Ñ€',
    'speedrun.duration': 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ',
    'speedrun.start': 'Ğ¡Ñ‚Ğ°Ñ€Ñ‚',
    'speedrun.done': 'Ğ’Ñ€ĞµĞ¼Ñ Ğ¸ÑÑ‚ĞµĞºĞ»Ğ¾!',
    'speedrun.restart': 'Ğ•Ñ‰Ğµ Ñ€Ğ°Ğ·',
    'speedrun.statsTitle': 'ĞœĞ¾Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ¿Ğ¸Ğ´Ñ€Ğ°Ğ½Ğ°',
    'speedrun.leaderboardTitle': 'Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²',
    'speedrun.abortConfirm': 'Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸Ğ´Ñ€Ğ°Ğ½?',
    'speedrun.aborted': 'Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½ Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½',
    'nav.community': 'Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾',
    'nav.pool': 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²',
    'nav.data': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚',
    'nav.about': 'Impressum',
    'nav.help': 'ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ',
    'nav.account': 'Account',
    'modal.confirm': 'ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ',
    'modal.cancel': 'ĞÑ‚Ğ¼ĞµĞ½Ğ°',
    'community.progressTitle': 'ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ',
    'community.badgesTitle': 'ĞœĞ¾Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹',
    'community.leaderboardsTitle': 'Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²',
    'community.contestsTitle': 'Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ',
    'community.contestLeaderboardTitle': 'Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ ÑĞ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ',
    'community.contestsEmpty': 'ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¸Ğ»Ğ¸ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ñ… ÑĞ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹.',
    'community.contestJoin': 'Ğ£Ñ‡Ğ°ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ',
    'community.contestJoined': 'Ğ£Ñ‡Ğ°ÑÑ‚Ğ¸Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾.',
    'community.contestView': 'Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³',
    'community.contestStarts': 'Ğ¡Ñ‚Ğ°Ñ€Ñ‚',
    'community.contestEnds': 'Ğ¤Ğ¸Ğ½Ğ¸Ñˆ',
    'community.contestStatusActive': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾',
    'community.contestStatusUpcoming': 'Ğ¡ĞºĞ¾Ñ€Ğ¾',
    'community.contestStatusEnded': 'Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾',
    'community.contestNoEntries': 'ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ².',
    'community.contestPool': 'ĞŸÑƒĞ»',
    'community.contestGlobal': 'Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾',
    'community.friendsTitle': 'Ğ”Ñ€ÑƒĞ·ÑŒÑ',
    'community.friendsAuto': 'Ğ’ÑĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ² Ğ´Ñ€ÑƒĞ·ÑŒÑÑ….',
    'community.friendsList': 'ĞœĞ¾Ğ¸ Ğ´Ñ€ÑƒĞ·ÑŒÑ',
    'community.friendLevel': 'Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ',
    'community.friendLastActive': 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ',
    'community.friendsEmpty': 'Ğ”Ñ€ÑƒĞ·ĞµĞ¹ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚.',
    'community.friendLoadErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ·ĞµĞ¹.',
    'community.duelsTitle': 'Ğ”ÑƒÑĞ»Ğ¸',
    'community.duelsCreate': 'ĞĞ¾Ğ²Ğ°Ñ Ğ´ÑƒÑĞ»ÑŒ',
    'community.duelsFriend': 'Ğ”Ñ€ÑƒĞ³',
    'community.duelsPool': 'ĞŸÑƒĞ»',
    'community.duelsCount': 'Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹',
    'community.duelsChallenge': 'Ğ’Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ',
    'community.duelsQuick': 'Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ´ÑƒÑĞ»ÑŒ',
    'community.duelsHint': 'Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ´ÑƒÑĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑƒÑ Ğ´ÑƒÑĞ»ÑŒ.',
    'community.duelsIncoming': 'Ğ’Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ',
    'community.duelsActive': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ´ÑƒÑĞ»Ğ¸',
    'community.duelsFinished': 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹',
    'community.duelsReset': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ´ÑƒÑĞ»Ğ¸',
    'community.duelsResetConfirm': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ²Ğ°ÑˆĞ¸ Ğ´ÑƒÑĞ»Ğ¸? Ğ­Ñ‚Ğ¾ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.',
    'community.duelsResetDone': 'Ğ”ÑƒÑĞ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹.',
    'community.duelsResetErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ´ÑƒÑĞ»Ğ¸:',
    'community.duelsExit': 'ĞĞ°Ğ·Ğ°Ğ´',
    'community.duelsAnswer': 'ĞÑ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ',
    'community.duelsNext': 'Ğ”Ğ°Ğ»ĞµĞµ',
    'community.duelsPlay': 'Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ',
    'community.duelsView': 'Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸',
    'community.duelsDelete': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ',
    'community.duelsDeleteConfirm': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ğ´ÑƒÑĞ»ÑŒ?',
    'community.duelsAccept': 'ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ',
    'community.duelsIncomingEmpty': 'ĞĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ´ÑƒÑĞ»ĞµĞ¹.',
    'community.duelsActiveEmpty': 'ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ´ÑƒÑĞ»ĞµĞ¹.',
    'community.duelsFinishedEmpty': 'ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ².',
    'community.duelsCreated': 'Ğ”ÑƒÑĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°.',
    'community.duelsOpenCreated': 'ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ°Ñ Ğ´ÑƒÑĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°.',
    'community.duelsCreateErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´ÑƒÑĞ»ÑŒ:',
    'community.duelsNoFriend': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ°.',
    'community.duelsNoFriends': 'ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ´Ñ€ÑƒĞ·ĞµĞ¹.',
    'community.duelsNoPool': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿ÑƒĞ».',
    'community.duelsNeedAnswer': 'Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚.',
    'community.duelsCorrect': 'Ğ’ĞµÑ€Ğ½Ğ¾!',
    'community.duelsWrong': 'ĞĞµĞ²ĞµÑ€Ğ½Ğ¾.',
    'community.duelsAnswerErr': 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:',
    'community.duelsLoadErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´ÑƒÑĞ»Ğ¸.',
    'community.duelsOpponent': 'Ğ¡Ğ¾Ğ¿ĞµÑ€Ğ½Ğ¸Ğº:',
    'community.duelsOpponentUnknown': 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾',
    'community.duelsOpponentShort': 'Ğ¡Ğ¾Ğ¿ĞµÑ€Ğ½Ğ¸Ğº',
    'community.duelsYou': 'Ğ’Ñ‹',
    'community.duelsClose': 'Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ',
    'community.duelsWaiting': 'ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¿ĞµÑ€Ğ½Ğ¸ĞºĞ°â€¦',
    'community.duelsWin': 'ĞŸĞ¾Ğ±ĞµĞ´Ğ°',
    'community.duelsLose': 'ĞŸĞ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
    'community.duelsDraw': 'ĞĞ¸Ñ‡ÑŒÑ',
    'community.duelStatus.waiting': 'ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ',
    'community.duelStatus.active': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾',
    'community.duelStatus.finished': 'Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾',
    'community.duelStatus.expired': 'Ğ˜ÑÑ‚ĞµĞºĞ»Ğ¾',
    'time.justNow': 'Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾',
    'time.minutesAgo': '{n} Ğ¼Ğ¸Ğ½ Ğ½Ğ°Ğ·Ğ°Ğ´',
    'time.hoursAgo': '{n} Ñ‡ Ğ½Ğ°Ğ·Ğ°Ğ´',
    'time.daysAgo': '{n} Ğ´Ğ½ Ğ½Ğ°Ğ·Ğ°Ğ´',
    'badge.earned': 'ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾',
    'badge.locked': 'Ğ•Ñ‰Ğµ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾',
    'badge.none': 'ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹.',
    'label.activePool': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²',
    'train.title': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° â€” Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑƒ',
    'train.activePool': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€:',
    'train.info': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒÂ». Â«Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ (48Ñ‡)Â» Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ·Ğ° 48Ñ‡. Â«ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Â» Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑĞ¾ â­. Ğ“Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸: â†/â†’, N/P, 1â€“9/0, C (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°), Enter (Ğ´Ğ°Ğ»ĞµĞµ).',
    'train.shuffle': 'Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾',
    'train.reset': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ',
    'train.wrongToggle': 'Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ (48Ñ‡)',
    'train.laterToggle': 'ĞÑ‚Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼',
    'train.laterMark': 'ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼',
    'train.empty': 'ĞĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ½Ğ°Ğ±Ğ¾Ñ€Ğµ.',
    'train.wrongEmpty': 'ĞĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 48 Ñ‡Ğ°ÑĞ¾Ğ².',
    'train.laterEmpty': 'ĞĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.',
    'train.explain': 'ĞŸĞ¾ÑÑĞ½ĞµĞ½Ğ¸Ğµ / Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°',
    'train.prev': 'ĞĞ°Ğ·Ğ°Ğ´',
    'train.check': 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚',
    'train.next': 'Ğ”Ğ°Ğ»ĞµĞµ',
    'swipe.title': 'Ğ¡Ğ²Ğ°Ğ¹Ğ¿-ĞšĞ²Ğ¸Ğ· â€” Ğ›Ğ¸ÑÑ‚Ğ°Ğ¹ Ğ¸ Ğ£Ñ‡Ğ¸ÑÑŒ',
    'swipe.hintLeft': 'â† Ğ›Ğ¾Ğ¶ÑŒ',
    'swipe.hintRight': 'ĞŸÑ€Ğ°Ğ²Ğ´Ğ° â†’',
    'swipe.true': 'âœ… ĞŸÑ€Ğ°Ğ²Ğ´Ğ°',
    'swipe.false': 'âŒ Ğ›Ğ¾Ğ¶ÑŒ',
    'swipe.correctMsg': 'Ğ’ĞµÑ€Ğ½Ğ¾!',
    'swipe.wrongMsg': 'ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾.',
    'swipe.next': 'Ğ”Ğ°Ğ»ĞµĞµ â†’',
    'swipe.addLeitner': 'ğŸ“š Ğ’ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸',
    'swipe.addedLeitner': 'âœ“ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾',
    'swipe.done': 'Ğ Ğ°ÑƒĞ½Ğ´ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½!',
    'swipe.restart': 'Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°',
    'swipe.total': 'Ğ²ÑĞµĞ³Ğ¾',
    'swipe.noPools': 'ĞĞµÑ‚ ÑĞ²Ğ°Ğ¹Ğ¿-Ğ¿ÑƒĞ»Ğ¾Ğ²',
    'exam.title': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½ (Ğ¿Ğ¾ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñƒ)',
    'exam.info': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½: Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸, Ğ·Ğ°Ñ‚ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‚. ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ‚Ğ¾Ñ€ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ; Ğ¾Ñ‚Ğ²ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¼ĞµÑ‡ĞµĞ½Ñ‹. Ğ“Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸: â†/â†’, N/P, 1â€“9/0, Enter (Ğ´Ğ°Ğ»ĞµĞµ), E (ÑĞ´Ğ°Ñ‚ÑŒ).',
    'exam.count': 'ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²',
    'exam.time': 'Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹, 0 = Ğ½ĞµÑ‚)',
    'exam.start': 'Ğ¡Ñ‚Ğ°Ñ€Ñ‚',
    'exam.prev': 'ĞĞ°Ğ·Ğ°Ğ´',
    'exam.next': 'Ğ”Ğ°Ğ»ĞµĞµ',
    'exam.submit': 'Ğ¡Ğ´Ğ°Ñ‚ÑŒ',
    'exam.answered': 'ĞÑ‚Ğ²ĞµÑ‡ĞµĞ½Ğ¾: 0',
    'exam.pool': 'ĞĞ°Ğ±Ğ¾Ñ€: â€“',
    'exam.answeredLabel': 'ĞÑ‚Ğ²ĞµÑ‡ĞµĞ½Ğ¾:',
    'exam.poolLabel': 'ĞĞ°Ğ±Ğ¾Ñ€:',
    'exam.focusMode': 'Ğ¤Ğ¾ĞºÑƒÑ',
    'exam.focusModeExit': 'Ğ’Ñ‹Ñ…Ğ¾Ğ´',
    'exam.abortConfirm': 'Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ñ‚ÑŒ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½?',
    'exam.aborted': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½ Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½',
    'leitner.title': 'Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ â€” Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹ Ğ¿Ğ¾ Ğ¿ÑƒĞ»Ñƒ',
    'leitner.due': 'Ğ”Ğ²Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°: Â«ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹Â» Ğ±ĞµĞ· ÑÑ€Ğ¾ĞºĞ¾Ğ² Ğ¸ Â«ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹Â» Ñ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ (ÑÑ‰Ğ¸Ğº 1/2/3/4/5 = 1/2/5/8/14 Ğ´Ğ½ĞµĞ¹).',
    'leitner.guide': 'ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾:\n1) ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ»ĞµĞ¶Ğ¸Ñ‚ Ğ² ÑÑ‰Ğ¸ĞºĞµ (1â€“5). Ğ¯Ñ‰Ğ¸Ğº 1 = Ğ½Ğ¾Ğ²Ğ¾Ğµ/ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğµ, ÑÑ‰Ğ¸Ğº 5 = Ğ¾Ñ‡ĞµĞ½ÑŒ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾.\n2) Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€ (Ğ¿ÑƒĞ» + Ñ€ĞµĞ¶Ğ¸Ğ¼).\n3) ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° ÑÑ‰Ğ¸Ğº â€” ÑƒÑ‡Ğ¸Ñ‚Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµĞ³Ğ¾.\n4) ĞÑ‚Ğ²ĞµÑ‚ â†’ Â«Ğ”Ğ°Ğ»ÑŒÑˆĞµÂ». Ğ’ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ²Ğ¿ĞµÑ€ĞµĞ´, Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ½Ğ°Ğ·Ğ°Ğ´.\n5) Â«ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒÂ» Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ ÑÑ‰Ğ¸ĞºĞµ.',
    'leitner.infoTitle': 'Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ â€” ĞºĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚',
    'leitner.info': 'Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ â€” ÑÑ‚Ğ¾ 5 ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹. Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€ (Ğ¿ÑƒĞ» + Ñ€ĞµĞ¶Ğ¸Ğ¼), Ğ·Ğ°Ñ‚ĞµĞ¼ ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ ÑÑ‰Ğ¸ĞºĞ°Ğ¼.\n\nĞ ĞµĞ¶Ğ¸Ğ¼ Â«ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹Â»:\n- Ğ‘ĞµĞ· ÑÑ€Ğ¾ĞºĞ¾Ğ². Ğ’ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ°.\n- Ğ’ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ²Ğ¿ĞµÑ€ĞµĞ´, Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ½Ğ°Ğ·Ğ°Ğ´.\n\nĞ ĞµĞ¶Ğ¸Ğ¼ Â«ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹Â»:\n- Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ÑÑ‚ÑÑ Â«Ğ¿Ğ¾ ÑÑ€Ğ¾ĞºÑƒÂ» Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ.\n- Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹ (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾): ÑÑ‰Ğ¸Ğº 1/2/3/4/5 = 1/2/5/8/14 Ğ´Ğ½ĞµĞ¹.\n- ĞŸĞ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ ÑÑ€Ğ¾ĞºÑƒ.\n\nĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:\n1) Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€ â†’ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ÑÑ‰Ğ¸Ğº.\n2) ĞÑ‚Ğ²ĞµÑ‚ â†’ Â«Ğ”Ğ°Ğ»ÑŒÑˆĞµÂ».\n3) Â«ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒÂ» Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ ÑÑ‰Ğ¸ĞºĞµ.',
    'leitner.allSelected': 'Ğ’ÑĞµ Ğ¸Ğ· Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°',
    'leitner.reset': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    'leitner.resetConfirm': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€ ÑÑ‰Ğ¸ĞºĞ¾Ğ²?',
    'leitner.resetOk': 'ĞĞ°Ğ±Ğ¾Ñ€ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½.',
    'leitner.resetErr': 'Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ:',
    'leitner.setLabel': 'ĞĞ°Ğ±Ğ¾Ñ€ ÑÑ‰Ğ¸ĞºĞ¾Ğ²',
    'leitner.setMode': 'Ğ ĞµĞ¶Ğ¸Ğ¼',
    'leitner.setName': 'ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ',
    'leitner.setPool': 'ĞŸÑƒĞ»',
    'leitner.setModeSelect': 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼',
    'leitner.setCreate': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'leitner.setsTitle': 'ĞĞ°Ğ±Ğ¾Ñ€Ñ‹ ÑƒÑ‡ĞµĞ±Ğ½Ñ‹Ñ… ÑÑ‰Ğ¸ĞºĞ¾Ğ²',
    'leitner.setsEmpty': 'ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒÑ‡ĞµĞ±Ğ½Ñ‹Ñ… ÑÑ‰Ğ¸ĞºĞ¾Ğ².',
    'leitner.setDelete': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'leitner.setDeleteConfirm': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€?',
    'leitner.setDeleteErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€:',
    'leitner.setCreateErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€:',
    'leitner.setNameNeed': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ.',
    'leitner.setPoolNeed': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿ÑƒĞ».',
    'leitner.setEmpty': 'ĞĞ°Ğ±Ğ¾Ñ€Ñ‹ ĞµÑ‰Ñ‘ Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹.',
    'leitner.setMissing': 'Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€.',
    'leitner.modeSimple': 'ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ (Ğ±ĞµĞ· ÑÑ€Ğ¾ĞºĞ¾Ğ²)',
    'leitner.modeClassic': 'ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ (Ğ¿Ğ¾ ÑÑ€Ğ¾ĞºÑƒ)',
    'leitner.modeSimpleShort': 'ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹',
    'leitner.modeClassicShort': 'ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹',
    'leitner.multiHint': 'ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ: Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶ĞµĞ½ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€.',
    'leitner.next': 'Ğ”Ğ°Ğ»ÑŒÑˆĞµ',
    'leitner.needAnswer': 'Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚.',
    'leitner.skip': 'ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ',
    'leitner.poolEmpty': 'ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ.',
    'leitner.dueEmpty': 'ĞĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ğ¾ ÑÑ€Ğ¾ĞºÑƒ Ğ² Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ.',
    'leitner.setEmptyHint': 'Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€.',
    'question.translationUnavailable': 'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.',
    'pool.title': 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°Ğ¼Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²',
    'pool.select': 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'pool.name': 'ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°',
    'pool.create': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ',
    'pool.delete': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'pool.export': 'Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°',
    'pool.import': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°',
    'pool.importCsv': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ CSV',
    'pool.desc': 'Ğ£ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° ÑĞ²Ğ¾Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, ÑÑ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°.',
    'pool.aiPrompt': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ AIâ€‘Ğ¿ÑƒĞ»',
    'pool.aiPromptTip': 'ĞŸĞ¾Ñ€ÑƒÑ‡Ğ¸ Ğ˜Ğ˜ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚.',
    'pool.noneForLang': 'ĞĞµÑ‚ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°.',
    'lang.originalPrefix': 'Ğ¯Ğ·Ñ‹Ğº Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°',
    'lang.name.de': 'ĞĞµĞ¼ĞµÑ†ĞºĞ¸Ğ¹',
    'lang.name.en': 'ĞĞ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹',
    'lang.name.ru': 'Ğ ÑƒÑÑĞºĞ¸Ğ¹',
    'pool.edit': 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ/ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ',
    'pool.lockedLogin': 'ğŸ”’ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ.',
    'pool.lockedNoPerm': 'ğŸ”’ ĞĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ÑƒĞ»Ğ°.',
    'pool.noPermission': 'ĞĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ÑƒĞ»Ğ°.',
    'pool.unlock': 'Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€',
    'pool.question': 'Ğ¢ĞµĞºÑÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°',
    'pool.category': 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)',
    'pool.explain': 'ĞŸĞ¾ÑÑĞ½ĞµĞ½Ğ¸Ğµ/Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)',
    'pool.answers': 'Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²',
    'pool.addAnswer': '+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚',
    'pool.answerHint': 'ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‡ĞµĞºĞ±Ğ¾ĞºÑĞ¾Ğ¼. (Ğ’ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞµ/ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ğµ Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ½Ğ¾, Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾.)',
    'pool.new': 'ĞĞ¾Ğ²Ñ‹Ğ¹',
    'pool.save': 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ',
    'pool.remove': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ',
    'pool.bulk.title': 'ĞŸĞ°ĞºĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ (Ğ½Ğ¸Ğ¶Ğµ Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)',
    'pool.bulk.paste': 'Ğ’ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ (ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚)',
    'pool.bulk.auto': 'ĞĞ²Ñ‚Ğ¾-Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…:',
    'pool.bulk.auto.desc': 'ĞŸÑ€ĞµÑ„Ğ¸ĞºÑ',
    'pool.bulk.auto.or': 'Ğ¸Ğ»Ğ¸',
    'pool.bulk.auto.ok': 'â†’ Ğ²ĞµÑ€Ğ½Ğ¾.',
    'pool.bulk.sep': 'Ğ Ğ°Ğ·Ğ´ĞµĞ»ÑĞ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ¹',
    'pool.bulk.cat': 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ²Ñ‹Ñ…)',
    'pool.bulk.preview': 'Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€',
    'pool.bulk.import': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ² Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'pool.bulk.previewLabel': 'ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€',
    'pool.bulk.previewEmpty': 'ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚.',
    'pool.list': 'Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€)',
    'data.title': 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸',
    'data.exportTitle': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ',
    'data.exportAll': 'Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ²',
    'data.download': 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ',
    'data.backupDesc': 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ²ÑĞµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¸ ÑÑ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ² JSON.',
    'data.importTitle': 'Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ',
    'data.importAll': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ²',
    'data.importDesc': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ JSONâ€‘Ñ„Ğ°Ğ¹Ğ» Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ.',
    'data.dangerTitle': 'Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ',
    'data.dangerDesc': 'Â«Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘Â» ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ Ğ²ÑĞµ Ğ¿ÑƒĞ»Ñ‹ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°.',
    'data.wipeAll': 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘',
    'data.server': 'Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ',
    'data.serverHint': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°.',
    'data.serverHintAudit': 'ĞŸĞµÑ€ĞµĞ´ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ¼ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°. ĞŸÑ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ÑÑ.',
    'data.dataset.new': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğº Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€',
    'data.dataset.append': 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼Ñƒ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñƒ',
    'data.defaultImport': 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ²â€¦',
    'gate.title': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ',
    'gate.subtitle': 'Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ? ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹ XP, Ğ±Ñ€Ğ¾ÑĞ°Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼ Ğ¸ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸ÑÑŒ ÑĞºÑĞ¿ĞµÑ€Ñ‚Ğ¾Ğ¼.',
    'gate.title': 'Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ',
    'gate.subtitle': 'Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ? ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹ XP, Ğ±Ñ€Ğ¾ÑĞ°Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼ Ğ¸ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸ÑÑŒ ÑĞºÑĞ¿ĞµÑ€Ñ‚Ğ¾Ğ¼.',
    'gate.disclaimer': 'Ğ§Ğ°ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ´Ğ»Ñ ÑƒÑ‡ĞµĞ±Ğ½Ñ‹Ñ… Ñ†ĞµĞ»ĞµĞ¹. Ğ‘ĞµĞ· Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾ÑˆĞ¸Ğ±Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹.',
    'gate.account.title': 'ĞĞºĞºĞ°ÑƒĞ½Ñ‚',
    'gate.account.subtitle': 'Ğ’Ñ…Ğ¾Ğ´ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°.',
    'gate.login.identifier': 'Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ»Ğ¸ eâ€‘mail',
    'gate.login.password': 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.login.btn': 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸',
    'gate.forgot.link': 'Ğ—Ğ°Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ?',
    'gate.forgot.email': 'Eâ€‘mail',
    'gate.forgot.btn': 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºÑƒ',
    'gate.forgot.needEmail': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ eâ€‘mail.',
    'gate.forgot.sent': 'Ğ•ÑĞ»Ğ¸ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, ÑÑÑ‹Ğ»ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ°.',
    'gate.reset.password': 'ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.reset.password2': 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.reset.btn': 'Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.reset.needPw': 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ±Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ.',
    'gate.reset.noMatch': 'ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚.',
    'gate.reset.noToken': 'ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ ÑĞ±Ñ€Ğ¾ÑĞ°.',
    'gate.reset.ok': 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½. Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.',
    'gate.reset.err': 'Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ.',
    'gate.register.title': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚',
    'gate.register.username': 'Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ',
    'gate.register.email': 'Eâ€‘mail',
    'gate.register.password': 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.register.password2': 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ',
    'gate.register.btn': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚',
    'gate.register.link': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚',
    'gate.register.success': 'ĞĞºĞºĞ°ÑƒĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½. Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑĞµĞ¹Ñ‡Ğ°Ñ.',
    'gate.login.link': 'ĞĞ°Ğ·Ğ°Ğ´ ĞºĞ¾ Ğ²Ñ…Ğ¾Ğ´Ñƒ',
    'about.openStart': 'ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ',
    'account.title': 'Account',
    'account.logout': 'Logout',
    'account.note': 'Ğ—Ğ´ĞµÑÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¼ĞµĞ½Ğ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ, ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ° Ğ¸ 2FA.',
    'account.leaderboardOptIn': 'ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²',
    'account.displayName': 'ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¸Ğ¼Ñ',
    'account.save': 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ',
    'account.saveOk': 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹.',
    'account.saveErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ.',
    'account.prefsTitle': 'ĞŸÑƒĞ»Ñ‹',
    'account.langCurrent': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº',
    'account.langEnableEn': 'Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹',
    'account.langEnableRu': 'Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€ÑƒÑÑĞºĞ¸Ğ¹',
    'account.langHint': 'Ğ¯Ğ·Ñ‹Ğº Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ²Ğ²ĞµÑ€Ñ…Ñƒ ÑĞ¿Ñ€Ğ°Ğ²Ğ°. ĞŸÑƒĞ»Ñ‹ ÑĞ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°Ğ¼.',
    'account.poolHint': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿ÑƒĞ»Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ.',
    'review.title': 'ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼',
    'review.poolLabel': 'ĞŸÑƒĞ»',
    'review.refresh': 'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ',
    'review.resetHidden': 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ',
    'review.hint': 'Ğ—Ğ´ĞµÑÑŒ â€” Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 48Ñ‡) Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº Â«ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Â».',
    'review.wrongTitle': 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ (48Ñ‡)',
    'review.wrongEmpty': 'ĞĞµÑ‚ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ².',
    'review.laterTitle': 'ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼',
    'review.laterEmpty': 'ĞĞµÑ‚ Ğ¾Ñ‚Ğ¼ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².',
    'review.actionLater': 'ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼',
    'review.actionUnmark': 'Ğ¡Ğ½ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºÑƒ',
    'review.actionHide': 'Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ',
    'review.actionHiddenInfo': 'Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¾ (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)',
    'review.loginRequired': 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ.',
    'review.resetPool': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¿ÑƒĞ»Ğ°',
    'review.resetPoolConfirm': 'Ğ­Ñ‚Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ, ÑÑ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº â€œĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼â€ Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ğ¿ÑƒĞ»Ğµ. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?',
    'review.resetPoolOk': 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿ÑƒĞ»Ğ° ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ğ°.',
    'review.resetPoolErr': 'Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ.',
    'account.poolEmpty': 'ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ².',
    'account.poolSelected': 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹',
    'account.poolMore': 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ²',
    'account.langDisabled': 'Ğ­Ñ‚Ğ¾Ñ‚ ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğµ.',
    'account.prefsApply': 'ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ',
    'account.prefsReset': 'Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ',
    'account.prefsReload': 'ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ',
    'account.prefsApplied': 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹.',
    'account.statsTitle': 'ĞœĞ¾Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°',
    'account.statsLoading': 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸â€¦',
    'account.statTotalAnswered': 'ĞÑ‚Ğ²ĞµÑ‡ĞµĞ½Ğ¾',
    'account.statAccuracy': 'ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾',
    'account.statActiveDays': 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ´Ğ½ĞµĞ¹',
    'account.statWrong': 'ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾',
    'account.statExams': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½Ñ‹',
    'account.statMemberSince': 'Ğ¡ Ğ½Ğ°Ğ¼Ğ¸ Ñ',
    'account.statTopPools': 'Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹',
    'account.statLastActive': 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ',
    'account.statTopPoolsEmpty': 'ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸.',
    'account.statLoadErr': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ.',
    'account.examStats': 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ğ¾Ğ²',
    'gamify.title': 'Ğ“ĞµĞ¹Ğ¼Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ',
    'gamify.xp': 'XP',
    'gamify.level': 'Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ',
    'gamify.streakDaily': 'Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹',
    'gamify.streakWeekly': 'Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹',
    'gamify.streakHint': 'Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾: 10 Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Â· Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾: 4 Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ´Ğ½Ñ (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ)',
    'gamify.levelHint': 'Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 0 Â· 0/10 XP',
    'gamify.levelPrefix': 'Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ',
    'gamify.lastAward': 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ XP',
    'gamify.badges': 'ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹',
    'gamify.badgesEmpty': 'ĞĞ°Ğ³Ñ€Ğ°Ğ´ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚.',
    'badge.erste_100': 'ĞŸĞµÑ€Ğ²Ñ‹Ğµ 100 Ğ²ĞµÑ€Ğ½Ñ‹Ñ…',
    'badge.konsequent': 'Ğ¡ĞµÑ€Ğ¸Ñ 7 Ğ´Ğ½ĞµĞ¹',
    'badge.pruefungssicher': '3 ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ğ° â‰¥80%',
    'gamify.refresh': 'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ',
    'leaderboard.title': 'Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²',
    'leaderboard.note': 'ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ Ğ¾Ğ¿Ñ†Ğ¸ĞµĞ¹.',
    'leaderboard.xp': 'Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‡ĞµÑ‚',
    'leaderboard.streak': 'ĞĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‡Ñ‘Ñ‚',
    'leaderboard.pool': 'Ğ¡Ñ‡ĞµÑ‚ Ğ¿ÑƒĞ»Ğ° (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿ÑƒĞ»)',
    'leaderboard.poolEmpty': 'ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ÑƒĞ»Ğ°.',
    'leaderboard.empty': 'Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ½ĞµÑ‚.',
    'leaderboard.error': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ.',
    'leaderboard.login': 'Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ².',
    'leaderboard.anon': 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾',
    'modal.title': 'Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ',
    'modal.ok': 'ĞĞš',
    'account.examEmpty': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½Ñ‹ Ğ¿Ğ¾ĞºĞ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚.',
    'account.examSummary': 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
    'account.examWrong': 'ĞÑˆĞ¸Ğ±ĞºĞ¸',
    'account.examMarkWrong': 'ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸',
    'account.examMarked': 'ĞÑ‚Ğ¼ĞµÑ‡ĞµĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ°:',
    'account.examError': 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ñ‹.',
    'footer.credits': 'PrÃ¼fungstrainer v42.0 â€¢ GPLâ€‘3.0 â€¢ APIâ€‘Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ â€¢ Ğ¡Ğ´ĞµĞ»Ğ°Ğ½Ğ¾ Ñ â¤ï¸ â€¢ Credits: Andre Stiebitz',
    'impressum.title': 'Impressum',
    'impressum.subtitle': 'Ğ¡Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğ¸ Ñ Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Email: <a href="mailto:contact@example.com">contact@example.com</a>',
    'impressum.privacyTitle': 'Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (GDPR)',
    'impressum.privacy.li1': 'ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ğ¸Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, Ğ°Ğ´Ñ€ĞµÑ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‡Ñ‚Ñ‹ (Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸) Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ.',
    'impressum.privacy.li2': 'Ğ¦ĞµĞ»ÑŒ: Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑ‡ĞµĞ±Ğ½Ğ¾Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°, ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ¼.',
    'impressum.privacy.li3': 'ĞŸÑ€Ğ°Ğ²Ğ¾Ğ²Ğ°Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ°: ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¸Ğµ (ÑÑ‚. 6(1)(a) GDPR) Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ.',
    'impressum.privacy.li4': 'Ğ¡Ñ€Ğ¾Ğº Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ: Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ, Ğ¿Ğ¾ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ²Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ Ğ½Ğ° email.',
    'impressum.privacy.li5': 'Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ñ‚Ñ€ĞµÑ‚ÑŒĞ¸Ğ¼ Ğ»Ğ¸Ñ†Ğ°Ğ¼. ĞĞµÑ‚ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸Ñ… cookies, Ğ½ĞµÑ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ².',
    'impressum.privacy.li6': 'Ğ’Ğ°ÑˆĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°: Ğ´Ğ¾ÑÑ‚ÑƒĞ¿, Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ, ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ, Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ, Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ²Ğ¾Ğ·Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ. ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚: contact@example.com',
    'impressum.privacy.li7': 'Ğ¥Ğ¾ÑÑ‚Ğ¸Ğ½Ğ³: ÑĞµÑ€Ğ²ĞµÑ€ Ğ² Ğ“ĞµÑ€Ğ¼Ğ°Ğ½Ğ¸Ğ¸.',
    'impressum.infoTitle': 'Ğ˜Ğ½Ñ„Ğ¾ Ğ¸ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ (GPLâ€‘3.0)',
    'impressum.info.li1': 'ĞĞ´Ğ½Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ğ¼ API, 6 Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ²: Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°, Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½, Ğ¡Ğ²Ğ°Ğ¹Ğ¿, Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ, Ğ”ÑƒÑĞ»Ğ¸, Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾.',
    'impressum.info.li2': 'ĞŸÑƒĞ»Ñ‹, ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑÑ‰Ğ¸ĞºĞ¾Ğ² Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ¿Ğ¾ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼.',
    'impressum.info.li3': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² JSON. Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿ÑƒĞ»Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ˜Ğ˜.',
    'impressum.info.li4': '3 ÑĞ·Ñ‹ĞºĞ° (DE/EN/RU) â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.',
    'impressum.info.li5': 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°Ñ….',
    'impressum.licenseNote': 'Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ: GPLâ€‘3.0.',
    'impressum.quote': 'Ğ¡Ğ°Ğ¼Ğ¾ Ğ¿Ğ¾ ÑĞµĞ±Ğµ Ğ¾Ğ±Ğ»Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸ÑĞ¼Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾; Ğ²Ğ°Ğ¶Ğ½Ğ¾ ÑƒĞ¼ĞµĞ½Ğ¸Ğµ Ğ¸Ñ… Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑ‚ÑŒ.',
    'impressum.vibeNote': 'Ğ˜ Ğ±ĞµĞ· Ğ´Ğ¸Ğ¿Ğ»Ğ¾Ğ¼Ğ° Ğ²ĞµĞ±-Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ĞµÑ€Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑƒĞ´Ğ¸Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ â€” Ñ Ñ‚Ğ¾Ğ¼Ñƒ Ğ´Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾. ĞšĞ¾Ğ³Ğ´Ğ° Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ: ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ğ¾Ğ´ÑƒĞ¼Ğ°Ğ¹ ÑĞ°Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°Ğ¹ Ğ²Ñ‚Ğ¾Ñ€ÑƒÑ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñƒ. Ğ›Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¸ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ Ğ¸Ğ´Ñ‘Ñ‚ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ĞµĞ¹.',
    'help.title': 'ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¸ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾',
    'help.overview.title': 'ĞšÑ€Ğ°Ñ‚ĞºĞ¾',
    'help.overview.li1': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° = ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ°Ñ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°, Ğ¡Ğ²Ğ°Ğ¹Ğ¿ = Ğ²Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ° (Ğ’ĞµÑ€Ğ½Ğ¾/ĞĞµĞ²ĞµÑ€Ğ½Ğ¾), Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½ = Ğ³Ğ¾Ğ½ĞºĞ° Ğ½Ğ° Ğ²Ñ€ĞµĞ¼Ñ (1/5/10 Ğ¼Ğ¸Ğ½), Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½ = ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ, Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ = ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸.',
    'help.overview.li2': 'ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ (ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°, ÑÑ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸/Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼) Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ¿Ğ¾ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°Ğ¼.',
    'help.overview.li3': 'ĞŸÑƒĞ»Ñ‹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ° Ğ²ÑĞµÑ… Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ². ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ·Ñ‹ĞºĞ°Ğ¼Ğ¸ (DE/EN/RU) Ğ¿Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.',
    'help.hotkeys.title': 'Ğ“Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸',
    'help.hotkeys.train': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: â†/â†’ Ğ¸Ğ»Ğ¸ N/P Â· 1â€“9/0 Â· C Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Â· Enter Ğ´Ğ°Ğ»ĞµĞµ',
    'help.hotkeys.exam': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½: â†/â†’ Ğ¸Ğ»Ğ¸ N/P Â· 1â€“9/0 Â· Enter Ğ´Ğ°Ğ»ĞµĞµ',
    'help.hotkeys.swipe': 'Ğ¡Ğ²Ğ°Ğ¹Ğ¿ Ğ¸ Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½: â†’ Ğ¸Ğ»Ğ¸ R = Ğ’ĞµÑ€Ğ½Ğ¾ Â· â† Ğ¸Ğ»Ğ¸ L = ĞĞµĞ²ĞµÑ€Ğ½Ğ¾ Â· ĞŸÑ€Ğ¾Ğ±ĞµĞ» = Ğ”Ğ°Ğ»ĞµĞµ',
    'help.training.title': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°',
    'help.training.li1': 'ĞĞ´Ğ¸Ğ½ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½; Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒÑÑ.',
    'help.training.li2': 'Â«ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒÂ» Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²ĞµÑ€Ğ½Ğ¾/Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾ Ğ¸, Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸, Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ.',
    'help.training.li3': 'Â«Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ (48Ñ‡)Â» Ğ¸ Â«ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Â» Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒÑÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº.',
    'help.training.li4': 'Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ â­, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼.',
    'help.exam.title': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½',
    'help.exam.li1': 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸, Ğ·Ğ°Ñ‚ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‚.',
    'help.exam.li2': 'ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ‚Ğ¾Ñ€ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹; Ğ¾Ñ‚Ğ²ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ¼ĞµÑ‡ĞµĞ½Ñ‹.',
    'help.exam.li3': 'Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ´Ğ°ĞµÑ‚ÑÑ, ĞºĞ¾Ğ³Ğ´Ğ° Ğ²ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾Ñ‚Ğ²ĞµÑ‡ĞµĞ½Ñ‹.',
    'help.exam.li4': 'ĞŸÑ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€Ğµ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ğ° Ğ³Ğ¾Ñ€Ğ¸Ñ‚ Ğ¾Ñ€Ğ°Ğ½Ğ¶ĞµĞ²Ñ‹Ğ¹ ÑˆĞ½ÑƒÑ€ â€” Ğ¾Ñ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ Ğ½Ğ° Ğ²ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ¾ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ±ĞµĞ·Ğ²Ñ€ĞµĞ´Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ğ¼Ğ±Ñƒ! ğŸ’£',
    'help.exam.li5': 'Ğ’ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞµ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ğ¾Ğ² (Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ° Account) Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ ÑĞºĞ·Ğ°Ğ¼ĞµĞ½Ñ‹.',
    'help.swipe.title': 'Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¡Ğ²Ğ°Ğ¹Ğ¿',
    'help.swipe.li1': 'Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ° Ğ² ÑÑ‚Ğ¸Ğ»Ğµ Tinder: Ğ¿Ñ€Ğ¾Ñ‡Ñ‚Ğ¸Ñ‚Ğµ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ, ÑĞ²Ğ°Ğ¹Ğ¿Ğ½Ğ¸Ñ‚Ğµ Ğ²Ğ¿Ñ€Ğ°Ğ²Ğ¾ (Ğ’ĞµÑ€Ğ½Ğ¾) Ğ¸Ğ»Ğ¸ Ğ²Ğ»ĞµĞ²Ğ¾ (ĞĞµĞ²ĞµÑ€Ğ½Ğ¾).',
    'help.swipe.li2': 'ĞŸĞ¾ÑĞ»Ğµ ÑĞ²Ğ°Ğ¹Ğ¿Ğ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ. Ğ’Ñ‹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ñ‚ĞµĞ¼Ğ¿ â€” Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«Ğ”Ğ°Ğ»ĞµĞµÂ», ĞºĞ¾Ğ³Ğ´Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹.',
    'help.swipe.li3': 'ĞĞ° Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğµ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ² ÑÑ‰Ğ¸Ğº Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ.',
    'help.swipe.li4': 'ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°: â†’/R = Ğ’ĞµÑ€Ğ½Ğ¾, â†/L = ĞĞµĞ²ĞµÑ€Ğ½Ğ¾, ĞŸÑ€Ğ¾Ğ±ĞµĞ» = Ğ”Ğ°Ğ»ĞµĞµ. Ğ¢Ğ°Ñ‡: ÑĞ²Ğ°Ğ¹Ğ¿ Ğ¸Ğ»Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸.',
    'help.swipe.li5': 'Ğ¡Ğ²Ğ°Ğ¹Ğ¿â€‘Ğ¿ÑƒĞ»Ñ‹ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑƒ Â«Swipe:Â» Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ğ¿ÑƒĞ»Ğ°.',
    'help.speedrun.title': 'Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¡Ğ¿Ğ¸Ğ´Ñ€Ğ°Ğ½',
    'help.speedrun.li1': 'Ğ“Ğ¾Ğ½ĞºĞ° Ğ½Ğ° Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ğ¾ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ Ğ¡Ğ²Ğ°Ğ¹Ğ¿: Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ 1, 5 Ğ¸Ğ»Ğ¸ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¸ ÑĞ¾Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ².',
    'help.speedrun.li2': 'Ğ‘ĞµĞ· Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğ¹ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ (âœ…/âŒ), Ğ·Ğ°Ñ‚ĞµĞ¼ ÑÑ€Ğ°Ğ·Ñƒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ.',
    'help.speedrun.li3': 'ĞÑ€Ğ°Ğ½Ğ¶ĞµĞ²Ñ‹Ğ¹ ÑˆĞ½ÑƒÑ€ Ğ±ĞµĞ¶Ğ¸Ñ‚ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞµĞµÑÑ Ğ²Ñ€ĞµĞ¼Ñ. ĞĞ° 0:00 Ğ³Ğ¾Ğ½ĞºĞ° Ğ·Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸.',
    'help.speedrun.li4': 'Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ²ÑĞµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ¾ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸, Ğ²Ñ‹ Ğ¾Ğ±ĞµĞ·Ğ²Ñ€ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¿Ğ¸Ğ´Ñ€Ğ°Ğ½-Ğ±Ğ¾Ğ¼Ğ±Ñƒ! ğŸ’£',
    'help.speedrun.li5': 'Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ²Ğ¾ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾, Ñ‚Ğ°ĞºĞ¶Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.',
    'help.leitner.title': 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑÑ‰Ğ¸ĞºĞ¾Ğ² Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    'help.leitner.li1': 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€ (Ğ¿ÑƒĞ» + Ñ€ĞµĞ¶Ğ¸Ğ¼) Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾.',
    'help.leitner.li2': 'Â«ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹Â» = Ğ±ĞµĞ· ÑÑ€Ğ¾ĞºĞ¾Ğ², Â«ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹Â» = Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (1/2/5/8/14 Ğ´Ğ½ĞµĞ¹).',
    'help.leitner.li3': 'ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ÑÑ‰Ğ¸Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾. Ğ’ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ²Ğ¿ĞµÑ€ĞµĞ´, Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾ = Ğ½Ğ° ÑÑ‰Ğ¸Ğº Ğ½Ğ°Ğ·Ğ°Ğ´.',
    'help.community.title': 'Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾',
    'help.community.li1': 'Ğ’Ğ¾ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ° â€” Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ, Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ².',
    'help.community.li2': 'Ğ”Ñ€ÑƒĞ·ÑŒÑ: Ğ²ÑĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ² Ğ´Ñ€ÑƒĞ·ÑŒÑÑ….',
    'help.community.li3': 'Ğ”ÑƒÑĞ»Ğ¸: Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸Ğ»Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ´ÑƒÑĞ»ÑŒ, Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğ¹.',
    'help.community.li4': 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ + Ğ²Ñ€ĞµĞ¼Ñ; XP Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸.',
    'help.community.li5': 'Ğ’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ optâ€‘in (Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚).',
    'help.review.title': 'ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Â«ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Â»',
    'help.review.li1': 'Ğ’ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğµ ĞµÑÑ‚ÑŒ Â«ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ (48Ñ‡)Â» Ğ¸ Â«ĞĞ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Â».',
    'help.review.li2': 'Ğ¡Ğ¿Ğ¸ÑĞºĞ¸ Ğ¿Ğ¾ Ğ¿ÑƒĞ»Ğ°Ğ¼ Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ñ‹ Ñ‚Ğ°Ğ¼ Ğ¶Ğµ.',
    'help.pools.title': 'ĞŸÑƒĞ»Ñ‹ Ğ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€',
    'help.pools.li1': 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°/Ğ­ĞºĞ·Ğ°Ğ¼ĞµĞ½/Ğ¡Ğ²Ğ°Ğ¹Ğ¿/Ğ¯Ñ‰Ğ¸ĞºĞ¸ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿ÑƒĞ».',
    'help.pools.li2': 'Ğ’ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ, Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹.',
    'help.pools.li3': 'Â«ĞŸĞ°ĞºĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Â» Ğ¸Ğ»Ğ¸ Â«AIâ€‘Ğ¿ÑƒĞ»Â» Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿ÑƒĞ»Ğ¾Ğ².',
    'help.import.title': 'Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚',
    'help.import.li1': 'Â«Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¿ÑƒĞ»Ğ°Â» Ğ¸Ğ»Ğ¸ Â«Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… Ğ¿ÑƒĞ»Ğ¾Ğ²Â» Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ².',
    'help.import.li2': 'Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ.',
    'help.lang.title': 'Ğ¯Ğ·Ñ‹Ğº',
    'help.lang.li1': 'Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° (Ğ¸ĞºĞ¾Ğ½ĞºĞ° ÑĞ¿Ñ€Ğ°Ğ²Ğ° ÑĞ²ĞµÑ€Ñ…Ñƒ) Ğ¼ĞµĞ½ÑĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ.',
    'help.lang.li2': 'ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ·Ñ‹ĞºĞ° (ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ DE/EN/RU), Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞµ.',
    'help.lang.li3': 'ĞŸÑƒĞ»Ñ‹ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ Ğ²ÑĞµ ÑĞ·Ñ‹ĞºĞ¾Ğ²Ñ‹Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ â€” Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒĞ»Ğ¾Ğ² Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.',
    'help.admin.title': 'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ñƒ',
    'help.admin.li1': 'Ğ”Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸.',
    'impressum.subtitle': 'Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ Â§ 5 TMG',
    'impressum.body': '[Your Name]<br>[Your Address]<br>[Your City, Postal Code]<br>Eâ€‘mail: <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'impressum.short': '[Your Name] Â· [Your Address] Â· [Your City, Postal Code] Â· <a href=\"mailto:contact@example.com\">contact@example.com</a>',
    'api.title': 'ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ API',
    'api.label': 'APIâ€‘URL',
    'api.save': 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ',
    'api.test': 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ',
    'api.hint': 'ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ° Ğ¶Ğµ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ğ°Ñ Ğ·Ğ¾Ğ½Ğ° Ñ /api.',
    'profile.label': 'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ',
    'aria.langMenu': 'Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº',
    'aria.textSize': 'Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ‚ĞµĞºÑÑ‚Ğ°',
    'aria.accountOpen': 'ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚',
    'aria.infoTrain': 'Ğ“Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸ Ğ¸ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸',
    'aria.infoExam': 'ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸ Ğ¸ Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸',
    'aria.infoLeitner': 'ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸',
    'theme.title': 'ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑĞ²ĞµÑ‚Ğ»ÑƒÑ/Ñ‚Ñ‘Ğ¼Ğ½ÑƒÑ',
    'nav.toggle': 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ/ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¼ĞµĞ½Ñ'
  }
};
function t(key, lang){
  const l = I18N[lang] || I18N.de;
  return l[key] || I18N.de[key] || key;
}
function applyI18n(lang){
  const lng = I18N[lang] ? lang : 'de';
  CURRENT_LANG = lng;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const val = t(key, lng);
    if(key === 'impressum.body' || key === 'impressum.short'){
      el.innerHTML = val;
      return;
    }
    if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA'){
      el.placeholder = val;
    }else{
      el.textContent = val;
    }
  });
  document.querySelectorAll('[data-i18n-title]').forEach(el=>{
    const key = el.getAttribute('data-i18n-title');
    const val = t(key, lng);
    if(val){ el.setAttribute('title', val); }
  });
  document.querySelectorAll('[data-i18n-aria]').forEach(el=>{
    const key = el.getAttribute('data-i18n-aria');
    const val = t(key, lng);
    if(val){ el.setAttribute('aria-label', val); }
  });
  const btn = $('#btnTheme');
  if(btn){ btn.title = t('theme.title', lng); }
  const langLabel = $('#langLabel');
  if(langLabel){ langLabel.textContent = lng.toUpperCase(); }
  const langLabelGate = $('#langLabelGate');
  if(langLabelGate){ langLabelGate.textContent = lng.toUpperCase(); }
  const examPool = $('#examPool');
  if(examPool && ACTIVE_POOL){
    examPool.textContent = `${t('exam.poolLabel', lng)} ${ACTIVE_POOL.name}`;
  }
  const examAnswered = $('#examAnswered');
  if(examAnswered){
    const answered = Object.keys(EXAM.answers || {}).length;
    const total = EXAM.count || 0;
    const suffix = total ? ` ${answered} / ${total}` : '';
    examAnswered.textContent = `${t('exam.answeredLabel', lng)}${suffix}`;
  }
  renderDatasetList();
  refreshSwipePoolSelect();
  return lng;
}
function applyTheme(theme){
  const t = theme === 'light' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem(THEME_KEY, t);
  const btn = $('#btnTheme');
  if(btn){ btn.textContent = t === 'light' ? 'ğŸŒ' : 'ğŸŒ™'; }
}
function applyTextScale(scale){
  const val = (scale === 'sm' || scale === 'md' || scale === 'lg') ? scale : 'md';
  document.body.classList.remove('text-sm','text-md','text-lg');
  document.body.classList.add(`text-${val}`);
  localStorage.setItem(TEXT_SCALE_KEY, val);
  const label = $('#textSizeLabel');
  if(label){ label.textContent = val === 'sm' ? 'S' : (val === 'lg' ? 'L' : 'M'); }
}
function initTextScale(){
  const stored = localStorage.getItem(TEXT_SCALE_KEY) || 'md';
  applyTextScale(stored);
}
function initTheme(){
  const stored = localStorage.getItem(THEME_KEY);
  if(stored){ applyTheme(stored); return; }
  const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  applyTheme(prefersLight ? 'light' : 'dark');
}
let FRAGEN = []; // Aktiver Pool-Inhalt
let ACTIVE_POOL = null; // {name, version, fragen:[]}
let TRAIN = { order:[], idx:0, checked:false, useWrongOnly:false, useLaterOnly:false, wrongIds:new Set(), laterIds:new Set(), laterLoaded:false, laterPoolId:null };
let SWIPE = { pool:null, questions:[], idx:0, correct:0, wrong:0, answered:new Set(), phase:'front' };
let EXAM = { running:false, order:[], idx:0, answers:{}, count:10, startTs:0, endTs:0, minutes:30, timerId:null, deadline:0, answerOrder:{}};
let EXAM_QUESTIONS = [];
let SPEEDRUN = { running:false, sessionId:null, pool:null, questions:[], usedIds:new Set(), idx:0, correct:0, wrong:0, duration:5, startTs:0, deadline:0, timerId:null, questionStart:0 };
let LIST_FILTER = '';
function getExamQuestions(){ return EXAM_QUESTIONS.length ? EXAM_QUESTIONS : FRAGEN; }
let LEITNER = { session:[], ptr:0, answered:false, result:null, picks:new Set(), selectedBoxes:new Set([1,2,3,4,5]), boxCounts:{1:0,2:0,3:0,4:0,5:0} };
let FRIENDS = [];
let FRIEND_REQUESTS = [];
let DUELS = { waiting: [], active: [], finished: [], open: [] };
let DUEL = { id: null, data: null, questions: [], idx: 0, answers: new Map(), questionStart: 0 };
let COMMUNITY_BADGE = { friends: 0, duels: 0 };
let GAMIFY_CONFIG = null;
let LAST_XP = null;
let LEITNER_SETS = [];
let ACTIVE_LEITNER_SET = null;
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const uid = () => Math.random().toString(36).slice(2,10);
const now = () => Date.now();
const shuffle = (arr) => arr.slice().sort(()=>Math.random()-.5);
function showProfileGate(force=false){
  const gate = $('#profileGate');
  if(!gate) return;
  const shouldShow = !currentUser || force;
  gate.classList.toggle('active', shouldShow);
  gate.setAttribute('aria-hidden', shouldShow ? 'false' : 'true');
  document.body.classList.toggle('gate-open', shouldShow);
  document.body.classList.toggle('auth-required', shouldShow);
}
function setGateMode(mode){
  GATE_MODE = mode;
  const showRegister = mode === 'register';
  const showForgot = mode === 'forgot';
  const showReset = mode === 'reset';
  $('#gateRegisterFields')?.classList.toggle('hidden', !showRegister);
  $('#gateForgotFields')?.classList.toggle('hidden', !showForgot);
  $('#gateResetFields')?.classList.toggle('hidden', !showReset);
  $('#gateLoginFields')?.classList.toggle('hidden', showRegister || showForgot || showReset);
  const toggle = $('#btnGateToggleMode');
  if(toggle){
    if(showForgot || showReset){
      toggle.textContent = t('gate.login.link', CURRENT_LANG);
    }else{
      toggle.textContent = t(showRegister ? 'gate.login.link' : 'gate.register.link', CURRENT_LANG);
    }
  }
}
$('#btnLangMenu')?.addEventListener('click', (e)=>{
  e.preventDefault();
  $('#langMenu')?.classList.toggle('open');
});
$('#btnLangMenuGate')?.addEventListener('click', (e)=>{
  e.preventDefault();
  $('#langMenuGate')?.classList.toggle('open');
});
document.addEventListener('click', (e)=>{
  const menu = $('#langMenu');
  const menuGate = $('#langMenuGate');
  if(e.target.closest('.langmenu')) return;
  menu?.classList.remove('open');
  menuGate?.classList.remove('open');
});
if(RESET_TOKEN){
  showProfileGate(true);
  setGateMode('reset');
}
$('#langMenu')?.querySelectorAll('button[data-lang]').forEach(btn=>{
  btn.addEventListener('click', async (e)=>{
    const lang = e.currentTarget.dataset.lang;
    if(!['de','en','ru'].includes(lang)) return;
    localStorage.setItem(LANG_KEY(PROFILE_ID), lang);
    applyI18n(lang);
    POOL_LANG = lang;
    localStorage.setItem(POOL_LANG_KEY(PROFILE_ID), lang);
    if(ACTIVE_POOL){
      const prevIdx = TRAIN.idx;
      const filterLang = await shouldFilterLang(ACTIVE_POOL.id);
      const questions = await apiGetQuestions(ACTIVE_POOL.id, filterLang ? lang : null);
      FRAGEN = mapApiQuestions(questions);
      startTraining(false, { preserveIndex: true, prevIdx });
      renderList();
    }
    renderLeitnerStats();
    renderUserStats();
    syncPoolSelectors();
    window.QALists?.refreshPools?.();
    window.QALists?.refresh();
    $('#langMenu')?.classList.remove('open');
  });
});
$('#langMenuGate')?.querySelectorAll('button[data-lang]').forEach(btn=>{
  btn.addEventListener('click', async (e)=>{
    const lang = e.currentTarget.dataset.lang;
    if(!['de','en','ru'].includes(lang)) return;
    localStorage.setItem(LANG_KEY(PROFILE_ID), lang);
    localStorage.setItem(POOL_LANG_KEY(PROFILE_ID), lang);
    applyI18n(lang);
    $('#langMenuGate')?.classList.remove('open');
  });
});
$('#btnTheme')?.addEventListener('click', ()=>{
  const current = document.documentElement.getAttribute('data-theme') || 'dark';
  applyTheme(current === 'light' ? 'dark' : 'light');
});
$('#btnTextSize')?.addEventListener('click', ()=>{
  const current = localStorage.getItem(TEXT_SCALE_KEY) || 'md';
  const next = current === 'sm' ? 'md' : (current === 'md' ? 'lg' : 'sm');
  applyTextScale(next);
});
$('#btnMenusToggle')?.addEventListener('click', ()=>{
  document.body.classList.toggle('menus-hidden');
  localStorage.setItem(MENU_KEY, document.body.classList.contains('menus-hidden') ? '1' : '0');
});
/** ----------------------------
 *  Auth / Editor
 *  ---------------------------- */
async function apiFetch(path, options = {}){
  const url = API_BASE + path;
  const headers = new Headers(options.headers || {});
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
  if(tz && !headers.has('X-User-Timezone')){ headers.set('X-User-Timezone', tz); }
  if(accessToken){ headers.set('Authorization', `Bearer ${accessToken}`); }
  if(options.body && !(options.body instanceof FormData) && !headers.has('Content-Type')){
    headers.set('Content-Type', 'application/json');
  }
  let res = await fetch(url, { ...options, headers, credentials: 'include' });
  if(res.status === 401){
    const refreshed = await refreshAccessToken();
    if(refreshed){
      const retryHeaders = new Headers(options.headers || {});
      retryHeaders.set('Authorization', `Bearer ${accessToken}`);
      if(options.body && !(options.body instanceof FormData) && !retryHeaders.has('Content-Type')){
        retryHeaders.set('Content-Type', 'application/json');
      }
      res = await fetch(url, { ...options, headers: retryHeaders, credentials: 'include' });
    }
  }
  return res;
}
async function parseJsonSafe(res){
  const text = await res.text();
  if(!text) return null;
  try{ return JSON.parse(text); }catch{ return null; }
}
async function apiJson(path, options = {}){
  const res = await apiFetch(path, options);
  if(!res.ok){
    const data = await parseJsonSafe(res);
    const msg = data?.error || `HTTP ${res.status}`;
    throw new Error(msg);
  }
  return parseJsonSafe(res);
}
async function apiRegister(email, username, password, role){
  return apiJson('/auth/register', {
    method: 'POST',
    body: JSON.stringify({ email, username, password, role })
  });
}
async function checkApiHealth(){
  try{
    const res = await fetch(API_BASE + '/health', { method:'GET' });
    return res.ok;
  }catch{
    return false;
  }
}
async function updateApiStatus(){
  const ok = await checkApiHealth();
  const label = ok ? 'API: OK' : 'API: Offline';
  const gate = $('#apiStatusGate');
  if(gate) gate.textContent = label;
  const about = $('#apiStatus');
  if(about) about.textContent = label;
  return ok;
}
async function refreshAccessToken(){
  const res = await fetch(API_BASE + '/auth/refresh', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({}),
    credentials: 'include'
  });
  if(!res.ok){
    logout();
    return false;
  }
  const data = await parseJsonSafe(res);
  if(!data){
    logout();
    return false;
  }
  accessToken = data?.access_token || null;
  if(accessToken && !LOGIN_AT) LOGIN_AT = Date.now();
  return !!accessToken;
}
async function login(identifier, password){
  const data = await apiJson('/auth/login', {
    method: 'POST',
    body: JSON.stringify({ identifier, password })
  });
  accessToken = data?.access_token || null;
  if(accessToken) LOGIN_AT = Date.now();
  await refreshMe();
}
async function refreshMe(){
  if(!accessToken){
    currentUser = null;
    updateAdminUI();
    showProfileGate(true);
    return;
  }
  try{
    currentUser = await apiJson('/auth/me', { method: 'GET' });
  }catch{
    currentUser = null;
  }
  updateAdminUI();
  showProfileGate(!currentUser);
  if(document.querySelector('#tab-account.active')){
    renderUserStats();
  }
  if(document.querySelector('#tab-community.active')){
    if(ENABLE_GAMIFY) renderGamification();
    if(ENABLE_LEADERBOARDS) renderLeaderboards();
    renderContests();
  }
}
function logout(){
  accessToken = null;
  currentUser = null;
  LAST_XP = null;
  setAccountBadge(0);
  localStorage.removeItem(REFRESH_KEY);
  sessionStorage.removeItem(REFRESH_KEY);
  apiLogout();
  updateAdminUI();
  showProfileGate(true);
}
async function apiLogout(){
  try{
    await fetch(API_BASE + '/auth/logout', { method: 'POST', credentials: 'include' });
  }catch{
    // ignore
  }
}
async function postLoginInit(){
  if(!accessToken) return;
  await loadPools();
  await ensureDefaultPools();
  window.QALists?.refreshPools?.();
  const pools = listPoolsForLang(POOL_LANG);
  if(pools.length){ await setActivePool(pools[0]); }
  refreshPoolSelect(ACTIVE_POOL?.name);
  renderUserStats();
  window.QALists?.refresh();
}
function canEditPool(pool){
  return !!pool && (isAdmin || !pool.owner_id || pool.owner_id === currentUser?.id);
}
async function ensureCanEditActivePool(){
  if(!currentUser){ await showAlert('Bitte einloggen.'); return false; }
  if(!ACTIVE_POOL){ await showAlert('Kein aktiver Pool.'); return false; }
  if(!canEditPool(ACTIVE_POOL)){ await showAlert(t('pool.noPermission', CURRENT_LANG)); return false; }
  return true;
}
function updatePoolEditorAccess(){
  const banner = $('#lockBanner');
  const editor = $('#editorBlock');
  const bannerText = banner?.querySelector('div');
  if(!banner || !editor || !bannerText) return;
  const canEdit = !!currentUser && (!ACTIVE_POOL || canEditPool(ACTIVE_POOL));
  const toggleIds = ['btnPoolDelete','btnAddAnswer','btnNew','btnSave','btnDelete','btnImportBulk'];
  toggleIds.forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.disabled = !canEdit;
  });
  if(!currentUser){
    bannerText.textContent = t('pool.lockedLogin', CURRENT_LANG);
    banner.classList.remove('hidden');
    editor.classList.add('locked');
    return;
  }
  if(ACTIVE_POOL && !canEditPool(ACTIVE_POOL)){
    bannerText.textContent = t('pool.lockedNoPerm', CURRENT_LANG);
    banner.classList.remove('hidden');
    editor.classList.add('locked');
    return;
  }
  banner.classList.add('hidden');
  editor.classList.remove('locked');
}
function updateAdminUI(){
  isAdmin = currentUser?.role === 'admin';
  const isLoggedIn = !!currentUser;
  const status = $('#adminStatus');
  if(status){
    if(!currentUser){ status.textContent = 'ğŸ”’ Nicht angemeldet'; status.className = 'lock'; }
    else { status.textContent = 'ğŸ”“ Editor aktiv'; status.className = 'lock ok'; }
  }
  const badge = $('#userBadge');
  if(badge){ badge.textContent = currentUser ? `${currentUser.email} (${currentUser.role})` : 'Nicht angemeldet'; }
  const msg = $('#adminMsg');
  if(msg){ msg.textContent = currentUser ? `${currentUser.email} Â· Rolle: ${currentUser.role}` : 'Bitte einloggen.'; }
  updatePoolEditorAccess();
  $$('.needsAdmin').forEach(el=>{ el.disabled = !isAdmin; });
  const optIn = $('#leaderboardOptIn');
  const name = $('#displayName');
  const btnSave = $('#btnSaveLeaderboard');
  if(optIn){ optIn.checked = !!currentUser?.leaderboard_opt_in; optIn.disabled = !isLoggedIn; }
  if(name){ name.value = currentUser?.display_name || ''; name.disabled = !isLoggedIn; }
  if(btnSave){ btnSave.disabled = !isLoggedIn; }
  document.querySelectorAll('.admin-only').forEach(el=>{
    el.style.display = isLoggedIn ? '' : 'none';
  });
}
$('#btnDoLogin')?.addEventListener('click', async ()=>{
  const ident = $('#loginEmail')?.value.trim();
  const password = $('#loginPassword')?.value.trim();
  if(!ident || !password){ await showAlert('Bitte Benutzername/Eâ€‘Mail und Passwort eingeben.'); return; }
  try{
    await login(ident, password);
    await postLoginInit();
    switchTab('train');
    $('#loginPassword').value = '';
  }catch(e){
    await showAlert('Login fehlgeschlagen: ' + e.message, 'Login');
  }
});
$('#btnGateLogin')?.addEventListener('click', async ()=>{
  const ident = $('#gateLoginEmail')?.value.trim();
  const password = $('#gateLoginPassword')?.value.trim();
  if(!ident || !password){ await showAlert('Bitte Benutzername/Eâ€‘Mail und Passwort eingeben.'); return; }
  try{
    await login(ident, password);
    $('#gateLoginPassword').value = '';
    await postLoginInit();
    showProfileGate(false);
    switchTab('train');
    await showAlert('Login erfolgreich.', 'Login');
  }catch(e){
    await showAlert('Login fehlgeschlagen: ' + e.message, 'Login');
  }
});
$('#btnGateRegister')?.addEventListener('click', async ()=>{
  const username = $('#gateRegisterUsername')?.value.trim();
  const email = $('#gateRegisterEmail')?.value.trim();
  const password = $('#gateRegisterPassword')?.value.trim();
  const password2 = $('#gateRegisterPassword2')?.value.trim();
  if(!username || !email || !password || !password2){
    await showAlert('Bitte Benutzername, E-Mail und beide PasswÃ¶rter eingeben.', 'Registrierung');
    return;
  }
  if(password !== password2){
    await showAlert('PasswÃ¶rter stimmen nicht Ã¼berein.', 'Registrierung');
    return;
  }
  try{
    await apiRegister(email, username, password, 'student');
    // Auto-login after successful registration
    try{
      await doLogin(username, password);
    }catch(loginErr){
      // If auto-login fails, show login form with pre-filled credentials
      $('#gateRegisterPassword').value = '';
      $('#gateRegisterPassword2').value = '';
      setGateMode('login');
      if($('#gateLoginEmail')) $('#gateLoginEmail').value = username;
      await showAlert(t('gate.register.success', CURRENT_LANG) + ' Bitte einloggen.', 'Registrierung');
    }
  }catch(e){
    await showAlert('Account erstellen fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#btnGateToggleMode')?.addEventListener('click', ()=>{
  if(GATE_MODE === 'forgot' || GATE_MODE === 'reset'){
    setGateMode('login');
    return;
  }
  const isRegister = !$('#gateRegisterFields')?.classList.contains('hidden');
  setGateMode(isRegister ? 'login' : 'register');
});
$('#btnAccountTop')?.addEventListener('click', ()=> switchTab('account'));
$('#modalOk')?.addEventListener('click', hideModal);
$('#btnGateForgotLink')?.addEventListener('click', ()=>{
  setGateMode('forgot');
});
$('#btnGateForgotSend')?.addEventListener('click', async ()=>{
  const email = $('#gateForgotEmail')?.value.trim();
  if(!email){ await showAlert(t('gate.forgot.needEmail', CURRENT_LANG)); return; }
  try{
    await apiForgotPassword(email);
    await showAlert(t('gate.forgot.sent', CURRENT_LANG), t('gate.forgot.title', CURRENT_LANG));
    setGateMode('login');
  }catch(e){
    await showAlert(t('gate.forgot.sent', CURRENT_LANG), t('gate.forgot.title', CURRENT_LANG));
    setGateMode('login');
  }
});
$('#btnGateReset')?.addEventListener('click', async ()=>{
  const pw1 = $('#gateResetPassword')?.value.trim();
  const pw2 = $('#gateResetPassword2')?.value.trim();
  if(!pw1 || !pw2){ await showAlert(t('gate.reset.needPw', CURRENT_LANG)); return; }
  if(pw1 !== pw2){ await showAlert(t('gate.reset.noMatch', CURRENT_LANG)); return; }
  if(!RESET_TOKEN){ await showAlert(t('gate.reset.noToken', CURRENT_LANG)); return; }
  try{
    await apiResetPassword(RESET_TOKEN, pw1);
    await showAlert(t('gate.reset.ok', CURRENT_LANG), t('gate.reset.title', CURRENT_LANG));
    setGateMode('login');
  }catch(e){
    await showAlert(t('gate.reset.err', CURRENT_LANG), 'Fehler');
  }
});
$('#btnSaveLeaderboard')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  const optIn = $('#leaderboardOptIn')?.checked || false;
  const name = $('#displayName')?.value.trim() || null;
  try{
    currentUser = await apiUpdateLeaderboardSettings(optIn, name);
    updateAdminUI();
    await showAlert(t('account.saveOk', CURRENT_LANG), t('account.title', CURRENT_LANG));
  }catch{
    await showAlert(t('account.saveErr', CURRENT_LANG), 'Fehler');
  }
});
$('#btnLogout')?.addEventListener('click', logout);
$('#btnLogoutAccount')?.addEventListener('click', logout);
$('#btnOpenStart')?.addEventListener('click', ()=> showProfileGate(true));
$('#btnGamifyRefresh')?.addEventListener('click', ()=>{
  if(ENABLE_GAMIFY) renderGamification();
  if(ENABLE_LEADERBOARDS) renderLeaderboards();
  renderFriends();
  renderDuels();
  renderContests();
});
$('#btnDuelCreate')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  const friendId = $('#duelFriendSelect')?.value;
  if(!friendId) return await showAlert(t('community.duelsNoFriend', CURRENT_LANG));
  const poolName = $('#duelPoolSelect')?.value;
  const pool = getPoolByName(poolName);
  if(!pool) return await showAlert(t('community.duelsNoPool', CURRENT_LANG));
  const count = parseInt($('#duelCountSelect')?.value || '5', 10);
  const filterLang = await shouldFilterLang(pool.id);
  const lang = filterLang ? POOL_LANG : null;
  try{
    await apiDuelCreate({ opponent_id: friendId, pool_id: pool.id, question_count: count, is_open: false, lang });
    await showAlert(t('community.duelsCreated', CURRENT_LANG), t('community.duels', CURRENT_LANG));
    await renderDuels();
  }catch(e){
    await showAlert(t('community.duelsCreateErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnDuelOpen')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  const poolName = $('#duelPoolSelect')?.value;
  const pool = getPoolByName(poolName);
  if(!pool) return await showAlert(t('community.duelsNoPool', CURRENT_LANG));
  const count = parseInt($('#duelCountSelect')?.value || '5', 10);
  const filterLang = await shouldFilterLang(pool.id);
  const lang = filterLang ? POOL_LANG : null;
  try{
    await apiDuelCreate({ pool_id: pool.id, question_count: count, is_open: true, lang });
    await showAlert(t('community.duelsOpenCreated', CURRENT_LANG), t('community.duels', CURRENT_LANG));
    await renderDuels();
  }catch(e){
    await showAlert(t('community.duelsCreateErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnDuelAnswer')?.addEventListener('click', async ()=>{
  if(!DUEL.id || !DUEL.questions.length) return;
  const q = DUEL.questions[DUEL.idx];
  if(!q) return;
  const picks = getSelectedIds('duel', q);
  if(!picks.size) return await showAlert(t('community.duelsNeedAnswer', CURRENT_LANG));
  const elapsed = Math.max(0, Math.round(performance.now() - DUEL.questionStart));
  try{
    const res = await apiDuelAnswer(DUEL.id, { question_id: q.id, selected_answer_ids: Array.from(picks), time_ms: elapsed });
    const correct = !!res?.correct;
    const updated = {
      ...q,
      antworten: q.antworten.map(a=>({ ...a, korrekt: correct && picks.has(a.id) }))
    };
    renderQuestionInto($('#duelQuestionWrap'), updated, 'duel', { shuffleAnswers:false, selectedIds:picks, showColors:true });
    $('#duel-feedback').textContent = correct ? t('community.duelsCorrect', CURRENT_LANG) : t('community.duelsWrong', CURRENT_LANG);
    DUEL.answers.set(q.id, { selected_answer_ids: Array.from(picks), is_correct: correct, time_ms: elapsed });
    $('#btnDuelAnswer').disabled = true;
    $('#btnDuelNext').disabled = false;
  }catch(e){
    await showAlert(t('community.duelsAnswerErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnDuelNext')?.addEventListener('click', ()=>{
  if(!DUEL.id) return;
  DUEL.idx = nextDuelIndex(DUEL);
  if(DUEL.idx === -1){
    refreshDuelState(DUEL.id);
    return;
  }
  renderDuelQuestion();
});
$('#btnDuelExit')?.addEventListener('click', ()=>{
  hideDuelPlay();
});
$('#btnDuelReset')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  const confirmed = await showConfirm(t('community.duelsResetConfirm', CURRENT_LANG), t('community.duelsTitle', CURRENT_LANG));
  if(!confirmed) return;
  try{
    await apiDuelReset();
    hideDuelPlay();
    await renderDuels();
    await showAlert(t('community.duelsResetDone', CURRENT_LANG), t('community.duelsTitle', CURRENT_LANG));
  }catch(e){
    await showAlert(t('community.duelsResetErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
/** ----------------------------
 *  Tabs
 *  ---------------------------- */
function switchTab(tab){
  $$('.active').forEach(x=>x.classList.remove('active'));
  const btn = $(`button.tabbtn[data-tab="${tab}"]`);
  if(btn){ btn.classList.add('active'); }
  $('#tab-'+tab)?.classList.add('active');
  localStorage.setItem(TAB_KEY(PROFILE_ID), tab);
  if(tab==='pool'){ renderList(); }
  if(tab==='leitner'){ renderLeitnerStats(); }
  if(tab==='about'){ renderUserStats(); }
  if(tab==='account'){ renderUserStats(); }
  if(tab==='community'){
    if(ENABLE_GAMIFY) renderGamification();
    if(ENABLE_LEADERBOARDS) renderLeaderboards();
    renderFriends();
    renderDuels();
    renderContests();
    renderSpeedrunStats();
    renderSpeedrunLeaderboard(5);
  }
  if(tab==='leitner'){
    loadLeitnerSets();
  }
  if(tab==='exam'){ renderExamSessions(); }
  if(tab==='train' || tab==='exam'){ syncPoolSelectors(); }
  if(tab==='swipe'){
    refreshSwipePoolSelect();
    const sel = $('#swipePoolSelect');
    if(sel?.value && (!SWIPE.pool || SWIPE.pool.name !== sel.value)) loadSwipePool(sel.value);
    refreshSpeedrunPoolSelect();
  }
  updateAdminUI();
}
$$('button.tabbtn').forEach(btn=>{
  btn.addEventListener('click', ()=> switchTab(btn.dataset.tab));
});
/** ----------------------------
 *  Pools (API)
 *  ---------------------------- */
let POOLS = [];
let POOLS_BY_NAME = new Map();
let POOLS_BY_ID = new Map();
let POOL_LANGS = new Map();

function mapApiQuestion(q){
  const parsed = decodeLangCategory(q.category || '');
  const lang = (q.lang || parsed.lang || null);
  return {
    id: q.id,
    frage: q.text || '',
    kategorie: parsed.category || q.category || '',
    lang: lang,
    source_id: q.source_id || null,
    erklaerung: q.explanation || '',
    antworten: Array.isArray(q.answers) ? q.answers.map(a=>({ id: a.id, text: a.text || '', korrekt: !!a.is_correct, source_id: a.source_id || null })) : [],
    bilder: Array.isArray(q.images) ? q.images : (Array.isArray(q.bilder) ? q.bilder : [])
  };
}
function mapApiQuestions(arr){
  return (Array.isArray(arr) ? arr : []).map(mapApiQuestion);
}
function toApiQuestionPayload(q){
  let lang = q.lang || null;
  let cat = q.kategorie || null;
  if(!lang && typeof cat === 'string' && cat.startsWith('lang:')){
    const parsed = decodeLangCategory(cat);
    lang = parsed.lang || null;
    cat = parsed.category || null;
  }
  if(!lang && POOL_LANG) lang = POOL_LANG;
  return {
    text: q.frage,
    category: cat || null,
    lang: lang || null,
    explanation: q.erklaerung || null,
    answers: (q.antworten || []).map(a=>({ text: a.text, is_correct: !!a.korrekt }))
  };
}
async function apiListPools(){ return apiJson('/pools', { method: 'GET' }); }
async function apiCreatePool(name){ return apiJson('/pools', { method: 'POST', body: JSON.stringify({ name }) }); }
async function apiUpdatePool(id, name){ return apiJson(`/pools/${id}`, { method: 'PUT', body: JSON.stringify({ name }) }); }
async function apiDeletePool(id){ const res = await apiFetch(`/pools/${id}`, { method: 'DELETE' }); if(!res.ok) throw new Error('Pool lÃ¶schen fehlgeschlagen'); }
async function apiGetQuestions(poolId, lang){
  const q = lang ? `?lang=${encodeURIComponent(lang)}` : '';
  return apiJson(`/pools/${poolId}/questions${q}`, { method: 'GET' });
}
async function apiGetPoolLangs(poolId){
  return apiJson(`/pools/${poolId}/langs`, { method: 'GET' });
}
async function apiCreateQuestion(poolId, payload){ return apiJson(`/pools/${poolId}/questions`, { method: 'POST', body: JSON.stringify(payload) }); }
async function apiUpdateQuestion(questionId, payload){ return apiJson(`/questions/${questionId}`, { method: 'PUT', body: JSON.stringify(payload) }); }
async function apiDeleteQuestion(questionId){ const res = await apiFetch(`/questions/${questionId}`, { method: 'DELETE' }); if(!res.ok) throw new Error('Frage lÃ¶schen fehlgeschlagen'); }
async function apiTrainingAnswer(questionId, selectedIds){ return apiJson('/training/answer', { method: 'POST', body: JSON.stringify({ question_id: questionId, selected_answer_ids: selectedIds }) }); }
async function apiSwipeAnswer(questionId, answerId){
  return apiJson('/swipe/answer', {
    method: 'POST',
    body: JSON.stringify({ question_id: questionId, selected_answer_id: answerId })
  });
}
async function apiTrainingWrong(poolId){
  const filterLang = await shouldFilterLang(poolId);
  const lang = filterLang ? `&lang=${encodeURIComponent(POOL_LANG)}` : '';
  return apiJson(`/training/wrong?pool_id=${encodeURIComponent(poolId)}${lang}`, { method: 'GET' });
}
async function apiTrainingLater(poolId){
  const filterLang = await shouldFilterLang(poolId);
  const lang = filterLang ? `&lang=${encodeURIComponent(POOL_LANG)}` : '';
  return apiJson(`/training/later?pool_id=${encodeURIComponent(poolId)}${lang}`, { method: 'GET' });
}
async function apiTrainingLaterMark(questionId, mark){ return apiJson('/training/later', { method: 'POST', body: JSON.stringify({ question_id: questionId, mark }) }); }
async function apiTrainingReset(poolId){ return apiJson('/training/reset', { method: 'POST', body: JSON.stringify({ pool_id: poolId }) }); }
async function apiGetTranslation(questionId, targetLang){ return apiJson(`/questions/${encodeURIComponent(questionId)}/translation?lang=${encodeURIComponent(targetLang)}`, { method: 'GET' }); }
const TRANSLATION_CACHE = new Map();
async function apiLeitnerSets(){ return apiJson('/leitner/sets', { method: 'GET' }); }
async function apiLeitnerSetCreate(name, poolId, mode){ return apiJson('/leitner/sets', { method: 'POST', body: JSON.stringify({ name, pool_id: poolId, mode }) }); }
async function apiLeitnerSetDelete(id){ return apiJson(`/leitner/sets/${id}`, { method: 'DELETE' }); }
async function apiLeitnerDue(setId, boxes){
  const params = new URLSearchParams();
  if(setId) params.set('set_id', setId);
  if(boxes?.length) params.set('boxes', boxes.join(','));
  const set = LEITNER_SETS.find(s=>s.id===setId);
  if(set?.pool_id && await shouldFilterLang(set.pool_id)) params.set('lang', POOL_LANG);
  const q = params.toString();
  return apiJson(`/leitner/due${q ? '?' + q : ''}`, { method: 'GET' });
}
async function apiLeitnerReset(setId){ return apiJson('/leitner/reset', { method: 'POST', body: JSON.stringify({ set_id: setId }) }); }
async function apiLeitnerSeed(setId, poolId){
  const filterLang = poolId ? await shouldFilterLang(poolId) : false;
  return apiJson('/leitner/seed', { method: 'POST', body: JSON.stringify({ set_id: setId, lang: filterLang ? POOL_LANG : null }) });
}
async function apiLeitnerStats(setId){ return apiJson(`/leitner/stats?set_id=${encodeURIComponent(setId)}`, { method: 'GET' }); }
async function apiLeitnerAnswer(questionId, result, setId){ return apiJson('/leitner/answer', { method: 'POST', body: JSON.stringify({ question_id: questionId, result, set_id: setId }) }); }
async function apiLeitnerAll(setId, boxes){
  const params = new URLSearchParams();
  if(setId) params.set('set_id', setId);
  if(boxes?.length) params.set('boxes', boxes.join(','));
  const set = LEITNER_SETS.find(s=>s.id===setId);
  if(set?.pool_id && await shouldFilterLang(set.pool_id)) params.set('lang', POOL_LANG);
  const q = params.toString();
  return apiJson(`/leitner/all${q ? '?' + q : ''}`, { method: 'GET' });
}
async function apiExportAll(){ return apiJson('/export/all', { method: 'GET' }); }
async function apiImportAll(payload, overwrite=false){
  const q = overwrite ? '?overwrite=true' : '';
  return apiJson(`/import/all${q}`, { method: 'POST', body: JSON.stringify(payload) });
}
async function apiImportPoolJson(poolId, payload){ return apiJson(`/pools/${poolId}/import/json`, { method: 'POST', body: JSON.stringify(payload) }); }
async function apiImportPoolCsv(poolId, csv){ return apiJson(`/pools/${poolId}/import/csv`, { method: 'POST', body: JSON.stringify({ csv }) }); }
async function apiExamStart(poolId, count, timeLimit){
  const filterLang = await shouldFilterLang(poolId);
  return apiJson('/exams/start', { method: 'POST', body: JSON.stringify({ pool_id: poolId, count, time_limit: timeLimit, lang: filterLang ? POOL_LANG : null }) });
}
async function apiExamSubmit(sessionId, answers){ return apiJson('/exams/submit', { method: 'POST', body: JSON.stringify({ session_id: sessionId, answers }) }); }
async function apiExamSessions(limit=20, offset=0){ return apiJson(`/exams/sessions?limit=${limit}&offset=${offset}`, { method: 'GET' }); }
async function apiExamMarkWrong(sessionId){ return apiJson(`/exams/${sessionId}/mark-wrong`, { method: 'POST' }); }
async function apiExamDelete(sessionId){ return apiJson(`/exams/${sessionId}`, { method: 'DELETE' }); }
async function apiSpeedrunStart(poolId, durationMinutes){
  return apiJson('/speedrun/start', {
    method: 'POST',
    body: JSON.stringify({ pool_id: poolId, duration_minutes: durationMinutes })
  });
}
async function apiSpeedrunAnswer(sessionId, questionId, isCorrect, timeMs){
  return apiJson('/speedrun/answer', {
    method: 'POST',
    body: JSON.stringify({ session_id: sessionId, question_id: questionId, is_correct: isCorrect, time_ms: timeMs })
  });
}
async function apiSpeedrunFinish(sessionId){
  return apiJson('/speedrun/finish', {
    method: 'POST',
    body: JSON.stringify({ session_id: sessionId })
  });
}
async function apiSpeedrunStats(){ return apiJson('/speedrun/stats', { method: 'GET' }); }
async function apiSpeedrunLeaderboard(duration){
  return apiJson(`/speedrun/leaderboard?duration=${duration}`, { method: 'GET' });
}
async function apiGamificationMe(){ return apiJson('/gamification/me', { method: 'GET' }); }
async function apiGamificationConfig(){ return apiJson('/gamification/config', { method: 'GET' }); }
async function apiContests(){ return apiJson('/contests', { method: 'GET' }); }
async function apiContestJoin(id){ return apiJson(`/contests/${id}/join`, { method: 'POST' }); }
async function apiContestLeaderboard(id){ return apiJson(`/contests/${id}/leaderboard`, { method: 'GET' }); }
async function apiFriends(){ return apiJson('/friends', { method: 'GET' }); }
async function apiFriendPending(){ return apiJson('/friends/pending', { method: 'GET' }); }
async function apiFriendSearch(q){
  const qs = new URLSearchParams();
  qs.set('q', q);
  return apiJson(`/friends/search?${qs.toString()}`, { method: 'GET' });
}
async function apiFriendRequest(term){
  return apiJson('/friends/request', {
    method: 'POST',
    body: JSON.stringify({ username: term })
  });
}
async function apiFriendAccept(id){ return apiJson(`/friends/${id}/accept`, { method: 'POST' }); }
async function apiFriendDecline(id){ return apiJson(`/friends/${id}/decline`, { method: 'POST' }); }
async function apiDuels(status){
  const qs = new URLSearchParams();
  if(status) qs.set('status', status);
  return apiJson(`/duels?${qs.toString()}`, { method: 'GET' });
}
async function apiDuelsOpen(){ return apiJson('/duels/open', { method: 'GET' }); }
async function apiDuelCreate(payload){ return apiJson('/duels', { method: 'POST', body: JSON.stringify(payload) }); }
async function apiDuelAccept(id){ return apiJson(`/duels/${id}/accept`, { method: 'POST' }); }
async function apiDuelGet(id){ return apiJson(`/duels/${id}`, { method: 'GET' }); }
async function apiDuelAnswer(id, payload){ return apiJson(`/duels/${id}/answer`, { method: 'POST', body: JSON.stringify(payload) }); }
async function apiDuelStats(){ return apiJson('/duels/stats', { method: 'GET' }); }
async function apiDuelDelete(id){ return apiJson(`/duels/${id}`, { method: 'DELETE' }); }
async function apiDuelReset(){ return apiJson('/duels/reset', { method: 'POST' }); }
async function apiUpdateLeaderboardSettings(leaderboard_opt_in, display_name){
  return apiJson('/account/leaderboard', {
    method: 'PUT',
    body: JSON.stringify({ leaderboard_opt_in, display_name })
  });
}
async function apiGetAccountStats(){
  return apiJson('/account/stats', { method: 'GET' });
}
async function apiForgotPassword(email){
  return apiJson('/auth/forgot', {
    method: 'POST',
    body: JSON.stringify({ email })
  });
}
async function apiResetPassword(token, password){
  return apiJson('/auth/reset', {
    method: 'POST',
    body: JSON.stringify({ token, password })
  });
}
async function apiLeaderboards(scope='global', poolId=null, limit=10){
  const q = new URLSearchParams();
  q.set('scope', scope);
  if(poolId) q.set('pool_id', poolId);
  q.set('limit', String(limit));
  return apiJson(`/leaderboards?${q.toString()}`, { method: 'GET' });
}

async function loadPools(){
  if(!accessToken){
    POOLS = [];
    POOLS_BY_NAME = new Map();
    POOLS_BY_ID = new Map();
    refreshPoolSelect();
    refreshSwipePoolSelect();
    return [];
  }
  const pools = await apiListPools();
  const raw = Array.isArray(pools) ? pools : [];
  const byName = new Map();
  for(const p of raw){
    const key = (p?.name || '').toLowerCase();
    if(!key) continue;
    const existing = byName.get(key);
    const pTime = new Date(p.updated_at || 0).getTime();
    const eTime = existing ? new Date(existing.updated_at || 0).getTime() : -1;
    if(!existing || (pTime && pTime >= eTime)){
      byName.set(key, p);
    }
  }
  POOLS = Array.from(byName.values());
  POOLS_BY_NAME = new Map(POOLS.map(p=>[p.name, p]));
  POOLS_BY_ID = new Map(POOLS.map(p=>[p.id, p]));
  POOL_LANGS = new Map();
  refreshPoolSelect(ACTIVE_POOL?.name);
  refreshSwipePoolSelect();
  if(currentUser){ loadLeitnerSets(); }
  return POOLS;
}
function refreshSwipePoolSelect(){
  const sel = $('#swipePoolSelect');
  if(!sel) return;
  const swipePools = POOLS.filter(p => (p?.name || '').startsWith('Swipe:'));
  sel.innerHTML = swipePools.length
    ? swipePools.map(p => `<option value="${escapeHtmlAttr(p.name)}">${escapeHtml(p.name.replace(/^Swipe:\\s*/, ''))}</option>`).join('')
    : `<option value="" disabled>${t('swipe.noPools', CURRENT_LANG)}</option>`;
  const desired = SWIPE.pool?.name || sel.value || (swipePools[0]?.name || '');
  if(desired && swipePools.some(p => p.name === desired)) sel.value = desired;
}
function refreshSpeedrunPoolSelect(){
  const sel = $('#speedrunPoolSelect');
  if(!sel) return;
  const swipePools = POOLS.filter(p => (p?.name || '').startsWith('Swipe:'));
  sel.innerHTML = swipePools.length
    ? swipePools.map(p => `<option value="${escapeHtmlAttr(p.name)}">${escapeHtml(p.name.replace(/^Swipe:\s*/, ''))}</option>`).join('')
    : `<option value="" disabled>${t('speedrun.pool', CURRENT_LANG)}</option>`;
  const desired = SPEEDRUN.pool?.name || sel.value || (swipePools[0]?.name || '');
  if(desired && swipePools.some(p => p.name === desired)) sel.value = desired;
}
function listPools(){ return POOLS.map(p=>p.name); }
async function getPoolLangs(poolId){
  if(!poolId) return [];
  if(POOL_LANGS.has(poolId)) return POOL_LANGS.get(poolId);
  try{
    const res = await apiGetPoolLangs(poolId);
    const langs = Array.isArray(res?.langs) ? res.langs : [];
    POOL_LANGS.set(poolId, langs);
    return langs;
  }catch{
    POOL_LANGS.set(poolId, []);
    return [];
  }
}
async function shouldFilterLang(poolId){
  const langs = await getPoolLangs(poolId);
  return langs.length > 1;
}
function listPoolsForLang(lang){
  return listPools();
}
function getPoolByName(name){ return POOLS_BY_NAME.get(name) || null; }
async function setActivePool(name, opts = {}){
  const pool = getPoolByName(name);
  if(!pool){ return false; }
  ACTIVE_POOL = pool;
  TRAIN.laterIds = new Set();
  TRAIN.laterLoaded = false;
  TRAIN.laterPoolId = pool.id;
  const filterLang = await shouldFilterLang(pool.id);
  const questions = await apiGetQuestions(pool.id, filterLang ? POOL_LANG : null);
  FRAGEN = mapApiQuestions(questions);
  await getPoolLangs(pool.id);
  const activeLabel = $('#activePoolLabel');
  if(activeLabel) activeLabel.textContent = pool.name;
  const examPool = $('#examPool');
  if(examPool) examPool.textContent = `${t('exam.poolLabel', CURRENT_LANG)} ${pool.name}`;
  refreshPoolSelect(pool.name);
  startTraining(false, opts);
  renderList();
  renderLeitnerStats();
  renderUserStats();
  window.QALists?.setActivePool?.(pool);
  updatePoolEditorAccess();
  return true;
}
async function createOrUpdatePool(name){
  if(!name) return;
  const existing = getPoolByName(name);
  if(existing){
    if(!canEditPool(existing)){
      await showAlert(t('pool.noPermission', CURRENT_LANG));
      return;
    }
    await apiUpdatePool(existing.id, name);
  }else{
    await apiCreatePool(name);
  }
  await loadPools();
  await setActivePool(name);
}
async function deletePoolByName(name){
  const pool = getPoolByName(name);
  if(!pool) return;
  if(!canEditPool(pool)){
    await showAlert(t('pool.noPermission', CURRENT_LANG));
    return;
  }
  await apiDeletePool(pool.id);
  await loadPools();
  const remaining = listPools();
  if(remaining.length){ await setActivePool(remaining[0]); }
  else { ACTIVE_POOL = null; FRAGEN = []; refreshPoolSelect(); renderList(); renderLeitnerStats(); renderUserStats(); }
}
function refreshPoolSelect(preset=null){
  const sel = $('#poolSelect');
  if(!sel) return;
  const idx = listPoolsForLang(POOL_LANG);
  sel.innerHTML = idx.length
    ? idx.map(n=>`<option value="${escapeHtmlAttr(n)}">${escapeHtml(n)}</option>`).join('')
    : `<option value="" disabled>${t('pool.noneForLang', CURRENT_LANG)}</option>`;
  const desired = preset || null;
  if(desired && idx.includes(desired)) sel.value = desired;
  syncPoolSelectors();
}
function syncPoolSelectors(){
  const pools = listPoolsForLang(POOL_LANG);
  const html = pools.length
    ? pools.map(n=>`<option value="${escapeHtmlAttr(n)}">${escapeHtml(n)}</option>`).join('')
    : `<option value="" disabled>${t('pool.noneForLang', CURRENT_LANG)}</option>`;
  const trainSel = $('#trainPoolSelect');
  if(trainSel){
    trainSel.innerHTML = html;
    if(ACTIVE_POOL?.name) trainSel.value = ACTIVE_POOL.name;
  }
  const examSel = $('#examPoolSelect');
  if(examSel){
    examSel.innerHTML = html;
    if(ACTIVE_POOL?.name) examSel.value = ACTIVE_POOL.name;
  }
  const leitnerSetPool = $('#leitnerSetPool');
  if(leitnerSetPool){
    leitnerSetPool.innerHTML = html;
    if(ACTIVE_POOL?.name) leitnerSetPool.value = ACTIVE_POOL.name;
  }
  const duelSel = $('#duelPoolSelect');
  if(duelSel){
    duelSel.innerHTML = html;
    if(ACTIVE_POOL?.name) duelSel.value = ACTIVE_POOL.name;
  }
}
$('#poolSelect')?.addEventListener('change', async (e)=>{
  const name = e.target.value;
  if(name) await setActivePool(name);
});
$('#trainPoolSelect')?.addEventListener('change', async (e)=>{ await setActivePool(e.target.value); });
$('#examPoolSelect')?.addEventListener('change', async (e)=>{ await setActivePool(e.target.value); });
$('#btnPoolCreate').addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const name = $('#poolName').value.trim() || $('#poolSelect').value;
  if(!name){ await showAlert('Bitte Poolnamen angeben.'); return; }
  try{
    await createOrUpdatePool(name);
    await showAlert('Pool angelegt/aktualisiert.', 'Pool');
  }catch(e){
    await showAlert('Pool speichern fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#btnPoolDelete').addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const name = $('#poolSelect').value || $('#poolName').value.trim();
  if(!name) return;
  const confirmed = await showConfirm(`Pool "${name}" wirklich lÃ¶schen?`, 'Pool lÃ¶schen');
  if(!confirmed) return;
  try{
    await deletePoolByName(name);
    await showAlert(`Pool "${name}" wurde gelÃ¶scht.`, 'Pool lÃ¶schen');
  }catch(e){
    await showAlert('Pool lÃ¶schen fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#btnPoolExport').addEventListener('click', async ()=>{
  const name = $('#poolSelect').value;
  if(!name){ await showAlert('Kein Pool ausgewÃ¤hlt.'); return; }
  const pool = getPoolByName(name);
  if(!pool){ await showAlert('Pool nicht gefunden.'); return; }
  try{
    const questions = await apiGetQuestions(pool.id);
    const poolObj = { name: pool.name, version: 'v9', created: Date.now(), fragen: mapApiQuestions(questions) };
    const blob = new Blob([JSON.stringify(poolObj, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `fragenpool_${encodeURIComponent(name)}.json`; a.click();
    URL.revokeObjectURL(url);
  }catch(e){
    await showAlert('Export fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#poolImportFile').addEventListener('change', async (e)=>{
  if(!currentUser){ e.target.value=''; return await showAlert('Bitte einloggen.'); }
  const file=e.target.files?.[0]; if(!file) return;
  const text = await file.text();
  try{
    const json = JSON.parse(text);
    let fragen = [];
    if(Array.isArray(json)){
      fragen = convertMaybeV7Array(json);
    }else if(Array.isArray(json.fragen)){
      fragen = convertMaybeV7Array(json.fragen);
    }else if(Array.isArray(json.questions)){
      fragen = convertFromV112(json.questions);
    }else{
      throw new Error('Unbekanntes JSON-Format.');
    }
    const suggested = (json?.name || file.name.replace(/\.[^.]+$/,'') || 'Neuer Fragenpool').toString().trim();
    let poolName = prompt('Name fÃ¼r den neuen Pool?', suggested)?.trim();
    if(!poolName){ throw new Error('Kein Poolname angegeben.'); }
    const existing = getPoolByName(poolName);
    if(existing){
      const overwrite = await showConfirm(`Pool "${poolName}" existiert bereits. Ãœberschreiben?`, 'Pool Import');
      if(overwrite){
        await apiDeletePool(existing.id);
      }else{
        let i = 2;
        let candidate = `${poolName} (${i})`;
        while(getPoolByName(candidate)){ i += 1; candidate = `${poolName} (${i})`; }
        poolName = candidate;
      }
    }
    const created = await apiCreatePool(poolName);
    await loadPools();
    const pool = created?.id ? created : getPoolByName(poolName);
    if(!pool){ throw new Error('Pool konnte nicht erstellt werden.'); }
    await apiImportPoolJson(pool.id, { fragen });
    await setActivePool(poolName);
    await showAlert(`Import erfolgreich: ${fragen.length} Fragen in Pool "${poolName}".`, 'Pool Import');
  }catch(err){
    await showAlert('Import fehlgeschlagen: '+err.message, 'Fehler');
  }finally{
    e.target.value='';
  }
});
$('#poolImportCsvFile').addEventListener('change', async (e)=>{
  if(!currentUser){ e.target.value=''; return await showAlert('Bitte einloggen.'); }
  const file=e.target.files?.[0]; if(!file) return;
  try{
    const csv = await file.text();
    const suggested = (file.name.replace(/\.[^.]+$/,'') || 'Neuer Fragenpool').toString().trim();
    let poolName = prompt('Name fÃ¼r den neuen Pool?', suggested)?.trim();
    if(!poolName){ throw new Error('Kein Poolname angegeben.'); }
    const existing = getPoolByName(poolName);
    if(existing){
      const overwrite = await showConfirm(`Pool "${poolName}" existiert bereits. Ãœberschreiben?`, 'CSV Import');
      if(overwrite){
        await apiDeletePool(existing.id);
      }else{
        let i = 2;
        let candidate = `${poolName} (${i})`;
        while(getPoolByName(candidate)){ i += 1; candidate = `${poolName} (${i})`; }
        poolName = candidate;
      }
    }
    const created = await apiCreatePool(poolName);
    await loadPools();
    const pool = created?.id ? created : getPoolByName(poolName);
    if(!pool){ throw new Error('Pool konnte nicht erstellt werden.'); }
    await apiImportPoolCsv(pool.id, csv);
    await setActivePool(poolName);
    await showAlert(`CSV importiert in Pool "${poolName}".`, 'CSV Import');
  }catch(err){
    await showAlert('CSV-Import fehlgeschlagen: ' + err.message, 'Fehler');
  }finally{
    e.target.value='';
  }
});
$('#btnPoolAiPrompt')?.addEventListener('click', (e)=>{
  e.preventDefault();
  downloadPoolCreatorPrompt();
});


/** ----------------------------
 *  Converters
 *  ---------------------------- */
function convertMaybeV7Array(arr){
  return arr.map(q=>{
    const out = {
      id: q.id || uid(),
      frage: q.frage || q.q || '',
      antworten: Array.isArray(q.antworten) ? q.antworten.map(a=>({id:a.id||uid(), text:a.text||String(a)||'', korrekt:!!a.korrekt})) :
                Array.isArray(q.choices) ? q.choices.map((t,i)=>({id:uid(), text:String(t), korrekt: Array.isArray(q.correct)? q.correct.includes(i) : false})) : [],
      erklaerung: q.erklaerung || q.explain || '',
      kategorie: q.kategorie || (Array.isArray(q.tags)? q.tags.join(', ') : ''),
      leitnerBox: Math.min(5, Math.max(1, q.leitnerBox||1)),
      stats: q.stats || {asked:0, correct:0, streak:0},
      bilder: Array.isArray(q.bilder) ? q.bilder : (Array.isArray(q.images) ? q.images : [])
    };
    if(!out.antworten.some(a=>a.korrekt) && Array.isArray(q.correct) && q.correct.length){
      out.antworten = out.antworten.map((a,i)=>({...a, korrekt: q.correct.includes(i)}));
    }
    return out;
  });
}
function convertFromV112(questions){
  return questions.map(q=>{
    const ans = (q.choices||[]).map((t,i)=>({id:uid(), text:String(t), korrekt:Array.isArray(q.correct)?q.correct.includes(i):false}));
    return {
      id: q.id || uid(),
      frage: q.q || '',
      antworten: ans,
      erklaerung: q.explain || '',
      kategorie: Array.isArray(q.tags) ? q.tags.join(', ') : '',
      leitnerBox: 1,
      stats: {asked:0, correct:0, streak:0},
      bilder: Array.isArray(q.bilder) ? q.bilder : (Array.isArray(q.images) ? q.images : [])
    };
  });
}
/** ----------------------------
 *  Render Question Helper
 *  ---------------------------- */
function renderQuestionInto(el, q, namePrefix, opts={}){
  const { shuffleAnswers=false, selectedIds=new Set(), showColors=false } = opts;
  let order = q.antworten.slice();
  if(shuffleAnswers) order = shuffle(order);
  const imgs = Array.isArray(q.bilder) ? q.bilder : [];
  const imagesHtml = imgs.length ? `
    <div class="q-images">
      ${imgs.map(img=>{
        const raw = img?.url || (img?.local ? (String(img.local).startsWith('/') ? img.local : `/images/${img.local}`) : '');
        if(!raw) return '';
        return `<figure class="q-image"><img src="${escapeHtmlAttr(String(raw))}" alt="${escapeHtmlAttr(String(img?.alt || ''))}" loading="lazy"></figure>`;
      }).join('')}
    </div>
  ` : '';
  const langToggleHtml = q.source_id ? buildLangToggle(q, namePrefix) : '';
  const html = `
    <div class="q-header-row"><div class="q-title">${escapeHtml(String(q.frage ?? ''))}</div>${langToggleHtml}</div>
    ${q.kategorie?`<div class="pill q-cat" title="${escapeHtmlAttr(String(q.kategorie ?? ''))}">${escapeHtml(shortenCategoryText(String(q.kategorie ?? '')))}</div>`:''}
    ${imagesHtml}
    <div class="hr"></div>
    <div class="answers">
      ${order.map(a=>{
        let cls = "item";
        if(showColors){
          if(a.korrekt){ cls += " ok"; }
          else if(selectedIds.has(a.id)){ cls += " bad"; }
        }
        const checked = selectedIds.has(a.id) ? "checked" : "";
        return `
        <div class="${cls}">
          <input type="checkbox" id="${escapeHtmlAttr(`${namePrefix}-${a.id}`)}" ${checked}>
          <label for="${escapeHtmlAttr(`${namePrefix}-${a.id}`)}" style="flex:1 1 auto; display:flex; align-items:center; justify-content:space-between; gap:8px">
            <span>${escapeHtml(String(a.text ?? ''))}</span>
            ${showColors ? `<span class="mark" aria-hidden="true">${ a.korrekt ? 'âœ“' : (selectedIds.has(a.id) ? 'âœ—' : '') }</span>` : ``}
          </label>
        </div>`;
      }).join('')}
    </div>
    <div id="${namePrefix}-feedback" class="muted"></div>
  `;
  el.innerHTML = html;
}
function getOriginalLangForPool(name){
  const poolName = String(name || '');
  if(poolName.startsWith('CCNA')) return 'en';
  return 'de';
}
function langLabel(lang){
  return t(`lang.name.${lang}`, CURRENT_LANG) || lang.toUpperCase();
}
function buildLangToggle(q, namePrefix){
  if(!ACTIVE_POOL) return '';
  const availLangs = POOL_LANGS.get(ACTIVE_POOL.id) || [];
  if(availLangs.length < 2) return '';
  const orderedLangs = ['de','en','ru'].filter(l => availLangs.includes(l));
  if(orderedLangs.length < 2) return '';
  const current = q._displayLang || q.lang || 'de';
  const origLang = getOriginalLangForPool(ACTIVE_POOL.name);
  return `<div class="q-lang-toggle">${orderedLangs.map(l=>{
    const cls = `btn q-lang-btn${l===current?' active':''}${l===origLang?' orig':''}`;
    const title = l===origLang ? `${t('lang.originalPrefix', CURRENT_LANG)}: ${langLabel(origLang)}` : '';
    return `<button class="${cls}" data-lang="${l}" data-qid="${escapeHtmlAttr(q.id)}" data-prefix="${escapeHtmlAttr(namePrefix)}" onclick="toggleQuestionLang(this)"${title?` title="${escapeHtmlAttr(title)}"`:''}>${l.toUpperCase()}</button>`;
  }).join('')}</div>`;
}
async function toggleQuestionLang(btn){
  const lang = btn.dataset.lang;
  const qid = btn.dataset.qid;
  const prefix = btn.dataset.prefix;
  const el = btn.closest('.q-header-row')?.parentElement;
  if(!el) return;
  let originalQ = null;
  if(prefix === 'train') originalQ = FRAGEN.find(qq => qq.id === qid);
  else if(prefix === 'exam') originalQ = getExamQuestions().find(qq => qq.id === qid);
  else if(prefix === 'leitner') originalQ = LEITNER.session?.find(qq => qq.id === qid);
  else if(prefix.startsWith('duel')) originalQ = DUEL.questions?.find(qq => qq.id === qid);
  if(!originalQ) return;
  const currentDisplayLang = originalQ._displayLang || originalQ.lang || 'de';
  if(lang === currentDisplayLang) return;
  const origLang = originalQ._origLang || originalQ.lang || 'de';
  if(lang === origLang && originalQ._origTexts){
    originalQ.frage = originalQ._origTexts.frage;
    originalQ.erklaerung = originalQ._origTexts.erklaerung;
    originalQ.bilder = originalQ._origTexts.bilder;
    for(const a of originalQ.antworten){
      if(originalQ._origTexts.answers[a.id]) a.text = originalQ._origTexts.answers[a.id];
    }
    originalQ._displayLang = origLang;
    const picks = getSelectedIds(prefix, originalQ);
    const showColors = el.querySelector('.ok, .bad') !== null;
    renderQuestionInto(el, originalQ, prefix, { shuffleAnswers:false, selectedIds:picks, showColors });
    return;
  }
  const cacheKey = `${qid}:${lang}`;
  let translated = TRANSLATION_CACHE.get(cacheKey);
  if(!translated){
    btn.disabled = true;
    try{ translated = mapApiQuestion(await apiGetTranslation(qid, lang)); }
    catch{ btn.disabled = false; btn.classList.add('unavailable'); return; }
    btn.disabled = false;
    TRANSLATION_CACHE.set(cacheKey, translated);
  }
  if(!originalQ._origTexts){
    originalQ._origLang = origLang;
    originalQ._origTexts = {
      frage: originalQ.frage,
      erklaerung: originalQ.erklaerung,
      bilder: originalQ.bilder,
      answers: {}
    };
    for(const a of originalQ.antworten) originalQ._origTexts.answers[a.id] = a.text;
  }
  originalQ.frage = translated.frage;
  originalQ.erklaerung = translated.erklaerung;
  originalQ.bilder = translated.bilder;
  const srcMap = new Map();
  for(const ta of translated.antworten) if(ta.source_id) srcMap.set(ta.source_id, ta.text);
  for(const a of originalQ.antworten){
    if(a.source_id && srcMap.has(a.source_id)) a.text = srcMap.get(a.source_id);
  }
  originalQ._displayLang = lang;
  const picks = getSelectedIds(prefix, originalQ);
  const showColors = el.querySelector('.ok, .bad') !== null;
  renderQuestionInto(el, originalQ, prefix, { shuffleAnswers:false, selectedIds:picks, showColors });
}
function getSelectedIds(prefix, q){
  const picks = new Set();
  for(const a of q.antworten){
    const box = $('#'+prefix+'-'+a.id);
    if(box && box.checked) picks.add(a.id);
  }
  return picks;
}
function isAnswerCorrect(q, picks){
  const correctIds = new Set(q.antworten.filter(a=>a.korrekt).map(a=>a.id));
  if(picks.size !== correctIds.size) return false;
  for(const id of picks){ if(!correctIds.has(id)) return false; }
  return true;
}
/** ----------------------------
 *  Training
 *  ---------------------------- */
function buildTrainOrder(shuffleQ=false){
  const useWrong = TRAIN.useWrongOnly && TRAIN.wrongIds && TRAIN.wrongIds.size;
  const useLater = TRAIN.useLaterOnly && TRAIN.laterIds && TRAIN.laterIds.size;
  const indices = useWrong
    ? FRAGEN.map((q,i)=> TRAIN.wrongIds.has(q.id) ? i : -1).filter(i=>i>=0)
    : useLater
      ? FRAGEN.map((q,i)=> TRAIN.laterIds.has(q.id) ? i : -1).filter(i=>i>=0)
      : FRAGEN.map((_,i)=>i);
  TRAIN.order = indices;
  if(shuffleQ) TRAIN.order.sort(()=>Math.random()-.5);
  TRAIN.idx = 0; TRAIN.checked = false;
}
function startTraining(shuffleQ=false, opts = {}){
  buildTrainOrder(shuffleQ);
  if(opts?.preserveIndex){
    const prevIdx = Math.max(0, parseInt(opts.prevIdx ?? 0, 10));
    if(Number.isFinite(prevIdx)){
      TRAIN.idx = Math.min(prevIdx, Math.max(0, TRAIN.order.length - 1));
    }
  }
  renderTrainQuestion();
}
function renderTrainProgress(){
  const total = TRAIN.order.length || 1;
  const pos = Math.min(TRAIN.idx+1, total);
  $('#trainProgress').textContent = `Frage ${pos} / ${total}`;
  $('#trainBar').style.width = ((pos-1)/total*100).toFixed(1)+'%';
}
function renderTrainQuestion(){
  if(!TRAIN.order.length){
    const key = TRAIN.useWrongOnly ? 'train.wrongEmpty' : (TRAIN.useLaterOnly ? 'train.laterEmpty' : 'train.empty');
    $('#trainQuestionWrap').innerHTML = `<div class="muted">${t(key, CURRENT_LANG)}</div>`;
    return;
  }
  const q = FRAGEN[ TRAIN.order[TRAIN.idx] ];
  renderQuestionInto($('#trainQuestionWrap'), q, 'train', {shuffleAnswers:true, selectedIds:new Set(), showColors:false});
  updateLaterMarkButton(q);
  ensureLaterIds().then(()=>{
    const current = FRAGEN[ TRAIN.order[TRAIN.idx] ];
    if(current && current.id === q.id) updateLaterMarkButton(q);
  });
  const catEl = $('#trainCategory');
  if(catEl){
    if(q.kategorie && String(q.kategorie).trim()){
      catEl.textContent = String(q.kategorie).trim();
      catEl.style.display = 'inline-flex';
    }else{
      catEl.style.display = 'none';
    }
  }
  const exEl = $('#trainExplain');
  const exBtn = $('#btnTrainExplain');
  if(exEl){ exEl.style.display = 'none'; exEl.textContent = ''; }
  TRAIN.showExplain = false;
  if(exBtn){
    if(q.erklaerung && String(q.erklaerung).trim()){
      exBtn.style.display = 'inline-flex';
      exBtn.disabled = false;
      exBtn.textContent = 'ErklÃ¤rung/LÃ¶sungshinweis';
    }else{
      exBtn.style.display = 'none';
    }
  }
  renderTrainProgress();
}
async function ensureLaterIds(){
  if(!currentUser || !ACTIVE_POOL?.id) return;
  if(TRAIN.laterLoaded && TRAIN.laterPoolId === ACTIVE_POOL.id) return;
  try{
    const res = await apiTrainingLater(ACTIVE_POOL.id);
    TRAIN.laterIds = new Set(Array.isArray(res?.ids) ? res.ids : []);
    TRAIN.laterLoaded = true;
    TRAIN.laterPoolId = ACTIVE_POOL.id;
  }catch(e){
    TRAIN.laterLoaded = false;
  }
}
function updateLaterMarkButton(q){
  const btn = $('#btnTrainLaterMark');
  if(!btn) return;
  const marked = !!(q && TRAIN.laterIds && TRAIN.laterIds.has(q.id));
  btn.setAttribute('aria-pressed', marked ? 'true' : 'false');
  btn.classList.toggle('primary', marked);
  btn.disabled = !currentUser;
}
function trainPrev(){
  if(!TRAIN.order.length) return;
  TRAIN.idx = (TRAIN.idx - 1 + TRAIN.order.length) % TRAIN.order.length;
  TRAIN.checked = false;
  renderTrainQuestion();
}
function trainNext(){
  if(!TRAIN.order.length) return;
  TRAIN.idx = (TRAIN.idx + 1) % TRAIN.order.length;
  TRAIN.checked = false;
  renderTrainQuestion();
}
$('#btnTrainShuffle').addEventListener('click', ()=>startTraining(true));
$('#btnTrainWrongToggle')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const btn = $('#btnTrainWrongToggle');
  const laterBtn = $('#btnTrainLaterToggle');
  TRAIN.useWrongOnly = !TRAIN.useWrongOnly;
  if(TRAIN.useWrongOnly){
    TRAIN.useLaterOnly = false;
    if(laterBtn) laterBtn.classList.remove('primary');
    if(!ACTIVE_POOL?.id){
      TRAIN.useWrongOnly = false;
      return await showAlert('Kein aktiver Pool.');
    }
    try{
      const res = await apiTrainingWrong(ACTIVE_POOL.id);
      TRAIN.wrongIds = new Set(Array.isArray(res?.ids) ? res.ids : []);
    }catch(e){
      TRAIN.useWrongOnly = false;
      if(btn) btn.classList.remove('primary');
      return await showAlert('Fehlerliste konnte nicht geladen werden: ' + e.message, 'Fehler');
    }
  }
  if(btn) btn.classList.toggle('primary', TRAIN.useWrongOnly);
  startTraining(false);
});
$('#btnTrainLaterToggle')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const btn = $('#btnTrainLaterToggle');
  const wrongBtn = $('#btnTrainWrongToggle');
  TRAIN.useLaterOnly = !TRAIN.useLaterOnly;
  if(TRAIN.useLaterOnly){
    TRAIN.useWrongOnly = false;
    if(wrongBtn) wrongBtn.classList.remove('primary');
    if(!ACTIVE_POOL?.id){
      TRAIN.useLaterOnly = false;
      return await showAlert('Kein aktiver Pool.');
    }
    try{
      const res = await apiTrainingLater(ACTIVE_POOL.id);
      TRAIN.laterIds = new Set(Array.isArray(res?.ids) ? res.ids : []);
    }catch(e){
      TRAIN.useLaterOnly = false;
      if(btn) btn.classList.remove('primary');
      return await showAlert('Liste fÃ¼r spÃ¤teres Lernen konnte nicht geladen werden: ' + e.message, 'Fehler');
    }
  }
  if(btn) btn.classList.toggle('primary', TRAIN.useLaterOnly);
  startTraining(false);
});
$('#btnTrainLaterMark')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const q = FRAGEN[ TRAIN.order[TRAIN.idx] ];
  if(!q) return;
  await ensureLaterIds();
  const marked = TRAIN.laterIds.has(q.id);
  const next = !marked;
  try{
    await apiTrainingLaterMark(q.id, next);
    if(next) TRAIN.laterIds.add(q.id);
    else TRAIN.laterIds.delete(q.id);
    updateLaterMarkButton(q);
  }catch(e){
    await showAlert('Konnte nicht gespeichert werden: ' + e.message, 'Fehler');
  }
});
$('#btnTrainResetStats').addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  if(!ACTIVE_POOL?.id) return await showAlert('Kein aktiver Pool.');
  const confirmed = await showConfirm('Training-Statistik fÃ¼r diesen Pool wirklich zurÃ¼cksetzen?', 'Training zurÃ¼cksetzen');
  if(!confirmed) return;
  try{
    await apiTrainingReset(ACTIVE_POOL.id);
    renderLeitnerStats();
    renderUserStats();
    startTraining(false);
    await showAlert('Training-Statistik zurÃ¼ckgesetzt.', 'Training zurÃ¼cksetzen');
  }catch(e){
    await showAlert('Reset fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#btnTrainPrev').addEventListener('click', trainPrev);
$('#btnTrainNext').addEventListener('click', trainNext);
$('#btnTrainCheck').addEventListener('click', async ()=>{
  const q = FRAGEN[ TRAIN.order[TRAIN.idx] ];
  const picks = Array.from(getSelectedIds('train', q).values());
  try{
    const result = await apiTrainingAnswer(q.id, picks);
    const ok = !!result?.correct;
    const fb = $('#train-feedback');
    if(fb){
      fb.innerHTML = ok ? `<div style="color:#86efac">Richtig!${q.erklaerung?'<br>'+escapeHtml(q.erklaerung):''}</div>`
                        : `<div style="color:#fecaca">Leider falsch.${q.erklaerung?'<br>'+escapeHtml(q.erklaerung):''}</div>`;
    }
    renderQuestionInto($('#trainQuestionWrap'), q, 'train', {shuffleAnswers:false, selectedIds:new Set(picks), showColors:true});
    TRAIN.checked = true;
    if(TRAIN.useWrongOnly && ok){
      TRAIN.wrongIds.delete(q.id);
      if(!TRAIN.wrongIds.size){
        startTraining(false);
      }
    }
    if(TRAIN.useLaterOnly && ok){
      TRAIN.laterIds.delete(q.id);
      if(!TRAIN.laterIds.size){
        startTraining(false);
      }
    }
    if(ok && TRAIN.laterIds?.has(q.id)){
      TRAIN.laterIds.delete(q.id);
      updateLaterMarkButton(q);
    }
  }catch(e){
    await showAlert('Antwort konnte nicht gespeichert werden: ' + e.message, 'Fehler');
  }
});
$('#btnTrainShuffle')?.addEventListener('click', ()=>{
  const btn = $('#btnTrainShuffle');
  const active = btn.getAttribute('aria-pressed') === 'true';
  const next = !active;
  btn.setAttribute('aria-pressed', next ? 'true' : 'false');
  startTraining(next);
});
$('#btnTrainInfo')?.addEventListener('click', async ()=>{
  await showAlert(t('train.info', CURRENT_LANG), t('train.title', CURRENT_LANG));
});
/** ----------------------------
 *  Swipe
 *  ---------------------------- */
const SWIPE_TRUE_TEXTS = new Set(['richtig', 'true', 'wahr', 'Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°']);
const SWIPE_FALSE_TEXTS = new Set(['falsch', 'false', 'Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾', 'Ğ»Ğ¾Ğ¶ÑŒ']);
function normalizeSwipeAnswerText(text){
  return String(text || '').trim().toLowerCase();
}
function swipeKey(q){
  return q?.source_id || q?.id || '';
}
function findSwipeAnswer(q, direction){
  const set = direction === 'right' ? SWIPE_TRUE_TEXTS : SWIPE_FALSE_TEXTS;
  let found = q.antworten.find(a => set.has(normalizeSwipeAnswerText(a.text)));
  if(!found){
    found = direction === 'right' ? q.antworten[0] : (q.antworten[1] || q.antworten[0]);
  }
  return found || null;
}
async function loadSwipePool(poolName, opts = {}){
  const pool = getPoolByName(poolName);
  if(!pool) return;
  const preserve = !!opts.preserve;
  const prevOrder = preserve ? SWIPE.questions.map(q => swipeKey(q)).filter(Boolean) : [];
  const prevKey = preserve ? swipeKey(SWIPE.questions[SWIPE.idx]) : '';
  const prevAnswered = preserve ? new Set(SWIPE.answered) : new Set();
  SWIPE.pool = pool;
  await getPoolLangs(pool.id);
  const filterLang = await shouldFilterLang(pool.id);
  const questions = await apiGetQuestions(pool.id, filterLang ? POOL_LANG : null);
  let mapped = mapApiQuestions(questions);
  if(preserve && prevOrder.length){
    const byKey = new Map(mapped.map(q => [swipeKey(q), q]));
    const ordered = prevOrder.map(k => byKey.get(k)).filter(Boolean);
    const remaining = mapped.filter(q => !prevOrder.includes(swipeKey(q)));
    mapped = ordered.concat(remaining);
  }else{
    mapped = shuffle(mapped);
  }
  SWIPE.questions = mapped;
  if(!preserve){
    SWIPE.idx = 0;
    SWIPE.correct = 0;
    SWIPE.wrong = 0;
    SWIPE.answered = new Set();
  }else{
    SWIPE.answered = prevAnswered;
    const idx = prevKey ? SWIPE.questions.findIndex(q => swipeKey(q) === prevKey) : -1;
    if(idx >= 0) SWIPE.idx = idx;
  }
  SWIPE.phase = 'front';
  showSwipeFront();
}
function showSwipeFront(){
  const q = SWIPE.questions[SWIPE.idx];
  const card = $('#swipeCard');
  const back = $('#swipeBack');
  const result = $('#swipeResult');
  renderSwipeLangToggle();
  if(result) result.classList.add('hidden');
  if(!q){
    showSwipeResult();
    return;
  }
  SWIPE.phase = 'front';
  if(card){
    card.classList.remove('hidden','swipe-out-right','swipe-out-left','swiping-right','swiping-left');
    card.style.transform = '';
    card.style.opacity = '1';
  }
  if(back) back.classList.add('hidden');
  $('#swipeControls')?.classList.remove('hidden');
  $('#swipeStatement').textContent = q.frage;
  $('#swipeCategory').textContent = q.kategorie || '';
  $('#swipeProgress').textContent = `${SWIPE.idx + 1} / ${SWIPE.questions.length}`;
  $('#swipeScore').textContent = `âœ… ${SWIPE.correct}  âŒ ${SWIPE.wrong}`;
}
function renderSwipeLangToggle(){
  const wrap = $('#swipeLangToggle');
  if(!wrap) return;
  const pool = SWIPE.pool;
  if(!pool){ wrap.innerHTML = ''; return; }
  const langs = POOL_LANGS.get(pool.id) || [];
  const ordered = ['de','en','ru'].filter(l => langs.includes(l));
  if(ordered.length < 2){ wrap.innerHTML = ''; return; }
  wrap.innerHTML = ordered.map(l=>{
    const cls = `btn q-lang-btn${l===POOL_LANG?' active':''}`;
    return `<button class="${cls}" data-swipe-lang="${l}">${l.toUpperCase()}</button>`;
  }).join('');
  wrap.querySelectorAll('button[data-swipe-lang]').forEach(btn=>{
    btn.addEventListener('click', async (e)=>{
      const lang = e.currentTarget.dataset.swipeLang;
      if(!lang || lang===POOL_LANG) return;
      POOL_LANG = lang;
      localStorage.setItem(POOL_LANG_KEY(PROFILE_ID), lang);
      if(SWIPE.pool?.name) await loadSwipePool(SWIPE.pool.name, { preserve: true });
    });
  });
}
async function submitSwipeAnswer(direction){
  if(SWIPE.phase !== 'front') return;
  const q = SWIPE.questions[SWIPE.idx];
  const key = swipeKey(q);
  if(!q || (key && SWIPE.answered.has(key))) return;
  const chosenAnswer = findSwipeAnswer(q, direction);
  if(!chosenAnswer) return;
  if(key) SWIPE.answered.add(key);
  const card = $('#swipeCard');
  card?.classList.add(direction === 'right' ? 'swipe-out-right' : 'swipe-out-left');
  try{
    const result = await apiSwipeAnswer(q.id, chosenAnswer.id);
    const ok = !!result?.correct;
    if(ok) SWIPE.correct++; else SWIPE.wrong++;
    const resultEl = $('#swipeBackResult');
    if(resultEl){
      resultEl.className = `swipe-back-result ${ok ? 'swipe-correct' : 'swipe-wrong'}`;
      resultEl.innerHTML = ok
        ? `${icon('check', 'swipe-result-icon icon--ok')} ${t('swipe.correctMsg', CURRENT_LANG)}`
        : `${icon('x', 'swipe-result-icon icon--bad')} ${t('swipe.wrongMsg', CURRENT_LANG)}`;
    }
    $('#swipeBackExplanation').textContent = q.erklaerung || '';
    $('#swipeScore').textContent = `âœ… ${SWIPE.correct}  âŒ ${SWIPE.wrong}`;

    const leitnerBtn = $('#btnSwipeLeitner');
    if(leitnerBtn){
      leitnerBtn.classList.toggle('hidden', !currentUser || !ACTIVE_LEITNER_SET);
      leitnerBtn.textContent = t('swipe.addLeitner', CURRENT_LANG);
      leitnerBtn.disabled = false;
      leitnerBtn.onclick = () => addSwipeToLeitner(q);
    }
    setTimeout(()=>{
      card?.classList.add('hidden');
      $('#swipeBack')?.classList.remove('hidden');
      $('#swipeControls')?.classList.add('hidden');
      SWIPE.phase = 'back';
    }, 300);
  }catch(e){
    if(key) SWIPE.answered.delete(key);
    card?.classList.remove('swipe-out-right','swipe-out-left');
    card && (card.style.transform = '');
    card && (card.style.opacity = '1');
    console.warn('Swipe answer failed:', e);
  }
}
async function addSwipeToLeitner(q){
  if(!currentUser || !ACTIVE_LEITNER_SET) return;
  try{
    await apiLeitnerAnswer(q.id, 'wrong', ACTIVE_LEITNER_SET.id);
    const btn = $('#btnSwipeLeitner');
    if(btn){
      btn.textContent = t('swipe.addedLeitner', CURRENT_LANG);
      btn.disabled = true;
    }
  }catch(e){
    console.warn('Leitner add failed:', e);
  }
}
function showSwipeResult(){
  SWIPE.phase = 'done';
  const total = SWIPE.questions.length;
  const pct = total ? Math.round(SWIPE.correct / total * 100) : 0;
  $('#swipeControls')?.classList.add('hidden');
  $('#swipeCard')?.classList.add('hidden');
  $('#swipeBack')?.classList.add('hidden');
  const result = $('#swipeResult');
  if(!result) return;
  result.classList.remove('hidden');
  result.innerHTML = `
    <div class="swipe-result">
      <h3>${t('swipe.done', CURRENT_LANG)}</h3>
      <div class="swipe-result-score">${pct}%</div>
      <div>âœ… ${SWIPE.correct}  âŒ ${SWIPE.wrong}  (${total} ${t('swipe.total', CURRENT_LANG)})</div>
      <button class="btn primary" id="btnSwipeRestart">${t('swipe.restart', CURRENT_LANG)}</button>
    </div>`;
  $('#btnSwipeRestart')?.addEventListener('click', ()=>{
    if(SWIPE.pool?.name) loadSwipePool(SWIPE.pool.name);
  });
}
function initSwipeGestures(){
  const card = $('#swipeCard');
  if(!card) return;
  let startX = 0;
  let dx = 0;
  let dragging = false;
  const THRESHOLD = 80;
  function onStart(e){
    if(SWIPE.phase !== 'front') return;
    const key = swipeKey(SWIPE.questions[SWIPE.idx]);
    if(key && SWIPE.answered.has(key)) return;
    dragging = true;
    const pt = e.touches ? e.touches[0] : e;
    startX = pt.clientX;
    card.style.transition = 'none';
  }
  function onMove(e){
    if(!dragging) return;
    const pt = e.touches ? e.touches[0] : e;
    dx = pt.clientX - startX;
    const rotate = dx * 0.1;
    card.style.transform = `translateX(${dx}px) rotate(${rotate}deg)`;
    card.classList.toggle('swiping-right', dx > THRESHOLD / 2);
    card.classList.toggle('swiping-left', dx < -THRESHOLD / 2);
  }
  function onEnd(){
    if(!dragging) return;
    dragging = false;
    card.style.transition = 'transform .3s ease, opacity .3s ease';
    if(dx > THRESHOLD) submitSwipeAnswer('right');
    else if(dx < -THRESHOLD) submitSwipeAnswer('left');
    else { card.style.transform = ''; card.classList.remove('swiping-right','swiping-left'); }
    dx = 0;
  }
  card.addEventListener('mousedown', onStart);
  card.addEventListener('mousemove', onMove);
  card.addEventListener('mouseup', onEnd);
  card.addEventListener('mouseleave', onEnd);
  card.addEventListener('touchstart', onStart, { passive: true });
  card.addEventListener('touchmove', onMove, { passive: true });
  card.addEventListener('touchend', onEnd);
}
function initSpeedrunGestures(){
  const card = $('#speedrunCard');
  if(!card) return;
  let startX = 0;
  let dx = 0;
  let dragging = false;
  const THRESHOLD = 80;
  function onStart(e){
    if(!SPEEDRUN.running) return;
    dragging = true;
    const pt = e.touches ? e.touches[0] : e;
    startX = pt.clientX;
    card.style.transition = 'none';
  }
  function onMove(e){
    if(!dragging) return;
    const pt = e.touches ? e.touches[0] : e;
    dx = pt.clientX - startX;
    const rotate = dx * 0.1;
    card.style.transform = `translateX(${dx}px) rotate(${rotate}deg)`;
    card.classList.toggle('swiping-right', dx > THRESHOLD / 2);
    card.classList.toggle('swiping-left', dx < -THRESHOLD / 2);
  }
  function onEnd(){
    if(!dragging) return;
    dragging = false;
    card.style.transition = 'transform .3s ease, opacity .3s ease';
    if(dx > THRESHOLD) submitSpeedrunAnswer('right');
    else if(dx < -THRESHOLD) submitSpeedrunAnswer('left');
    else { card.style.transform = ''; card.classList.remove('swiping-right','swiping-left'); }
    dx = 0;
  }
  card.addEventListener('mousedown', onStart);
  card.addEventListener('mousemove', onMove);
  card.addEventListener('mouseup', onEnd);
  card.addEventListener('mouseleave', onEnd);
  card.addEventListener('touchstart', onStart, { passive: true });
  card.addEventListener('touchmove', onMove, { passive: true });
  card.addEventListener('touchend', onEnd);
}
$('#btnSwipeFalse')?.addEventListener('click', ()=> submitSwipeAnswer('left'));
$('#btnSwipeTrue')?.addEventListener('click', ()=> submitSwipeAnswer('right'));
$('#btnSwipeNext')?.addEventListener('click', ()=>{
  if(SWIPE.phase !== 'back') return;
  SWIPE.idx++;
  showSwipeFront();
});
$('#swipePoolSelect')?.addEventListener('change', e => loadSwipePool(e.target.value));
$('#btnExamInfo')?.addEventListener('click', async ()=>{
  await showAlert(t('exam.info', CURRENT_LANG), t('exam.title', CURRENT_LANG));
});
$('#btnLeitnerInfo')?.addEventListener('click', ()=>{
  const ov = $('#leitnerInfoOverlay');
  if(!ov) return;
  ov.classList.add('active');
  ov.setAttribute('aria-hidden','false');
});
$('#btnLeitnerInfoClose')?.addEventListener('click', ()=>{
  const ov = $('#leitnerInfoOverlay');
  if(!ov) return;
  ov.classList.remove('active');
  ov.setAttribute('aria-hidden','true');
});
$('#leitnerSetSelect')?.addEventListener('change', async (e)=>{
  const id = e.target.value;
  ACTIVE_LEITNER_SET = LEITNER_SETS.find(s=>s.id===id) || null;
  setStoredLeitnerSetId(ACTIVE_LEITNER_SET?.id || null);
  updateLeitnerSetInfo();
  renderLeitnerSetCards();
  await renderLeitnerStats();
});
$('#leitnerInfoOverlay')?.addEventListener('click', (e)=>{
  if(e.target?.id !== 'leitnerInfoOverlay') return;
  const ov = $('#leitnerInfoOverlay');
  if(!ov) return;
  ov.classList.remove('active');
  ov.setAttribute('aria-hidden','true');
});
$('#btnLeitnerSetCreate')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  const name = $('#leitnerSetName')?.value?.trim();
  const poolName = $('#leitnerSetPool')?.value;
  const mode = $('#leitnerSetMode')?.value || 'simple';
  const pool = getPoolByName(poolName);
  if(!name) return await showAlert(t('leitner.setNameNeed', CURRENT_LANG));
  if(!pool) return await showAlert(t('leitner.setPoolNeed', CURRENT_LANG));
  try{
    const set = await apiLeitnerSetCreate(name, pool.id, mode);
    $('#leitnerSetName').value = '';
    await loadLeitnerSets(set.id);
  }catch(e){
    await showAlert(t('leitner.setCreateErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnLeitnerSetDelete')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  if(!ACTIVE_LEITNER_SET) return;
  const confirmed = await showConfirm(t('leitner.setDeleteConfirm', CURRENT_LANG), t('leitner.title', CURRENT_LANG));
  if(!confirmed) return;
  try{
    await apiLeitnerSetDelete(ACTIVE_LEITNER_SET.id);
    await loadLeitnerSets();
    await showAlert(t('leitner.setDeleteOk', CURRENT_LANG) || 'Set gelÃ¶scht', t('leitner.title', CURRENT_LANG));
  }catch(e){
    await showAlert(t('leitner.setDeleteErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnTrainExplain').addEventListener('click', ()=>{
  const exEl = $('#trainExplain');
  const exBtn = $('#btnTrainExplain');
  const q = FRAGEN[ TRAIN.order[TRAIN.idx] ];
  if(!q || !q.erklaerung) return;
  TRAIN.showExplain = !TRAIN.showExplain;
  if(TRAIN.showExplain){
    exEl.innerHTML = escapeHtml(q.erklaerung);
    exEl.style.display = 'block';
    if(exBtn) exBtn.textContent = 'ErklÃ¤rung/LÃ¶sungshinweis';
  }else{
    exEl.style.display = 'none';
    if(exBtn) exBtn.textContent = 'ErklÃ¤rung/LÃ¶sungshinweis';
  }
});
/** ----------------------------
 *  Exam
 *  ---------------------------- */
$('#btnStartExam').addEventListener('click', async ()=>{
  if(!FRAGEN.length){ await showAlert('Im aktiven Pool sind keine Fragen.'); return; }
  const n = Math.max(1, Math.min(FRAGEN.length, parseInt($('#examCount').value||'1',10)));
  const mins = Math.max(0, parseInt($('#examMinutes').value||'0',10));
  try{
    const session = await apiExamStart(ACTIVE_POOL.id, n, mins);
    EXAM.sessionId = session?.id || null;
    EXAM_QUESTIONS = Array.isArray(session?.questions) ? mapApiQuestions(session.questions) : [];
  }catch(e){
    await showAlert('PrÃ¼fung konnte nicht gestartet werden: ' + e.message, 'Fehler');
    return;
  }
  const source = getExamQuestions();
  EXAM.running = true; EXAM.idx = 0; EXAM.count = Math.min(n, source.length); EXAM.startTs = now(); EXAM.endTs = 0; EXAM.answers = {}; EXAM.answerOrder={};
  EXAM.order = source.map((_,i)=>i).sort(()=>Math.random()-.5).slice(0, EXAM.count);
  for(const i of EXAM.order){
    const q = source[i];
    EXAM.answerOrder[q.id] = shuffle(q.antworten.map(a=>a.id));
  }
  clearInterval(EXAM.timerId); EXAM.timerId = null;
  if(mins>0){
    EXAM.minutes = mins;
    EXAM.deadline = EXAM.startTs + mins*60*1000;
    updateTimer();
    EXAM.timerId = setInterval(()=>{
      updateTimer();
      if(now() >= EXAM.deadline){ clearInterval(EXAM.timerId); EXAM.timerId=null; autoSubmitExam(); }
    }, 300);
  }else{
    $('#examTimer').textContent = 'â³ kein Limit';
    EXAM.deadline = 0;
  }
  $('#examResult').classList.add('hidden');
  $('#examArea').classList.remove('hidden');
  renderExamNav();
  renderExamQuestion();
  if(mins > 0){
    renderSnakeTimer();
    $('#btnExamPause').style.display = '';
  }else{
    $('#btnExamPause').style.display = 'none';
  }
});
function updateTimer(){
  const remain = Math.max(0, EXAM.deadline - now());
  const s = Math.floor(remain/1000);
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  $('#examTimer').textContent = `â³ ${mm}:${ss}`;
  updateSnakeTimer();
}
function renderSnakeTimer() {
  const wrap = $('#examQuestionWrap');
  if (!wrap || !EXAM.running || EXAM.minutes <= 0) return;

  // Remove existing snake
  const existing = wrap.querySelector('.exam-timer-snake');
  if (existing) existing.remove();

  // Create SVG container
  const snake = document.createElement('div');
  snake.className = 'exam-timer-snake';

  const rect = wrap.getBoundingClientRect();
  const w = rect.width;
  const h = rect.height;
  const perimeter = 2 * (w + h);
  const circumference = perimeter;

  snake.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
      <rect x="1.5" y="1.5" width="${w-3}" height="${h-3}" rx="8"
        stroke-dasharray="${circumference}"
        stroke-dashoffset="0"
        id="examSnakeRect" />
    </svg>`;

  wrap.style.position = 'relative';
  wrap.prepend(snake);
}

function updateSnakeTimer() {
  if (!EXAM.running || EXAM.minutes <= 0) return;

  const rect = $('#examSnakeRect');
  const snakeWrap = $('.exam-timer-snake');
  if (!rect || !snakeWrap) return;

  const remain = Math.max(0, EXAM.deadline - Date.now());
  const total = EXAM.minutes * 60 * 1000;
  const progress = remain / total;

  const circumference = parseFloat(rect.getAttribute('stroke-dasharray'));
  const offset = circumference * (1 - progress);
  rect.style.strokeDashoffset = offset;

  // Color transitions
  snakeWrap.classList.toggle('warning', progress < 0.33 && progress >= 0.1);
  snakeWrap.classList.toggle('danger', progress < 0.1);
}

function removeSnakeTimer() {
  const snakes = document.querySelectorAll('.exam-timer-snake');
  snakes.forEach(s => s.remove());
}

function autoSubmitExam(){
  if(!EXAM.running) return;
  storeExamCurrent();
  EXAM.endTs = now(); EXAM.running = false;
  gradeExam(true);
}
$('#btnExamPrev').addEventListener('click', ()=>{
  if(!EXAM.running) return;
  storeExamCurrent();
  EXAM.idx = Math.max(0, EXAM.idx-1);
  renderExamQuestion();
});
$('#btnExamNext').addEventListener('click', ()=>{
  if(!EXAM.running) return;
  storeExamCurrent();
  if(EXAM.idx < EXAM.count-1){ EXAM.idx++; renderExamQuestion(); }
});
$('#btnExamPause')?.addEventListener('click', ()=>{
  if(!EXAM.running) return;
  if(EXAM.timerId){
    clearInterval(EXAM.timerId);
    EXAM.timerId = null;
    $('#btnExamPause').innerHTML = '<svg class="icon" width="20" height="20"><use href="#icon-zap"></use></svg>';
    $('#btnExamPause').title = 'Fortsetzen';
  }else if(EXAM.deadline > 0){
    // Resume: adjust deadline
    const elapsed = now() - EXAM.startTs;
    const shouldHaveLeft = (EXAM.minutes * 60000) - elapsed;
    EXAM.deadline = now() + shouldHaveLeft;
    EXAM.timerId = setInterval(updateTimer, 300);
    $('#btnExamPause').innerHTML = '<svg class="icon" width="20" height="20"><use href="#icon-pause"></use></svg>';
    $('#btnExamPause').title = 'Pausieren';
  }
});
$('#btnExamAbort')?.addEventListener('click', async ()=>{
  if(!EXAM.running) return;
  const confirmed = await showConfirm(
    t('exam.abortConfirm', CURRENT_LANG) || 'PrÃ¼fung wirklich abbrechen?',
    t('exam.title', CURRENT_LANG) || 'PrÃ¼fung'
  );
  if(!confirmed) return;
  EXAM.running = false;
  if(EXAM.timerId){ clearInterval(EXAM.timerId); EXAM.timerId = null; }
  removeSnakeTimer();
  $('#examArea').classList.add('hidden');
  await showAlert(t('exam.aborted', CURRENT_LANG) || 'PrÃ¼fung abgebrochen', t('exam.title', CURRENT_LANG) || 'PrÃ¼fung');
});
function renderExamQuestion(){
  const i = EXAM.order[EXAM.idx];
  const q = getExamQuestions()[i];
  const selected = new Set(EXAM.answers[q.id]||[]);
  renderQuestionInto($('#examQuestionWrap'), q, 'exam', {shuffleAnswers:false, selectedIds:selected, showColors:false});
  const orderIds = EXAM.answerOrder[q.id];
  if(orderIds && orderIds.length){
    const container = $('#examQuestionWrap .answers');
    const items = Array.from(container.children);
    items.sort((a,b)=>{
      const idA = a.querySelector('input[type="checkbox"]').id.replace('exam-','');
      const idB = b.querySelector('input[type="checkbox"]').id.replace('exam-','');
      return orderIds.indexOf(idA) - orderIds.indexOf(idB);
    }).forEach(n=>container.appendChild(n));
  }
  $('#examIndex').textContent = `${EXAM.idx+1} / ${EXAM.count}`;
  updateExamAnswered();
  renderExamNav();
}
function storeExamCurrent(){
  const idx = EXAM.order[EXAM.idx];
  const q = getExamQuestions()[idx];
  const picks = Array.from(getSelectedIds('exam', q).values());
  EXAM.answers[q.id] = picks;
  updateExamAnswered();

  // Auto-submit wenn alle Fragen beantwortet
  let answered = 0;
  for(const j of EXAM.order){
    const q = getExamQuestions()[j];
    if(EXAM.answers[q.id] && EXAM.answers[q.id].length>0) answered++;
  }
  if(answered === EXAM.count && EXAM.running){
    EXAM.endTs = now();
    EXAM.running = false;
    clearInterval(EXAM.timerId);
    EXAM.timerId = null;
    gradeExam(false);
  }
}
function updateExamAnswered(){
  let answered = 0;
  for(const j of EXAM.order){
    const q = getExamQuestions()[j];
    if(EXAM.answers[q.id] && EXAM.answers[q.id].length>0) answered++;
  }
  $('#examAnswered').textContent = `${t('exam.answeredLabel', CURRENT_LANG)} ${answered} / ${EXAM.count}`;
}
function renderExamNav(){
  const grid = $('#examNav');
  const btns = EXAM.order.map((i, idx)=>{
    const q = getExamQuestions()[i];
    const answered = EXAM.answers[q.id] && EXAM.answers[q.id].length>0;
    const cls = 'navbtn'+(answered?' answered':'')+(idx===EXAM.idx?' current':'');
    return `<div class="${cls}" data-j="${idx}">${idx+1}</div>`;
  }).join('');
  grid.innerHTML = btns;
  grid.querySelectorAll('.navbtn').forEach(b=>{
    b.addEventListener('click', ()=>{
      if(!EXAM.running) return;
      storeExamCurrent();
      EXAM.idx = parseInt(b.dataset.j,10);
      renderExamQuestion();
    });
  });
}
async function gradeExam(auto=false){
  let ok=0, total=EXAM.count;
  const blocks = [];
  const answersPayload = [];
  for(let j=0;j<EXAM.count;j++){
    const i = EXAM.order[j];
    const q = getExamQuestions()[i];
    const picks = new Set(EXAM.answers[q.id]||[]);
    const isOk = isAnswerCorrect(q, picks);
    if(isOk) ok++;
    const chosen = q.antworten.filter(a=>picks.has(a.id)).map(a=>a.text).join(' | ') || 'â€”';
    const correct = q.antworten.filter(a=>a.korrekt).map(a=>a.text).join(' | ');
    blocks.push(`
      <div class="panel" style="padding:12px; margin-bottom:8px">
        <div style="display:flex; gap:8px; align-items:center">
          <div class="pill">#${j+1}</div>
          <div class="grow"><b>${escapeHtml(q.frage)}</b></div>
          <div>${isOk?'<span style="color:#86efac">âœ“</span>':'<span style="color:#fecaca">âœ—</span>'}</div>
        </div>
        <div class="muted mono" style="margin-top:6px">Deine Auswahl: ${escapeHtml(chosen)}</div>
        <div class="muted mono">Korrekt: ${escapeHtml(correct)}</div>
      </div>
    `);
    answersPayload.push({ question_id: q.id, selected_answer_ids: Array.from(picks) });
  }
  const pct = Math.round(ok/total*100);

  // PrÃ¼fungsbombe entschÃ¤rft? ğŸ’£
  const allAnswered = Object.keys(EXAM.answers).filter(k => EXAM.answers[k]?.length > 0).length === total;
  const hadTimer = EXAM.minutes > 0 && EXAM.deadline > 0;
  const timeLeft = hadTimer && EXAM.deadline > EXAM.endTs;
  const defused = allAnswered && timeLeft && !auto;

  $('#examArea').classList.add('hidden');
  $('#examResult').classList.remove('hidden');
  removeSnakeTimer();
  $('#examResult').innerHTML = `
    <div class="row"><div class="grow">
      ${defused ? `<div style="font-size:28px; margin-bottom:12px">${icon('bomb', 'icon--xl')} PrÃ¼fungsbombe entschÃ¤rft! ğŸ‰</div>` : ''}
      <div style="font-size:22px; font-weight:700">Ergebnis: ${ok} / ${total} (${pct}%)</div>
      <div class="muted">Dauer: ${formatDuration((EXAM.endTs||now())-EXAM.startTs)}${EXAM.deadline? (auto?' â€¢ Zeit Ã¼berschritten â€“ automatisch abgegeben':''):''}</div>
      ${defused ? '<div class="muted" style="color:#86efac; font-weight:600">Alle Fragen beantwortet mit verbleibender Zeit â€“ du bist bereit fÃ¼rs echte Leben! ğŸš€</div>' : ''}
      <div class="muted">${escapeHtml(t('exam.poolLabel', CURRENT_LANG))} ${escapeHtml(ACTIVE_POOL?.name||'â€“')}</div>
    </div>
    <div><button class="btn" id="btnExamRestart">Neue PrÃ¼fung</button></div></div>
    <div class="hr"></div>
    ${blocks.join('')}
  `;
  $('#btnExamRestart').addEventListener('click', ()=>{
    $('#examResult').classList.add('hidden');
    $('#examArea').classList.add('hidden');
  });
  if(EXAM.sessionId){
    try{
      await apiExamSubmit(EXAM.sessionId, answersPayload);
    }catch(e){
      console.warn('Exam submit failed:', e);
    }
  }
}

function renderSnakeTimer() {
  const panel = $('#examArea');
  if (!panel) return;

  const existing = panel.querySelector('.exam-timer-snake');
  if (existing) existing.remove();

  const snake = document.createElement('div');
  snake.className = 'exam-timer-snake';

  const rect = panel.getBoundingClientRect();
  const w = rect.width + 20; // Breiter fÃ¼r Ãœberlappung
  const h = rect.height + 20;
  const padding = 10;
  const innerW = w - padding * 2;
  const innerH = h - padding * 2;

  // Rechteck-Path: Start oben-links, im Uhrzeigersinn
  const pathLength = 2 * (innerW + innerH);

  snake.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" style="position:absolute; top:-10px; left:-10px; width:calc(100% + 20px); height:calc(100% + 20px)">
      <rect x="${padding}" y="${padding}"
            width="${innerW}" height="${innerH}"
            rx="12" ry="12"
            fill="none"
            stroke-dasharray="${pathLength}"
            stroke-dashoffset="0"
            id="examSnakeCircle"
            class="fuse-line" />
    </svg>`;

  panel.style.position = 'relative';
  panel.prepend(snake);
}

function updateSnakeTimer() {
  if (!EXAM.running || EXAM.minutes <= 0) return;

  const rect = $('#examSnakeCircle');
  const snakeWrap = $('.exam-timer-snake');
  if (!rect || !snakeWrap) return;

  const remain = Math.max(0, EXAM.deadline - Date.now());
  const total = EXAM.minutes * 60 * 1000;
  const progress = remain / total;

  const pathLength = parseFloat(rect.getAttribute('stroke-dasharray'));
  const offset = pathLength * (1 - progress);
  rect.style.strokeDashoffset = offset;

  snakeWrap.classList.toggle('warning', progress < 0.33 && progress >= 0.1);
  snakeWrap.classList.toggle('danger', progress < 0.1);
}

function renderSpeedrunSnake() {
  const panel = $('#speedrunPanel');
  if (!panel) return;

  const existing = panel.querySelector('.exam-timer-snake');
  if (existing) existing.remove();

  const snake = document.createElement('div');
  snake.className = 'exam-timer-snake speedrun-snake';

  const rect = panel.getBoundingClientRect();
  const w = rect.width + 20;
  const h = rect.height + 20;
  const padding = 10;
  const innerW = w - padding * 2;
  const innerH = h - padding * 2;
  const pathLength = 2 * (innerW + innerH);

  snake.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${w} ${h}" style="position:absolute; top:-10px; left:-10px; width:calc(100% + 20px); height:calc(100% + 20px)">
      <rect x="${padding}" y="${padding}"
            width="${innerW}" height="${innerH}"
            rx="12" ry="12"
            fill="none"
            stroke-dasharray="${pathLength}"
            stroke-dashoffset="0"
            id="speedrunSnakeCircle"
            class="fuse-line" />
    </svg>`;

  panel.style.position = 'relative';
  panel.prepend(snake);
}

function updateSpeedrunSnake() {
  if (!SPEEDRUN.running) return;

  const rect = $('#speedrunSnakeCircle');
  const snakeWrap = $('.speedrun-snake');
  if (!rect || !snakeWrap) return;

  const remain = Math.max(0, SPEEDRUN.deadline - Date.now());
  const total = SPEEDRUN.duration * 60 * 1000;
  const progress = remain / total;

  const pathLength = parseFloat(rect.getAttribute('stroke-dasharray'));
  const offset = pathLength * (1 - progress);
  rect.style.strokeDashoffset = offset;

  snakeWrap.classList.toggle('warning', progress < 0.33 && progress >= 0.1);
  snakeWrap.classList.toggle('danger', progress < 0.1);
}

function removeSpeedrunSnake() {
  const snake = $('.speedrun-snake');
  if (snake) snake.remove();
}

/** ----------------------------
 *  Speedrun
 *  ---------------------------- */
async function startSpeedrun() {
  const poolName = $('#speedrunPoolSelect')?.value;
  const pool = getPoolByName(poolName);
  if (!pool) return await showAlert('Bitte Pool wÃ¤hlen');

  const duration = SPEEDRUN.duration;

  try {
    const result = await apiSpeedrunStart(pool.id, duration);
    SPEEDRUN.sessionId = result.session_id;
    SPEEDRUN.pool = pool;
    SPEEDRUN.running = true;
    SPEEDRUN.correct = 0;
    SPEEDRUN.wrong = 0;
    SPEEDRUN.usedIds.clear();
    SPEEDRUN.startTs = Date.now();
    SPEEDRUN.deadline = SPEEDRUN.startTs + duration * 60 * 1000;

    const filterLang = await shouldFilterLang(pool.id);
    const questions = await apiGetQuestions(pool.id, filterLang ? POOL_LANG : null);
    SPEEDRUN.questions = shuffle(mapApiQuestions(questions));

    SPEEDRUN.timerId = setInterval(updateSpeedrunTimer, 300);

    $('#speedrunSetup').classList.add('hidden');
    $('#speedrunActive').classList.remove('hidden');
    $('#speedrunResult').classList.add('hidden');

    renderSpeedrunSnake();
    initSpeedrunGestures();
    nextSpeedrunQuestion();
  } catch (e) {
    console.error('Start speedrun failed:', e);
    await showAlert('Fehler beim Starten', 'Speedrun');
  }
}

function nextSpeedrunQuestion() {
  const available = SPEEDRUN.questions.filter(q => !SPEEDRUN.usedIds.has(q.id));
  if (!available.length) {
    SPEEDRUN.usedIds.clear();
    SPEEDRUN.questions = shuffle(SPEEDRUN.questions);
  }

  const q = SPEEDRUN.questions.find(q => !SPEEDRUN.usedIds.has(q.id));
  if (!q) return;

  SPEEDRUN.usedIds.add(q.id);
  SPEEDRUN.questionStart = performance.now();

  $('#speedrunStatement').textContent = q.frage;
  $('#speedrunCategory').textContent = q.kategorie || '';
  $('#speedrunScore').textContent = `âœ… ${SPEEDRUN.correct}  âŒ ${SPEEDRUN.wrong}`;

  const card = $('#speedrunCard');
  const back = $('#speedrunBack');
  if (card) {
    card.classList.remove('hidden', 'swipe-out-right', 'swipe-out-left');
    card.style.transform = '';
    card.style.opacity = '1';
  }
  if (back) back.classList.add('hidden');
}

async function submitSpeedrunAnswer(direction) {
  const lastId = [...SPEEDRUN.usedIds].pop();
  const q = SPEEDRUN.questions.find(q => q.id === lastId);
  if (!q) return;

  const chosenAnswer = findSwipeAnswer(q, direction);
  if (!chosenAnswer) return;

  const elapsed = Math.round(performance.now() - SPEEDRUN.questionStart);
  const isCorrect = chosenAnswer.korrekt;

  if (isCorrect) SPEEDRUN.correct++;
  else SPEEDRUN.wrong++;

  const card = $('#speedrunCard');
  card?.classList.add(direction === 'right' ? 'swipe-out-right' : 'swipe-out-left');

  try {
    await apiSpeedrunAnswer(SPEEDRUN.sessionId, q.id, isCorrect, elapsed);
  } catch (e) {
    console.warn('Speedrun answer submit failed:', e);
  }

  setTimeout(() => {
    const back = $('#speedrunBack');
    const resultEl = $('#speedrunBackResult');
    if (back && resultEl) {
      back.classList.remove('hidden');
      resultEl.className = `swipe-back-result ${isCorrect ? 'swipe-correct' : 'swipe-wrong'}`;
      resultEl.innerHTML = isCorrect
        ? icon('check', 'swipe-result-icon icon--ok')
        : icon('x', 'swipe-result-icon icon--bad');
    }
    card?.classList.add('hidden');

    setTimeout(() => {
      back?.classList.add('hidden');
      nextSpeedrunQuestion();
    }, 400);
  }, 300);
}

function updateSpeedrunTimer() {
  if (!SPEEDRUN.running) return;

  const remain = Math.max(0, SPEEDRUN.deadline - Date.now());
  const s = Math.floor(remain / 1000);
  const min = Math.floor(s / 60);
  const sec = s % 60;

  $('#speedrunTimer').innerHTML = `<svg class="icon icon--sm" width="16" height="16"><use href="#icon-timer"></use></svg> ${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;

  updateSpeedrunSnake();

  if (remain <= 0) finishSpeedrun();
}

async function finishSpeedrun() {
  const timeLeft = SPEEDRUN.deadline > Date.now();

  SPEEDRUN.running = false;
  if (SPEEDRUN.timerId) {
    clearInterval(SPEEDRUN.timerId);
    SPEEDRUN.timerId = null;
  }

  removeSpeedrunSnake();

  try {
    const result = await apiSpeedrunFinish(SPEEDRUN.sessionId);

    $('#speedrunActive').classList.add('hidden');
    $('#speedrunResult').classList.remove('hidden');

    const total = result.total || 0;
    const correct = result.correct || 0;
    const accuracy = result.accuracy || 0;
    const xp = result.xp || 0;

    // Speedrun-Bombe entschÃ¤rft? ğŸ’£
    const defused = timeLeft && total > 0;

    $('#speedrunResultScore').innerHTML = defused
      ? `<div style="font-size:24px; margin-bottom:8px">${icon('bomb', 'icon--lg')} Speedrun-Bombe entschÃ¤rft! ğŸ‰</div>${correct} Punkte`
      : `${correct} Punkte`;

    $('#speedrunResultStats').innerHTML = `
      ${defused ? '<div style="color:#86efac; font-weight:600; margin-bottom:8px">Geschafft bevor die Zeit ablief â€“ du bist bereit fÃ¼rs echte Leben! ğŸš€</div>' : ''}
      <div>Genauigkeit: ${accuracy}%</div>
      <div>Gesamt: ${total} Fragen</div>
      <div style="color:var(--accent)">+${xp} XP</div>
    `;

    await renderSpeedrunStats();
  } catch (e) {
    console.error('Finish speedrun failed:', e);
    await showAlert('Fehler beim AbschlieÃŸen', 'Speedrun');
  }
}

async function renderSpeedrunStats() {
  const wrap = $('#speedrunStatsWrap');
  if (!wrap) return;

  if (!currentUser) {
    wrap.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    return;
  }

  try {
    const stats = await apiSpeedrunStats();

    wrap.innerHTML = `
      <div class="grid two" style="margin-top:10px">
        <div>
          <div style="font-weight:700; font-size:18px">${stats.best_score || 0}</div>
          <div class="muted">Bestleistung</div>
        </div>
        <div>
          <div style="font-weight:700; font-size:18px">${stats.avg_accuracy || 0}%</div>
          <div class="muted">Ã˜ Genauigkeit</div>
        </div>
        <div>
          <div style="font-weight:700; font-size:18px">${stats.total_attempts || 0}</div>
          <div class="muted">Versuche</div>
        </div>
        <div>
          <div style="font-weight:700; font-size:18px">${stats.total_correct || 0}</div>
          <div class="muted">Gesamt richtig</div>
        </div>
      </div>
      <div class="hr"></div>
      <div class="muted">Pro Dauer</div>
      ${stats.per_duration?.map(d => `
        <div class="row" style="justify-content:space-between; margin-top:6px">
          <span>${d.duration_minutes} Min</span>
          <span style="font-weight:600">${d.best_score} Punkte (${d.attempts}Ã—)</span>
        </div>
      `).join('') || '<div class="muted">Noch keine Versuche</div>'}
    `;
  } catch (e) {
    wrap.innerHTML = `<div class="muted">Fehler beim Laden</div>`;
  }
}

async function renderSpeedrunLeaderboard(duration = 5) {
  const list = $('#speedrunLeaderboard');
  if (!list) return;

  try {
    const rows = await apiSpeedrunLeaderboard(duration);

    list.innerHTML = rows.length
      ? rows.map(r => `
          <li>
            <span class="rank">${r.rank}</span>
            <span class="name">${escapeHtml(r.username)}</span>
            <span class="score">${r.correct_count} (${r.accuracy}%)</span>
          </li>
        `).join('')
      : `<li class="muted">Noch keine EintrÃ¤ge</li>`;
  } catch (e) {
    list.innerHTML = `<li class="muted">Fehler beim Laden</li>`;
  }
}

$('#btnSpeedrunStart')?.addEventListener('click', startSpeedrun);
$('#btnSpeedrunFalse')?.addEventListener('click', () => submitSpeedrunAnswer('left'));
$('#btnSpeedrunTrue')?.addEventListener('click', () => submitSpeedrunAnswer('right'));
$('#btnSpeedrunRestart')?.addEventListener('click', () => {
  $('#speedrunResult').classList.add('hidden');
  $('#speedrunSetup').classList.remove('hidden');
});
$('#btnSpeedrunAbort')?.addEventListener('click', async () => {
  if(!SPEEDRUN.running) return;
  const confirmed = await showConfirm(
    t('speedrun.abortConfirm', CURRENT_LANG) || 'Speedrun wirklich abbrechen?',
    t('speedrun.title', CURRENT_LANG) || 'Speedrun'
  );
  if(!confirmed) return;
  SPEEDRUN.running = false;
  if(SPEEDRUN.timerId){ clearInterval(SPEEDRUN.timerId); SPEEDRUN.timerId = null; }
  $('#speedrunActive').classList.add('hidden');
  $('#speedrunSetup').classList.remove('hidden');
  await showAlert(t('speedrun.aborted', CURRENT_LANG) || 'Speedrun abgebrochen', t('speedrun.title', CURRENT_LANG) || 'Speedrun');
});

document.querySelectorAll('#speedrunSetup button[data-duration]').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const duration = parseInt(e.currentTarget.dataset.duration, 10);
    SPEEDRUN.duration = duration;
    document.querySelectorAll('#speedrunSetup button[data-duration]').forEach(b => b.classList.remove('primary'));
    e.currentTarget.classList.add('primary');
  });
});

document.querySelectorAll('button[data-lb-duration]').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const duration = parseInt(e.currentTarget.dataset.lbDuration, 10);
    document.querySelectorAll('button[data-lb-duration]').forEach(b => b.classList.remove('primary'));
    e.currentTarget.classList.add('primary');
    renderSpeedrunLeaderboard(duration);
  });
});

/** ----------------------------
 *  Lernkasten
 *  ---------------------------- */
function getSelectedBoxes(){
  const boxes = Array.from(LEITNER.selectedBoxes);
  return boxes.length ? boxes : [1,2,3,4,5];
}
function toggleLeitnerBox(box){
  LEITNER.selectedBoxes = new Set([box]);
  renderLeitnerStats();
  startLeitnerSession();
}
async function startLeitnerSession(){
  if(!ACTIVE_LEITNER_SET?.id){
    await showAlert(t('leitner.setMissing', CURRENT_LANG));
    return;
  }
  const useDue = ACTIVE_LEITNER_SET.mode === 'classic';
  const fetchFn = useDue ? apiLeitnerDue : apiLeitnerAll;
  const boxes = getSelectedBoxes();
  let pool = [];
  try{
    const data = await fetchFn(ACTIVE_LEITNER_SET.id, boxes);
    pool = mapApiQuestions(data);
  }catch(e){
    await showAlert('Lernkasten konnte nicht geladen werden: ' + e.message, 'Fehler');
    return;
  }
  if(!pool.length && ACTIVE_LEITNER_SET?.id){
    try{
      await apiLeitnerSeed(ACTIVE_LEITNER_SET.id, ACTIVE_LEITNER_SET.pool_id);
      const data = await fetchFn(ACTIVE_LEITNER_SET.id, boxes);
      pool = mapApiQuestions(data);
    }catch(e){
      console.warn('Lernkasten seed failed:', e);
    }
  }
  if(!pool.length){
    await showAlert(t(useDue ? 'leitner.dueEmpty' : 'leitner.poolEmpty', CURRENT_LANG));
    $('#leitnerSession').classList.add('hidden');
    return;
  }
  LEITNER.session = shuffle(pool);
  LEITNER.ptr = 0;
  $('#leitnerSession').classList.remove('hidden');
  renderLeitnerQuestion();
}
async function renderLeitnerStats(){
  if(!currentUser){
    $('#leitnerStats').innerHTML = `<div class="muted">â€“</div>`;
    return;
  }
  if(!ACTIVE_LEITNER_SET?.id){
    $('#leitnerStats').innerHTML = `<div class="muted">${t('leitner.setEmptyHint', CURRENT_LANG)}</div>`;
    return;
  }
  try{
    const data = await apiLeitnerStats(ACTIVE_LEITNER_SET.id);
    const counts = data?.counts || {1:0,2:0,3:0,4:0,5:0};
    const total = data?.total ?? Object.values(counts).reduce((a,b)=>a+b,0);
    LEITNER.boxCounts = counts;
    const selected = new Set(getSelectedBoxes());
  $('#leitnerStats').innerHTML = `
    <div class="grid" style="grid-template-columns: repeat(5, 1fr); gap:12px">
      ${[1,2,3,4,5].map(b=>`
          <div class="leitner-box ${selected.has(b) ? 'selected' : ''}" data-box="${b}" title="Box ${b}">
            <div class="muted">Box ${b}</div>
            <div style="font-size:24px; font-weight:700">${counts[b] || 0}</div>
          </div>
        `).join("")}
    </div>
      <div class="muted" style="margin-top:8px">Gesamt: ${total}</div>
    `;
  }catch(e){
    $('#leitnerStats').innerHTML = `<div class="muted">â€“</div>`;
  }
}
$('#leitnerStats')?.addEventListener('click', (e)=>{
  const box = e.target.closest('[data-box]')?.dataset?.box;
  if(!box) return;
  toggleLeitnerBox(parseInt(box, 10));
});
function renderLeitnerQuestion(){
  const q = LEITNER.session[LEITNER.ptr];
  renderQuestionInto($('#leitnerQuestionWrap'), q, 'leitner', {shuffleAnswers:true});
  const multi = (q?.antworten || []).filter(a=>a.korrekt).length > 1;
  const hintEl = $('#leitner-multi-hint');
  if(hintEl) hintEl.remove();
  if(multi){
    const wrap = $('#leitnerQuestionWrap');
    if(wrap){
      const hint = document.createElement('div');
      hint.id = 'leitner-multi-hint';
      hint.className = 'muted';
      hint.style.marginTop = '8px';
      hint.textContent = t('leitner.multiHint', CURRENT_LANG);
      wrap.appendChild(hint);
    }
  }
  LEITNER.answered = false;
  LEITNER.result = null;
  LEITNER.picks = new Set();
  const btnNext = $('#btnLeitnerNext');
  if(btnNext) btnNext.disabled = false;
}
async function nextLeitner(){
  LEITNER.ptr++;
  if(LEITNER.ptr >= LEITNER.session.length){
    $('#leitnerSession').classList.add('hidden');
    renderLeitnerStats();
  }else{
    renderLeitnerQuestion();
  }
}
$('#btnLeitnerReset').addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert(t('leaderboard.login', CURRENT_LANG));
  if(!ACTIVE_LEITNER_SET?.id) return await showAlert(t('leitner.setMissing', CURRENT_LANG));
  const confirmed = await showConfirm(t('leitner.resetConfirm', CURRENT_LANG), t('leitner.title', CURRENT_LANG));
  if(!confirmed) return;
  try{
    await apiLeitnerReset(ACTIVE_LEITNER_SET.id);
    $('#leitnerSession').classList.add('hidden');
    renderLeitnerStats();
    await showAlert(t('leitner.resetOk', CURRENT_LANG), t('leitner.title', CURRENT_LANG));
  }catch(e){
    await showAlert(t('leitner.resetErr', CURRENT_LANG) + ' ' + e.message, 'Fehler');
  }
});
$('#btnLeitnerSkip').addEventListener('click', ()=> nextLeitner());
$('#btnLeitnerNext').addEventListener('click', async ()=>{
  const q = LEITNER.session[LEITNER.ptr];
  const picks = getSelectedIds('leitner', q);
  if(!picks.size){
    await showAlert(t('leitner.needAnswer', CURRENT_LANG));
    return;
  }
  const isCorrect = isAnswerCorrect(q, picks);
  renderQuestionInto($('#leitnerQuestionWrap'), q, 'leitner', {shuffleAnswers:false, selectedIds:picks, showColors:true});
  Array.from($('#leitnerQuestionWrap').querySelectorAll('input')).forEach(i=>{ i.disabled = true; });
  try{ await apiLeitnerAnswer(q.id, isCorrect ? 'correct' : 'wrong', ACTIVE_LEITNER_SET?.id); }catch(e){ console.warn(e); }
  renderLeitnerStats();
  setTimeout(nextLeitner, 2000);
});
/** ----------------------------
 *  Editor / CRUD
 *  ---------------------------- */
let EDIT = { currentId:null };
function setEditor(q){
  EDIT.currentId = q?.id || null;
  $('#qText').value = q?.frage || "";
  $('#qCat').value = q?.kategorie || "";
  $('#qHint').value = q?.erklaerung || "";
  const cont = $('#answers');
  cont.innerHTML = "";
  (q?.antworten?.length? q.antworten : [
    {id:uid(), text:"", korrekt:false},
    {id:uid(), text:"", korrekt:false},
  ]).forEach(a=> addAnswerRow(a.text, a.korrekt, a.id));
  updateAdminUI();
}
function addAnswerRow(text="", korrekt=false, id=uid()){
  const wrap = document.createElement('div');
  wrap.className = 'item';
  wrap.innerHTML = `
    <input type="checkbox" ${korrekt?'checked':''} title="korrekt">
    <input type="text" value="${escapeHtmlAttr(text)}" placeholder="Antworttext">
    <button class="btn del">lÃ¶schen</button>
  `;
  wrap.querySelector('.del').addEventListener('click', ()=> wrap.remove());
  $('#answers').appendChild(wrap);
}
$('#btnAddAnswer').addEventListener('click', ()=>{
  if(!ensureCanEditActivePool()) return;
  addAnswerRow();
});
$('#btnNew').addEventListener('click', ()=>{
  if(!ensureCanEditActivePool()) return;
  setEditor(null);
});
$('#btnSave').addEventListener('click', async ()=>{
  if(!ensureCanEditActivePool()) return;
  const frage = $('#qText').value.trim();
  const kategorie = $('#qCat').value.trim() || undefined;
  const erk = $('#qHint').value.trim() || undefined;
  const answers = Array.from($('#answers').children).map(row=>{
    const [cb,tx] = row.querySelectorAll('input');
    return {id:uid(), text:tx.value.trim(), korrekt:cb.checked};
  }).filter(a=>a.text);
  if(!frage || answers.length<2 || !answers.some(a=>a.korrekt)){
    await showAlert("Bitte Fragetext angeben, mindestens 2 Antworten, davon mindestens 1 korrekt.");
    return;
  }
  try{
    if(EDIT.currentId){
      await apiUpdateQuestion(EDIT.currentId, toApiQuestionPayload({frage, kategorie, erklaerung: erk, antworten: answers}));
    }else{
      if(!ACTIVE_POOL) return await showAlert('Kein aktiver Pool.');
      await apiCreateQuestion(ACTIVE_POOL.id, toApiQuestionPayload({frage, kategorie, erklaerung: erk, antworten: answers}));
    }
    await setActivePool(ACTIVE_POOL.name);
    await showAlert("Gespeichert.", "Frage");
  }catch(e){
    await showAlert('Speichern fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
$('#btnDelete').addEventListener('click', async ()=>{
  if(!ensureCanEditActivePool()) return;
  if(!EDIT.currentId) return;
  const confirmed = await showConfirm('Diese Frage wirklich lÃ¶schen?', 'Frage lÃ¶schen');
  if(!confirmed) return;
  try{
    await apiDeleteQuestion(EDIT.currentId);
    await setActivePool(ACTIVE_POOL.name);
    setEditor(null);
    await showAlert('Frage wurde gelÃ¶scht.', 'Frage lÃ¶schen');
  }catch(e){
    await showAlert('LÃ¶schen fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
function renderList(){
  if(!FRAGEN.length){ $('#listWrap').textContent = "Noch keine Fragen im aktiven Pool."; return; }
  const qFilter = (LIST_FILTER || '').trim().toLowerCase();
  const rows = FRAGEN.filter(q=>{
    if(!qFilter) return true;
    const text = [q.frage, q.kategorie].filter(Boolean).join(' ').toLowerCase();
    return text.includes(qFilter);
  }).map(q=>{
    const corr = q.antworten.filter(a=>a.korrekt).length;
    return `â€¢ <span>${escapeHtml((q.kategorie||""))}${q.kategorie?" â€“ ":""}${escapeHtml(q.frage.slice(0,80))}</span> 
      <span class="pill">${corr} korrekt</span>
      <button class="btn" data-id="${escapeHtmlAttr(q.id)}">bearbeiten</button>
      <button class="btn" data-jump="${escapeHtmlAttr(q.id)}">im Training</button>`;
  });
  $('#listWrap').innerHTML = rows.length ? rows.join("<br>") : '<span class="muted">Keine Treffer.</span>';
  $('#listWrap').querySelectorAll('button[data-id]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const q = FRAGEN.find(x=>x.id===b.dataset.id);
      setEditor(q);
      $$('button.tabbtn').forEach(x=>x.classList.remove('active'));
      $('button.tabbtn[data-tab="pool"]').classList.add('active');
      $('#tab-pool').classList.add('active');
      window.scrollTo({top:0, behavior:'smooth'});
    });
  });
  $('#listWrap').querySelectorAll('button[data-jump]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const id = b.dataset.jump;
      const idx = FRAGEN.findIndex(x=>x.id===id);
      if(idx < 0) return;
      TRAIN.useWrongOnly = false;
      TRAIN.useLaterOnly = false;
      TRAIN.order = FRAGEN.map((_,i)=>i);
      TRAIN.idx = idx;
      TRAIN.checked = false;
      renderTrainQuestion();
      $$('.active').forEach(x=>x.classList.remove('active'));
      const btn = $('nav button[data-tab="train"]');
      if(btn){ btn.classList.add('active'); $('#tab-train').classList.add('active'); }
      window.scrollTo({top:0, behavior:'smooth'});
    });
  });
}
/** ----------------------------
 *  Bulk Import (in aktiven Pool)
 *  ---------------------------- */
function parseHtmlBulk(text, commonCat) {
  // Entferne Ã¼berflÃ¼ssige Whitespace und leere Zeilen
  const clean = text.trim();
  if (!clean) return [];
  // Teile nach <div>...</div> â€“ berÃ¼cksichtige auch mehrere DIVs
  const divs = [...clean.matchAll(/<div[^>]*>([\s\S]*?)<\/div>/gi)];
  if (!divs.length) return [];
  const out = [];
  for (const match of divs) {
    const block = match[1];
    // Frage extrahieren: erster <p> vor <ol>
    const qMatch = block.match(/<p[^>]*>([\s\S]*?)<ol/i);
    if (!qMatch) continue;
    let frageHtml = qMatch[1].replace(/<[^>]+>/g, '').trim(); // strip tags
    // Antworten aus <ol> extrahieren
    const olMatch = block.match(/<ol[^>]*>([\s\S]*?)<\/ol>/i);
    if (!olMatch) continue;
    const liMatches = [...olMatch[1].matchAll(/<li[^>]*>([\s\S]*?)<\/li>/gi)];
    const antworten = liMatches.map(m => m[1].replace(/<[^>]+>/g, '').trim());
    if (antworten.length < 2) continue;
    // LÃ¶sung aus <p class="answer"> extrahieren
    const ansMatch = block.match(/<p[^>]*class\s*=\s*["']?answer["']?[^>]*>([\s\S]*?)<\/p>/i);
    const correctLetters = new Set();
    if (ansMatch) {
      let ansText = ansMatch[1].replace(/<[^>]+>/g, '').trim();
      // Extrahiere Buchstaben nach "Antwort:"
      const letterMatch = ansText.match(/Antwort:\s*([A-Za-z,]+)/i);
      if (letterMatch) {
        const letters = letterMatch[1].split(',').map(l => l.trim().toUpperCase());
        for (const L of letters) {
          const idx = L.charCodeAt(0) - 'A'.charCodeAt(0);
          if (idx >= 0 && idx < antworten.length) {
            correctLetters.add(idx);
          }
        }
      }
    }
    // Erstelle Frageobjekt
    const fragenObj = {
      id: uid(),
      frage: frageHtml,
      antworten: antworten.map((text, i) => ({
        id: uid(),
        text: text,
        korrekt: correctLetters.has(i)
      })),
      kategorie: commonCat || undefined,
      leitnerBox: 1,
      stats: { asked: 0, correct: 0, streak: 0 }
    };
    out.push(fragenObj);
  }
  return out;
}
function parseBulk(text, commonCat) {
  const trimmed = text.trim();
  if (!trimmed) return [];
  // Erkennung: Wenn <div> enthalten â†’ HTML-Modus
  if (/<div/i.test(trimmed)) {
    return parseHtmlBulk(text, commonCat);
  }
  // Andernfalls: altes Freitext-Format
  const blocks = text.split(/\n-{3,}\n/);
  const out = [];
  for (const block of blocks) {
    const lines = block.split(/\n/).map(s => s.trim()).filter(Boolean);
    if (!lines.length) continue;
    const frage = lines.shift();
    const antworten = [];
    for (const line of lines) {
      let korrekt = false, t = line;
      if (/^\+ /.test(t)) { korrekt = true; t = t.replace(/^\+ /, ''); }
      else if (/^\[x\]\s*/i.test(t)) { korrekt = true; t = t.replace(/^\[x\]\s*/i, ''); }
      else if (/^\(x\)\s*/i.test(t)) { korrekt = true; t = t.replace(/^\(x\)\s*/i, ''); }
      else if (/^[âœ”âœ…]\s*/.test(t)) { korrekt = true; t = t.replace(/^[âœ”âœ…]\s*/, ''); }
      antworten.push({ id: uid(), text: t, korrekt });
    }
    if (antworten.filter(a => a.korrekt).length === 0) {
      if (antworten.length) antworten[0].korrekt = true;
    }
    out.push({
      id: uid(),
      frage,
      antworten,
      kategorie: (commonCat || undefined),
      leitnerBox: 1,
      stats: { asked: 0, correct: 0, streak: 0 }
    });
  }
  return out;
}
$('#btnParseBulk').addEventListener('click', ()=>{
  const txt = $('#bulkText').value;
  const cat = $('#bulkCat').value.trim();
  const parsed = parseBulk(txt, cat);
  if(!parsed.length){ $('#bulkPreview').textContent = "Keine BlÃ¶cke erkannt."; return; }
  const lines = parsed.map(q=>{
    const corr = q.antworten.filter(a=>a.korrekt).length;
    const wrong = q.antworten.length-corr;
    return `Q: ${q.frage}
  âœ”=${corr} âœ—=${wrong}`;
  });
  $('#bulkPreview').textContent = lines.join('\n');
});
$('#btnImportBulk').addEventListener('click', async ()=>{
  if(!await ensureCanEditActivePool()) return;
  const txt = $('#bulkText').value;
  const cat = $('#bulkCat').value.trim();
  const parsed = parseBulk(txt, cat);
  if(!parsed.length){ await showAlert("Nichts zu importieren."); return; }
  try{
    for(const q of parsed){
      await apiCreateQuestion(ACTIVE_POOL.id, toApiQuestionPayload(q));
    }
    await setActivePool(ACTIVE_POOL.name);
    await showAlert(`Importiert: ${parsed.length} Fragen in Pool "${ACTIVE_POOL.name}".`, 'Import');
  }catch(e){
    await showAlert('Import fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
/** ----------------------------
 *  Import/Export â€“ Alle Pools (Data + Admin)
 *  ---------------------------- */
async function exportAllPools(){
  try{
    const out = await apiExportAll();
    const blob = new Blob([JSON.stringify(out, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = $('#downloadLink');
    a.href = url; a.download = 'trainer_export.json'; a.textContent = 'Jetzt herunterladen';
  }catch(e){
    await showAlert('Export fehlgeschlagen: ' + e.message, 'Fehler');
  }
}
$('#btnExportAllPools').addEventListener('click', ()=> exportAllPools());
$('#btnAdminExport')?.addEventListener('click', ()=> exportAllPools());
async function importAllPoolsFromFile(inputEl){
  const f = inputEl.files[0];
  if(!f) { await showAlert("Bitte JSON-Datei auswÃ¤hlen."); return; }
  const text = await f.text();
  try{
    const obj = JSON.parse(text);
    if(typeof obj!=='object' || Array.isArray(obj)) throw new Error("Kein Objekt (nameâ†’pool).");
    const overwrite = await showConfirm('Vorhandene Pools Ã¼berschreiben?', 'Import');
    await apiImportAll(obj, overwrite);
    await loadPools();
    const idx = listPools();
    if(idx.length) await setActivePool(idx[0]);
    await showAlert("Import aller Pools abgeschlossen.", 'Import');
  }catch(e){
    await showAlert("Fehler beim Import: "+e.message, 'Fehler');
  }
}
/** ----------------------------
 *  Serverâ€‘DatensÃ¤tze (Import)
 *  ---------------------------- */
const DATASET_CATALOG = [
  { id:'fisi-1201', name:'FisiTraining_CompTia-220-1201', base:'datasets/FisiTraining_CompTia-220-1201', preimport:true, langs:['de','en','ru'] },
  { id:'fisi-1101', name:'FisiTraining_CompTia-220-1101', base:'datasets/FisiTraining_CompTia-220-1101', preimport:true, langs:['de','en','ru'] },
  { id:'swipe-computergeschichte', name:'Swipe: Computergeschichte', base:'datasets/Swipe_Computergeschichte', preimport:true, langs:['de','en','ru'] },
  { id:'examcompass-acronyms', name:'ExamCompass A+ 220-1201 Acronyms', base:'datasets/ExamCompassCompTIA_A+_220-1201_Exam-Acronyms-Quiz', preimport:false, langs:['de','en','ru'] },
  { id:'examcompass-tests', name:'ExamCompass A+ 220-1201 Practice Tests', base:'datasets/ExamCompassCompTIA-A+_220-1201_Practice_Tests-1-22_v4', preimport:false, langs:['de','en','ru'] },
  { id:'examtopics-1101', name:'ExamTopics A+ 220-1101', base:'datasets/ExamTopicsCompTIA-A+_220-1101', preimport:false, langs:['de','en','ru'] }
];
const DATASET_BY_ID = Object.fromEntries(DATASET_CATALOG.map(d=>[d.id, d]));
const DEFAULT_LANGS = ['de','en','ru'];
let defaultImportRunning = false;
const MERGE_AUDIT_STRICT = { ok: true, message: '' };
async function fetchDataset(file){
  const res = await fetch(file, {cache:'no-store'});
  if(!res.ok) throw new Error(`HTTP ${res.status} beim Laden von ${file}`);
  const ct = res.headers.get('content-type') || '';
  if(!ct.includes('application/json')) throw new Error(`Non-JSON response for ${file}`);
  return parseJsonSafe(res);
}
async function runMergeAuditStrict(){
  let hasErrors = false;
  let errName = '';
  for(const ds of DATASET_CATALOG){
    const langs = Array.isArray(ds.langs) && ds.langs.length ? ds.langs : DEFAULT_LANGS;
    for(const lang of langs){
      const obj = await loadDatasetForLang(ds, lang);
      if(!obj || !Array.isArray(obj.fragen)){
        hasErrors = true;
        errName = `${ds.name} (${lang.toUpperCase()})`;
        break;
      }
      for(const q of obj.fragen){
        const answers = Array.isArray(q.antworten) ? q.antworten : [];
        if(!answers.length){
          hasErrors = true;
          errName = `${ds.name} (${lang.toUpperCase()})`;
          break;
        }
        if(!answers.some(a => a && a.korrekt)){
          hasErrors = true;
          errName = `${ds.name} (${lang.toUpperCase()})`;
          break;
        }
      }
      if(hasErrors) break;
    }
    if(hasErrors) break;
  }
  MERGE_AUDIT_STRICT.ok = !hasErrors;
  MERGE_AUDIT_STRICT.message = hasErrors
    ? `Import blockiert: Audit fehlgeschlagen (${errName}).`
    : '';
}
function normalizeDataset(name, data){
  if(typeof data === 'string'){
    try{ data = JSON.parse(data); }catch(e){ /* ignore */ }
  }
  if(Array.isArray(data)){
    return { name, version:'v9', created: now(), fragen: convertMaybeV7Array(data) };
  }
  if(Array.isArray(data?.fragen)){
    return { name: data.name||name, version:'v9', created: data.created||now(), fragen: convertMaybeV7Array(data.fragen) };
  }
  if(data?.fragen && typeof data.fragen === 'object'){
    const vals = Array.isArray(data.fragen) ? data.fragen : Object.values(data.fragen);
    return { name: data.name||name, version:'v9', created: data.created||now(), fragen: convertMaybeV7Array(vals) };
  }
  if(Array.isArray(data?.questions)){
    return { name: data.name||name, version:'v9', created: now(), fragen: convertFromV112(data.questions) };
  }
  return null;
}
function downloadPoolCreatorPrompt(){
  const content = [
    '# Prompt: Eigener Fragenpool fÃ¼r den PrÃ¼fungstrainer (DE)',
    '',
    '**Rolle:** Du bist ein Fragenpoolâ€‘Generator fÃ¼r den â€PrÃ¼fungstrainerâ€œ.  ',
    '**Ziel:** Erstelle aus den Antworten des Users eine **gÃ¼ltige JSONâ€‘Datei**, die im PrÃ¼fungstrainer **outâ€‘ofâ€‘theâ€‘box** funktioniert.',
    '',
    '## 1) Interaktiver Kurzâ€‘Fragebogen',
    'Stelle die folgenden Fragen **nacheinander**. Warte jeweils auf die Antwort. Kurz und selbsterklÃ¤rend.',
    '',
    '1. **Thema & Zielgruppe**  ',
    '   â€Welches Thema soll der Fragenpool abdecken (z.â€¯B. Netzwerkgrundlagen, OSPF, Linuxâ€‘Basics)? FÃ¼r wen ist er gedacht (Einsteiger, Fortgeschritten, PrÃ¼fungsvorbereitung)?â€œ',
    '',
    '2. **Quellen (optional, aber empfohlen)**  ',
    '   â€Gibt es Quellen, an denen ich mich orientieren soll (Buch, Kurs, Website, RFC, Notizen)? Bitte nennen oder zusammenfassen.â€œ',
    '',
    '3. **Anzahl der Fragen**  ',
    '   â€Wie viele Fragen sollen erstellt werden? Standard sind **200**. Hinweis: Sehr groÃŸe Pools kÃ¶nnen Ladezeit und Pflege erschweren.â€œ',
    '',
    '4. **Schwierigkeitsverteilung**  ',
    '   â€Wie soll die Schwierigkeit verteilt sein (z.â€¯B. 60% leicht, 30% mittel, 10% schwer)?â€œ',
    '',
    '5. **Fragetypen**  ',
    '   â€Sollen **Singleâ€‘Choice**, **Multipleâ€‘Choice** oder gemischt vorkommen? Falls gemischt: grobe Verteilung?â€œ',
    '',
    '6. **Sprache**  ',
    '   â€Welche Sprache soll der Pool haben (DE/EN/RU)?â€œ',
    '',
    '7. **Kategorien/Unterthemen**  ',
    '   â€Gibt es gewÃ¼nschte Kategorien/Unterthemen (z.â€¯B. Routing, VLAN, OSPF)?â€œ',
    '',
    '8. **ErklÃ¤rungen**  ',
    '   â€Soll jede Frage eine ErklÃ¤rung enthalten (kurz, mittel, ausfÃ¼hrlich)?â€œ',
    '',
    '9. **Bilder (optional)**  ',
    '   â€Sollen Fragen Bilder haben? Wenn ja, nur **URLs** (z.â€¯B. https://â€¦) oder auch lokale Pfade?â€œ',
    '',
    '10. **Antwortâ€‘Stil & Eindeutigkeit**  ',
    '    â€Soll es keine Trickfragen geben und jede Frage eine eindeutig korrekte LÃ¶sung haben?â€œ',
    '',
    '11. **Praxis vs. Theorie**  ',
    '    â€Mehr Praxisâ€‘Szenarien oder eher Fakten/Definitionen?â€œ',
    '',
    '12. **Pflichtbegriffe (optional)**  ',
    '    â€Gibt es Stichworte, die unbedingt vorkommen sollen?â€œ',
    '',
    '13. **AusschlÃ¼sse (optional)**  ',
    '    â€Gibt es Themen, die nicht vorkommen sollen?â€œ',
    '',
    '14. **Sonstige Regeln**  ',
    '    â€Weitere Vorgaben? (z.â€¯B. keine Trickfragen, Fokus auf Praxis, Formulierungsstil)â€œ',
    '',
    'Wenn eine Antwort fehlt, wÃ¤hle sinnvolle Defaults (Einsteiger, gemischt, kurze ErklÃ¤rungen, keine Bilder).',
    '',
    '## 2) JSONâ€‘Format (kompatibel, minimal, stabil)',
    '**Pflichtfelder:** name, version, fragen  ',
    '**Empfohlen:** created, meta',
    '',
    '```json',
    '{',
    '  "name": "Thema â€“ Untertitel (DE)",',
    '  "version": "v9",',
    '  "created": "2026-02-07",',
    '  "meta": {',
    '    "language": "de",',
    '    "source": "optional",',
    '    "difficulty": "60/30/10"',
    '  },',
    '  "fragen": [',
    '    {',
    '      "id": "Q001",',
    '      "frage": "Fragetext ...?",',
    '      "antworten": [',
    '        { "id": "Q001-A", "text": "Antwort A", "korrekt": false },',
    '        { "id": "Q001-B", "text": "Antwort B", "korrekt": true },',
    '        { "id": "Q001-C", "text": "Antwort C", "korrekt": false }',
    '      ],',
    '      "erklaerung": "Kurz erklÃ¤ren, warum die richtige Antwort stimmt.",',
    '      "kategorie": "Kategorie/Unterthema",',
    '      "lang": "de",',
    '      "bilder": [',
    '        { "url": "https://example.com/image1.png", "alt": "optional" }',
    '      ]',
    '    }',
    '  ]',
    '}',
    '```',
    '',
    '**Regeln:**',
    '- Jede Frage braucht **mind. 2 Antworten**.  ',
    '- Es muss **mindestens eine korrekte** Antwort geben.  ',
    '- Bei Multipleâ€‘Choice kÃ¶nnen **mehrere** korrekt: true gesetzt werden.  ',
    '- lang sollte fÃ¼r den Pool einheitlich sein (DE/EN/RU).  ',
    '- kategorie, erklaerung, bilder sind optional, aber hilfreich.  ',
    '- id sollte stabil und eindeutig sein (z.â€¯B. Q001, Q002 â€¦).',
    '',
    '## 3) Ausgabeformat',
    'Gib **nur** die fertige JSONâ€‘Datei aus (keine ErklÃ¤rungen), damit sie direkt gespeichert werden kann.',
    '',
    '## 4) Beispielâ€‘Antwort (kÃ¼rzer)',
    '```json',
    '{',
    '  "name": "Netzwerkgrundlagen (DE)",',
    '  "version": "v9",',
    '  "created": "2026-02-07",',
    '  "fragen": [',
    '    {',
    '      "id": "Q001",',
    '      "frage": "Welche Aussage zu IPv4â€‘Subnetzen ist korrekt?",',
    '      "antworten": [',
    '        { "id": "Q001-A", "text": "Ein /24â€‘Netz hat 1024 Hosts.", "korrekt": false },',
    '        { "id": "Q001-B", "text": "Ein /24â€‘Netz hat 254 nutzbare Hosts.", "korrekt": true },',
    '        { "id": "Q001-C", "text": "Ein /24â€‘Netz hat 128 nutzbare Hosts.", "korrekt": false }',
    '      ],',
    '      "erklaerung": "Ein /24 hat 256 Adressen, davon sind 2 reserviert.",',
    '      "kategorie": "IP/Subnetting",',
    '      "lang": "de"',
    '    }',
    '  ]',
    '}',
    '```'
  ].join('\\n');
  const blob = new Blob([content], { type: 'text/markdown' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'POOL_CREATOR_PROMPT.md';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}
function encodeLangCategory(cat, lang){
  const base = (cat || '').trim();
  return `lang:${lang}${base ? '|' + base : ''}`;
}
function decodeLangCategory(cat){
  const raw = (cat || '').toString();
  if(raw.startsWith('lang:')){
    const parts = raw.split('|');
    const lang = parts[0].slice(5);
    const rest = parts.slice(1).join('|');
    return { lang, category: rest || '' };
  }
  return { lang: null, category: raw };
}
function shortenCategoryText(cat){
  const raw = (cat || '').toString().trim();
  if(!raw) return '';
  const byPipe = raw.split('|').map(s=>s.trim()).filter(Boolean);
  let text = byPipe.length ? byPipe[byPipe.length - 1] : raw;
  const examIdx = text.toLowerCase().indexOf('exam:');
  if(examIdx >= 0) text = text.slice(examIdx + 5).trim();
  text = text.replace(/exam answers?$/i, '').trim();
  text = text.replace(/\s{2,}/g, ' ');
  if(text.length > 80) text = text.slice(0, 77).trim() + 'â€¦';
  return text || raw;
}
function langSuffix(lang){
  if(lang==='en') return 'EN';
  if(lang==='ru') return 'RU';
  return '';
}
async function tryFetchDataset(file){
  const res = await fetch(file, {cache:'no-store'});
  if(!res.ok) return null;
  const ct = res.headers.get('content-type') || '';
  if(!ct.includes('application/json')) return null;
  return parseJsonSafe(res);
}
async function loadDatasetForLang(ds, lang){
  const suf = langSuffix(lang);
  const file = `${ds.base}${suf ? '_' + suf : ''}.json`;
  const data = await tryFetchDataset(file);
  if(!data) return null;
  const poolObj = normalizeDataset(ds.name, data);
  if(!poolObj) return null;
  for(const q of poolObj.fragen){
    if(!q.lang) q.lang = lang;
  }
  return poolObj;
}
async function buildMergedDataset(ds){
  const merged = [];
  const langs = Array.isArray(ds.langs) && ds.langs.length ? ds.langs : DEFAULT_LANGS;
  for(const lang of langs){
    const obj = await loadDatasetForLang(ds, lang);
    if(obj?.fragen?.length) merged.push(...obj.fragen);
  }
  if(!merged.length) return null;
  return { name: ds.name, version: 'v9', created: now(), fragen: merged };
}
async function appendMissingLangsToPool(ds, pool){
  if(!ds || !pool) return;
  const langs = Array.isArray(ds.langs) && ds.langs.length ? ds.langs : DEFAULT_LANGS;
  if(langs.length < 2) return;
  const existingLangs = await getPoolLangs(pool.id);
  const missing = langs.filter(l => !existingLangs.includes(l));
  if(!missing.length) return;
  for(const lang of missing){
    const obj = await loadDatasetForLang(ds, lang);
    if(!obj?.fragen?.length) continue;
    for(const q of obj.fragen){
      await apiCreateQuestion(pool.id, toApiQuestionPayload(q));
    }
  }
  await getPoolLangs(pool.id);
}
async function ensureDefaultPools(){
  if(defaultImportRunning || !accessToken) return;
  await runMergeAuditStrict();
  if(!MERGE_AUDIT_STRICT.ok){
    console.warn(MERGE_AUDIT_STRICT.message);
    return;
  }
  const notice = $('#defaultImportNotice');
  const existing = new Set(listPools());
  const missing = DATASET_CATALOG.filter(ds => !existing.has(ds.name));
  defaultImportRunning = true;
  if(notice) notice.style.display = 'block';
  try{
    for(const ds of DATASET_CATALOG){
      if(!ds.preimport) continue;
      const pool = getPoolByName(ds.name);
      if(pool) await appendMissingLangsToPool(ds, pool);
    }
    for(const ds of missing){
      const poolObj = await buildMergedDataset(ds);
      if(!poolObj) continue;
      await apiImportAll({ [ds.name]: poolObj }, false);
    }
    await loadPools();
  }catch(e){
    console.warn('Default import failed:', e);
  }finally{
    defaultImportRunning = false;
    if(notice) notice.style.display = 'none';
  }
}
async function importDatasetById(id, mode){
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const ds = DATASET_BY_ID[id];
  if(!ds) return await showAlert('Unbekannter Datensatz.');
  if(mode==='append' && !ACTIVE_POOL){ return await showAlert('Kein aktiver Pool.'); }
  if(!MERGE_AUDIT_STRICT.ok){
    return await showAlert(MERGE_AUDIT_STRICT.message || 'Import blockiert: Audit fehlgeschlagen.');
  }
  try{
    const poolObj = await buildMergedDataset(ds);
    if(!poolObj){ throw new Error('Unbekanntes Format.'); }
    if(mode==='append'){
      for(const q of poolObj.fragen){
        await apiCreateQuestion(ACTIVE_POOL.id, toApiQuestionPayload(q));
      }
      await setActivePool(ACTIVE_POOL.name);
      await showAlert(`HinzugefÃ¼gt: ${poolObj.fragen.length} Fragen zu Pool "${ACTIVE_POOL.name}".`, 'Import');
      return;
    }
    poolObj.name = ds.name;
    const existing = getPoolByName(ds.name);
    if(existing){
      if(!await showConfirm(`Pool "${ds.name}" existiert bereits. Ãœberschreiben?`, 'Import')){ return; }
      await apiDeletePool(existing.id);
      await loadPools();
    }
    const created = await apiCreatePool(ds.name);
    for(const q of poolObj.fragen){
      await apiCreateQuestion(created.id, toApiQuestionPayload(q));
    }
    await loadPools();
    await setActivePool(ds.name);
  }catch(e){
    await showAlert('Fehler beim Import: '+e.message, 'Fehler');
  }
}
function renderDatasetList(){
  const wrap = $('#datasetList');
  if(!wrap) return;
  wrap.innerHTML = '';
  for(const ds of DATASET_CATALOG){
    const row = document.createElement('div');
    row.className = 'row';
    row.style.justifyContent = 'space-between';
    row.style.alignItems = 'center';
    row.style.padding = '10px 12px';
    row.style.border = '1px dashed var(--border)';
    row.style.borderRadius = '10px';
    row.style.background = '#0b1220';
    const left = document.createElement('div');
    const title = document.createElement('div');
    title.textContent = ds.name;
    title.style.fontWeight = '600';
    const meta = document.createElement('div');
    meta.className = 'muted';
    const langs = Array.isArray(ds.langs) && ds.langs.length ? ds.langs : DEFAULT_LANGS;
    const langLabel = langs.map(l=>l.toUpperCase()).join('/');
    meta.textContent = `${ds.preimport ? 'vorimportiert' : 'optional'} Â· ${langLabel}`;
    left.appendChild(title); left.appendChild(meta);
    const right = document.createElement('div');
    right.className = 'row';
    right.style.gap = '8px';
    const btnNew = document.createElement('button');
    btnNew.className = 'btn';
    btnNew.textContent = t('data.dataset.new', CURRENT_LANG);
    btnNew.dataset.dataset = ds.id;
    btnNew.dataset.mode = 'new';
    const btnAppend = document.createElement('button');
    btnAppend.className = 'btn';
    btnAppend.textContent = t('data.dataset.append', CURRENT_LANG);
    btnAppend.dataset.dataset = ds.id;
    btnAppend.dataset.mode = 'append';
    right.appendChild(btnNew); right.appendChild(btnAppend);
    row.appendChild(left); row.appendChild(right);
    wrap.appendChild(row);
  }
  wrap.querySelectorAll('button[data-dataset]').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = e.currentTarget.dataset.dataset;
      const mode = e.currentTarget.dataset.mode;
      importDatasetById(id, mode);
    });
  });
}
function getStoredLeitnerSetId(){
  try{ return localStorage.getItem(LEITNER_SET_KEY(PROFILE_ID)) || null; }catch{ return null; }
}
function setStoredLeitnerSetId(id){
  try{
    if(id) localStorage.setItem(LEITNER_SET_KEY(PROFILE_ID), id);
    else localStorage.removeItem(LEITNER_SET_KEY(PROFILE_ID));
  }catch{}
}
function updateLeitnerSetInfo(){
  const label = $('#leitnerSetModeLabel');
  if(!label) return;
  if(!ACTIVE_LEITNER_SET){ label.textContent = 'â€“'; return; }
  const key = ACTIVE_LEITNER_SET.mode === 'classic' ? 'leitner.modeClassic' : 'leitner.modeSimple';
  const poolName = POOLS_BY_ID.get(ACTIVE_LEITNER_SET.pool_id || '')?.name;
  const modeLabel = t(key, CURRENT_LANG);
  label.textContent = poolName ? `${modeLabel} Â· ${poolName}` : modeLabel;
}
function renderLeitnerSetCards(){
  const wrap = $('#leitnerSetCards');
  const empty = $('#leitnerSetCardsEmpty');
  if(!wrap) return;
  if(!LEITNER_SETS.length){
    wrap.innerHTML = '';
    if(empty) empty.style.display = 'block';
    return;
  }
  if(empty) empty.style.display = 'none';
  wrap.innerHTML = LEITNER_SETS.map(s=>{
    const poolName = POOLS_BY_ID.get(s.pool_id || '')?.name || 'â€“';
    const modeKey = s.mode === 'classic' ? 'leitner.modeClassicShort' : 'leitner.modeSimpleShort';
    const modeLabel = t(modeKey, CURRENT_LANG);
    const selected = ACTIVE_LEITNER_SET?.id === s.id ? 'selected' : '';
    return `
      <div class="leitner-set-card ${selected}" data-leitner-set="${escapeHtmlAttr(s.id)}">
        <div style="font-weight:600">${escapeHtml(s.name || 'â€“')}</div>
        <div class="meta">${escapeHtml(poolName)} Â· ${escapeHtml(modeLabel)}</div>
      </div>
    `;
  }).join('');
  wrap.querySelectorAll('[data-leitner-set]').forEach(card=>{
    card.addEventListener('click', async (e)=>{
      const id = e.currentTarget.dataset.leitnerSet;
      if(!id) return;
      ACTIVE_LEITNER_SET = LEITNER_SETS.find(s=>s.id===id) || null;
      const sel = $('#leitnerSetSelect');
      if(sel && ACTIVE_LEITNER_SET) sel.value = ACTIVE_LEITNER_SET.id;
      setStoredLeitnerSetId(ACTIVE_LEITNER_SET?.id || null);
      updateLeitnerSetInfo();
      renderLeitnerSetCards();
      await renderLeitnerStats();
    });
  });
}
async function loadLeitnerSets(preferredId=null){
  if(!currentUser) return;
  try{
    const res = await apiLeitnerSets();
    LEITNER_SETS = Array.isArray(res) ? res : [];
  }catch{
    LEITNER_SETS = [];
  }
  const sel = $('#leitnerSetSelect');
  if(sel){
    sel.innerHTML = LEITNER_SETS.length
      ? LEITNER_SETS.map(s=>{
        const poolName = POOLS_BY_ID.get(s.pool_id || '')?.name;
        const modeKey = s.mode === 'classic' ? 'leitner.modeClassicShort' : 'leitner.modeSimpleShort';
        const modeLabel = t(modeKey, CURRENT_LANG);
        const label = poolName ? `${s.name} Â· ${poolName} Â· ${modeLabel}` : `${s.name} Â· ${modeLabel}`;
        return `<option value="${escapeHtmlAttr(s.id)}">${escapeHtml(label)}</option>`;
      }).join('')
      : `<option value="" disabled>${t('leitner.setEmpty', CURRENT_LANG)}</option>`;
  }
  const stored = preferredId || getStoredLeitnerSetId();
  const next = LEITNER_SETS.find(s=>s.id===stored) || LEITNER_SETS[0] || null;
  ACTIVE_LEITNER_SET = next;
  if(sel && next) sel.value = next.id;
  setStoredLeitnerSetId(next?.id || null);
  updateLeitnerSetInfo();
  renderLeitnerSetCards();
  if(document.querySelector('#tab-leitner.active')) renderLeitnerStats();
}
function initApiBaseUi(){
  const inputs = ['#apiBaseInput', '#apiBaseInputGate'];
  for(const sel of inputs){
    const el = $(sel);
    if(el) el.value = API_BASE;
  }
  $('#btnApiSave')?.addEventListener('click', async ()=>{
    const val = $('#apiBaseInput')?.value.trim();
    if(!val) return await showAlert('Bitte APIâ€‘URL angeben.');
    localStorage.setItem('API_BASE', val);
    location.reload();
  });
  $('#btnApiSaveGate')?.addEventListener('click', async ()=>{
    const val = $('#apiBaseInputGate')?.value.trim();
    if(!val) return await showAlert('Bitte APIâ€‘URL angeben.');
    localStorage.setItem('API_BASE', val);
    location.reload();
  });
  $('#btnApiTest')?.addEventListener('click', ()=> updateApiStatus());
  $('#btnApiTestGate')?.addEventListener('click', ()=> updateApiStatus());
}
$('#btnImportAll')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  importAllPoolsFromFile($('#fileImportAll'));
});
$('#poolListFilter')?.addEventListener('input', (e)=>{
  LIST_FILTER = e.target.value || '';
  renderList();
});
$('#poolListClear')?.addEventListener('click', ()=>{
  LIST_FILTER = '';
  const input = $('#poolListFilter');
  if(input) input.value = '';
  renderList();
});
$('#btnAdminImport')?.addEventListener('click', ()=> $('#adminImportFile').click());
$('#adminImportFile')?.addEventListener('change', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  importAllPoolsFromFile($('#adminImportFile'));
});
$('#btnWipeAll')?.addEventListener('click', async ()=>{
  if(!currentUser) return await showAlert('Bitte einloggen.');
  const idx = listPools();
  const deletable = idx.filter(name => { const p = getPoolByName(name); return p && canEditPool(p); });
  const skipped = idx.length - deletable.length;
  const msg = skipped > 0
    ? `${deletable.length} eigene Pools lÃ¶schen? (${skipped} fremde Pools werden Ã¼bersprungen.)`
    : `Wirklich ALLE ${deletable.length} Pools & Daten lÃ¶schen?`;
  if(!await showConfirm(msg, 'Alle Pools lÃ¶schen')) return;
  try{
    for(const name of deletable){
      const pool = getPoolByName(name);
      if(pool){ await apiDeletePool(pool.id); }
    }
    await loadPools();
    ACTIVE_POOL = null; FRAGEN = [];
    refreshPoolSelect();
    renderList();
    renderLeitnerStats();
    renderUserStats();
    await showAlert('Pools wurden gelÃ¶scht.', 'Alle Pools lÃ¶schen');
  }catch(e){
    await showAlert('LÃ¶schen fehlgeschlagen: ' + e.message, 'Fehler');
  }
});
/** ----------------------------
 *  Hotkeys (v1.8â€‘Style)
 *  ---------------------------- */
function activeTab(){ return $$('section.active')[0]?.id || ""; }
function keyTargetIsForm(e){
  const tag = (e.target?.tagName||"").toUpperCase();
  return tag==='INPUT' || tag==='TEXTAREA' || e.target?.isContentEditable;
}
function toggleNthCheckbox(containerSel, n){
  const boxes = Array.from(document.querySelectorAll(containerSel+' .answers input[type="checkbox"]'));
  const idx = n-1;
  if(idx>=0 && idx<boxes.length){ boxes[idx].checked = !boxes[idx].checked; boxes[idx].dispatchEvent(new Event('change', {bubbles:true})); }
}
document.addEventListener('keydown', (e)=>{
  if(keyTargetIsForm(e)) return;
  const tab = activeTab();
  const code = e.code;
  if(tab==='tab-swipe'){
    if(SWIPE.phase === 'front'){
      if(code==='ArrowLeft' || code==='KeyF'){ e.preventDefault(); submitSwipeAnswer('left'); }
      if(code==='ArrowRight' || code==='KeyR'){ e.preventDefault(); submitSwipeAnswer('right'); }
    }else if(SWIPE.phase === 'back'){
      if(code==='Space' || code==='Enter' || code==='ArrowRight'){
        e.preventDefault();
        SWIPE.idx++;
        showSwipeFront();
      }
      if(code==='KeyL'){
        e.preventDefault();
        const q = SWIPE.questions[SWIPE.idx];
        if(q) addSwipeToLeitner(q);
      }
    }
    return;
  }
  if(code.startsWith('Digit')){
    let num = parseInt(code.replace('Digit',''),10);
    if(num===0) num=10;
    if(tab==='tab-train'){ toggleNthCheckbox('#trainQuestionWrap', num); }
    if(tab==='tab-exam'){ toggleNthCheckbox('#examQuestionWrap', num); storeExamCurrent(); }
  }
  if(code==='ArrowRight' || code==='KeyN' || code===']'){
    e.preventDefault();
    if(tab==='tab-train') $('#btnTrainNext')?.click();
    if(tab==='tab-exam') $('#btnExamNext')?.click();
  }
  if(code==='ArrowLeft' || code==='KeyP' || code==='['){
    e.preventDefault();
    if(tab==='tab-train') $('#btnTrainPrev')?.click();
    if(tab==='tab-exam') $('#btnExamPrev')?.click();
  }
  if(code==='KeyC'){
    if(tab==='tab-train'){ e.preventDefault(); $('#btnTrainCheck')?.click(); }
  }
  if(code==='Enter'){
    if(tab==='tab-train'){ e.preventDefault(); $('#btnTrainNext')?.click(); }
    if(tab==='tab-exam'){ e.preventDefault(); $('#btnExamNext')?.click(); }
  }
});
/** ----------------------------
 *  Utils
 *  ---------------------------- */
function escapeHtml(s){ return (s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;" }[m])); }
function escapeHtmlAttr(s){ return escapeHtml(s).replace(/"/g, '&quot;'); }
function formatDuration(ms){ const sec = Math.max(0, Math.round(ms/1000)); const m = Math.floor(sec/60), s = sec%60; return `${m}m ${String(s).padStart(2,'0')}s`; }
function formatTimeAgo(ts){
  if(!ts) return 'â€“';
  const d = new Date(ts);
  const diff = Date.now() - d.getTime();
  if(Number.isNaN(diff)) return 'â€“';
  const mins = Math.floor(diff / 60000);
  if(mins < 1) return t('time.justNow', CURRENT_LANG);
  if(mins < 60) return t('time.minutesAgo', CURRENT_LANG).replace('{n}', String(mins));
  const hours = Math.floor(mins / 60);
  if(hours < 24) return t('time.hoursAgo', CURRENT_LANG).replace('{n}', String(hours));
  const days = Math.floor(hours / 24);
  return t('time.daysAgo', CURRENT_LANG).replace('{n}', String(days));
}
async function renderUserStats(){
  const wrap = $('#userStats');
  if(!wrap) return;
  if(!currentUser){
    wrap.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    return;
  }
  wrap.innerHTML = `<div class="muted">${t('account.statsLoading', CURRENT_LANG) || 'â€¦'}</div>`;
  try{
    const stats = await apiGetAccountStats();
    const totalAnswered = Number(stats?.total_answered || 0);
    const totalCorrect = Number(stats?.total_correct || 0);
    const totalWrong = Number(stats?.total_wrong || 0);
    const totalExams = Number(stats?.total_exam_questions || 0);
    const totalExamCorrect = Number(stats?.total_exam_correct || 0);
    const activeDays = Number(stats?.active_days || 0);
    const acc = totalAnswered ? Math.round((totalCorrect / totalAnswered) * 100) : 0;
    const examAcc = totalExams ? Math.round((totalExamCorrect / totalExams) * 100) : 0;
    const memberSince = stats?.first_activity ? formatDate(stats.first_activity) : 'â€“';
    const perPool = Array.isArray(stats?.per_pool) ? stats.per_pool : [];
    wrap.innerHTML = `
      <div class="panel" style="margin:0; padding:12px">
        <div class="muted" data-i18n="account.statsTitle">Meine Statistiken</div>
        <div class="grid two" style="margin-top:10px">
          <div>
            <div style="font-weight:700; font-size:18px">${totalAnswered}</div>
            <div class="muted" data-i18n="account.statTotalAnswered">Beantwortet</div>
          </div>
          <div>
            <div style="font-weight:700; font-size:18px">${acc}%</div>
            <div class="muted" data-i18n="account.statAccuracy">Richtig</div>
          </div>
          <div>
            <div style="font-weight:700; font-size:18px">${activeDays}</div>
            <div class="muted" data-i18n="account.statActiveDays">Aktive Tage</div>
          </div>
          <div>
            <div style="font-weight:700; font-size:18px">${totalWrong}</div>
            <div class="muted" data-i18n="account.statWrong">Falsch</div>
          </div>
        </div>
        <div class="hr"></div>
        <div class="muted" data-i18n="account.statExams">PrÃ¼fungen</div>
        <div style="font-weight:600">${totalExamCorrect}/${totalExams} <span class="muted">(${examAcc}%)</span></div>
        <div class="muted" style="margin-top:6px" data-i18n="account.statMemberSince">Dabei seit</div>
        <div style="font-weight:600">${escapeHtml(memberSince)}</div>
      </div>
      <div class="panel" style="margin:0; padding:12px">
        <div class="muted" data-i18n="account.statTopPools">Top Pools</div>
        <div class="list" style="margin-top:8px">
          ${perPool.length ? perPool.map(p=>{
            const answered = Number(p.answered || 0);
            const correct = Number(p.correct || 0);
            const pct = answered ? Math.round((correct/answered)*100) : 0;
            const lastActive = p.last_active ? formatDate(p.last_active) : 'â€“';
            return `
              <div class="item">
                <div style="font-weight:600">${escapeHtml(p.pool_name)}</div>
                <div class="meta">${answered} ${t('account.statTotalAnswered', CURRENT_LANG)} Â· ${pct}% ${t('account.statAccuracy', CURRENT_LANG)} Â· ${t('account.statLastActive', CURRENT_LANG)} ${escapeHtml(lastActive)}</div>
              </div>
            `;
          }).join('') : `<div class="muted">${t('account.statTopPoolsEmpty', CURRENT_LANG)}</div>`}
        </div>
      </div>
    `;
  }catch(e){
    wrap.innerHTML = `<div class="muted">${t('account.statLoadErr', CURRENT_LANG)}</div>`;
  }
}
function renderGamificationFallback(message){
  const xpEl = $('#xpValue');
  if(!xpEl) return;
  xpEl.textContent = 'â€“';
  $('#levelValue').textContent = 'â€“';
  $('#streakDailyValue').textContent = 'â€“';
  $('#streakWeeklyValue').textContent = 'â€“';
  $('#levelProgress').style.width = '0%';
  $('#levelHint').textContent = message || 'â€“';
  $('#lastAward').textContent = 'â€“';
  const badgeGrid = $('#badgeGrid');
  if(badgeGrid) badgeGrid.textContent = 'â€“';
}
function formatDate(val){
  if(!val) return 'â€“';
  const d = new Date(val);
  if(Number.isNaN(d.getTime())) return String(val);
  return d.toLocaleDateString();
}
async function getGamificationConfig(){
  if(GAMIFY_CONFIG) return GAMIFY_CONFIG;
  try{
    GAMIFY_CONFIG = await apiGamificationConfig();
  }catch{
    GAMIFY_CONFIG = { badges: [] };
  }
  return GAMIFY_CONFIG;
}
async function renderGamification(){
  if(!currentUser){ renderGamificationFallback(t('leaderboard.login', CURRENT_LANG)); return; }
  try{
    const [data, config] = await Promise.all([apiGamificationMe(), getGamificationConfig()]);
    const xp = Number(data?.xp || 0);
    const level = Number(data?.level || Math.floor(Math.sqrt(xp / 10)));
    const prevXp = 10 * Math.pow(level, 2);
    const nextXp = 10 * Math.pow(level + 1, 2);
    const pct = Math.min(100, Math.max(0, ((xp - prevXp) / Math.max(1, nextXp - prevXp)) * 100));
    const xpEl = $('#xpValue');
    if(xpEl){
      xpEl.textContent = String(xp.toFixed(2));
      if(LAST_XP !== null && xp !== LAST_XP){
        xpEl.classList.remove('pulse');
        void xpEl.offsetWidth;
        xpEl.classList.add('pulse');
      }
    }
    $('#levelValue').textContent = String(level);
    $('#streakDailyValue').textContent = String(data?.daily_streak ?? 0);
    $('#streakWeeklyValue').textContent = String(data?.weekly_streak ?? 0);
    $('#levelProgress').style.width = `${pct.toFixed(0)}%`;
    $('#levelHint').textContent = `${t('gamify.levelPrefix', CURRENT_LANG)} ${level} Â· ${xp}/${nextXp} XP`;
    $('#lastAward').textContent = formatDate(data?.last_awarded_at);
    LAST_XP = xp;
    const badgeGrid = $('#badgeGrid');
    if(badgeGrid){
      const earned = new Map((Array.isArray(data?.badges) ? data.badges : []).map(b => [b.key, b.earned_at]));
      const defs = Array.isArray(config?.badges) ? config.badges : [];
      badgeGrid.innerHTML = defs.length
        ? defs.map(b=>{
            const earnedAt = earned.get(b.key);
            const isEarned = !!earnedAt;
            const name = CURRENT_LANG === 'en' ? b.name_en : b.name_de;
            const desc = CURRENT_LANG === 'en' ? b.description_en : b.description_de;
            const icon = b.icon || 'ğŸ…';
            const meta = isEarned
              ? `${t('badge.earned', CURRENT_LANG)} Â· ${formatDate(earnedAt)}`
              : t('badge.locked', CURRENT_LANG);
            return `
              <div class="badge-card ${isEarned ? '' : 'locked'}">
                <div class="badge-icon">${escapeHtml(icon)}</div>
                <div>
                  <div class="badge-name">${escapeHtml(name || b.key)}</div>
                  <div class="badge-meta">${escapeHtml(desc || '')}</div>
                  <div class="badge-meta">${escapeHtml(meta)}</div>
                </div>
              </div>
            `;
          }).join('')
        : `<div class="muted">${t('badge.none', CURRENT_LANG)}</div>`;
    }
  }catch(e){
    renderGamificationFallback(t('leaderboard.error', CURRENT_LANG));
  }
}
async function renderLeaderboards(){
  const xpList = $('#leaderboardXp');
  const streakList = $('#leaderboardStreak');
  const poolList = $('#leaderboardPool');
  if(!xpList || !streakList || !poolList) return;
  if(!currentUser){
    xpList.innerHTML = `<li class="muted">${t('leaderboard.login', CURRENT_LANG)}</li>`;
    streakList.innerHTML = `<li class="muted">${t('leaderboard.login', CURRENT_LANG)}</li>`;
    poolList.innerHTML = `<li class="muted">${t('leaderboard.login', CURRENT_LANG)}</li>`;
    return;
  }
  try{
    const poolId = ACTIVE_POOL?.id || null;
    const [global, weekly, pool] = await Promise.all([
      apiLeaderboards('global', null, 10),
      apiLeaderboards('weekly', null, 10),
      poolId ? apiLeaderboards('pool', poolId, 10) : Promise.resolve({ entries: [] })
    ]);
    const render = (rows) => {
      if(!rows?.length){ return `<li class="muted">${t('leaderboard.empty', CURRENT_LANG)}</li>`; }
      return rows.map((r, i)=>{
        const name = r.display || t('leaderboard.anon', CURRENT_LANG);
        return `<li><strong>#${i+1}</strong> ${escapeHtml(name)} Â· ${escapeHtml(String(r.score))}</li>`;
      }).join('');
    };
    xpList.innerHTML = render(global?.entries);
    streakList.innerHTML = render(weekly?.entries);
    poolList.innerHTML = poolId
      ? render(pool?.entries)
      : `<li class="muted">${t('leaderboard.poolEmpty', CURRENT_LANG)}</li>`;
  }catch(e){
    xpList.innerHTML = `<li class="muted">${t('leaderboard.error', CURRENT_LANG)}</li>`;
    streakList.innerHTML = `<li class="muted">${t('leaderboard.error', CURRENT_LANG)}</li>`;
    poolList.innerHTML = `<li class="muted">${t('leaderboard.error', CURRENT_LANG)}</li>`;
  }
}
function contestStatusInfo(contest){
  const nowTs = Date.now();
  const startTs = new Date(contest?.starts_at).getTime();
  const endTs = new Date(contest?.ends_at).getTime();
  if(Number.isNaN(startTs) || Number.isNaN(endTs)){
    return { status: 'unknown', label: 'â€“', eta: null };
  }
  if(nowTs < startTs){
    return { status: 'upcoming', label: t('community.contestStatusUpcoming', CURRENT_LANG), eta: startTs - nowTs };
  }
  if(nowTs <= endTs){
    return { status: 'active', label: t('community.contestStatusActive', CURRENT_LANG), eta: endTs - nowTs };
  }
  return { status: 'ended', label: t('community.contestStatusEnded', CURRENT_LANG), eta: null };
}
async function renderContestLeaderboard(contestId){
  const list = $('#contestLeaderboard');
  if(!list) return;
  if(!currentUser){
    list.innerHTML = `<li class="muted">${t('leaderboard.login', CURRENT_LANG)}</li>`;
    return;
  }
  try{
    const data = await apiContestLeaderboard(contestId);
    const rows = Array.isArray(data?.entries) ? data.entries : [];
    list.innerHTML = rows.length
      ? rows.map((r,i)=>`<li>#${i+1} ${escapeHtml(r.display || 'â€“')} <span class="score">${Number(r.score||0).toFixed(2)}</span></li>`).join('')
      : `<li class="muted">${t('community.contestNoEntries', CURRENT_LANG)}</li>`;
  }catch{
    list.innerHTML = `<li class="muted">${t('leaderboard.error', CURRENT_LANG)}</li>`;
  }
}
async function renderContests(){
  const wrap = $('#contestList');
  const list = $('#contestLeaderboard');
  if(!wrap || !list) return;
  if(!currentUser){
    wrap.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    list.innerHTML = `<li class="muted">${t('leaderboard.login', CURRENT_LANG)}</li>`;
    return;
  }
  try{
    const contests = await apiContests();
    const items = Array.isArray(contests) ? contests : [];
    if(!items.length){
      wrap.innerHTML = `<div class="muted">${t('community.contestsEmpty', CURRENT_LANG)}</div>`;
      list.innerHTML = `<li class="muted">${t('community.contestNoEntries', CURRENT_LANG)}</li>`;
      return;
    }
    wrap.innerHTML = items.map(c=>{
      const info = contestStatusInfo(c);
      const poolLabel = c.pool_name
        ? `${t('community.contestPool', CURRENT_LANG)}: ${c.pool_name}`
        : t('community.contestGlobal', CURRENT_LANG);
      const eta = info.eta ? `Â· ${formatDuration(info.eta)}` : '';
      return `
        <div class="panel" style="margin:0; padding:12px">
          <div style="font-weight:600">${escapeHtml(c.name || 'â€“')}</div>
          <div class="muted">${escapeHtml(poolLabel)}</div>
          <div class="muted">${t('community.contestStarts', CURRENT_LANG)}: ${escapeHtml(formatDate(c.starts_at))}</div>
          <div class="muted">${t('community.contestEnds', CURRENT_LANG)}: ${escapeHtml(formatDate(c.ends_at))}</div>
          <div class="muted">${escapeHtml(info.label)} ${escapeHtml(eta)}</div>
          <div class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap">
            <button class="btn" data-contest-join="${escapeHtmlAttr(c.id)}">${t('community.contestJoin', CURRENT_LANG)}</button>
            <button class="btn" data-contest-view="${escapeHtmlAttr(c.id)}">${t('community.contestView', CURRENT_LANG)}</button>
          </div>
        </div>
      `;
    }).join('');
    wrap.querySelectorAll('button[data-contest-join]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const id = e.currentTarget.dataset.contestJoin;
        try{
          await apiContestJoin(id);
          await showAlert(t('community.contestJoined', CURRENT_LANG), t('community.contests', CURRENT_LANG));
          await renderContestLeaderboard(id);
        }catch(e2){
          await showAlert('Fehler: ' + e2.message, 'Fehler');
        }
      });
    });
    wrap.querySelectorAll('button[data-contest-view]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const id = e.currentTarget.dataset.contestView;
        await renderContestLeaderboard(id);
      });
    });
  }catch{
    wrap.innerHTML = `<div class="muted">${t('leaderboard.error', CURRENT_LANG)}</div>`;
    list.innerHTML = `<li class="muted">${t('leaderboard.error', CURRENT_LANG)}</li>`;
  }
}
function setCommunityBadge(){
  const badge = $('#communityBadge');
  if(!badge) return;
  const total = (COMMUNITY_BADGE.friends || 0) + (COMMUNITY_BADGE.duels || 0);
  if(total > 0){
    badge.textContent = String(total);
    badge.hidden = false;
  }else{
    badge.hidden = true;
  }
}
function setAccountBadge(count){
  const badge = $('#accountBadge');
  if(!badge) return;
  const total = Number(count || 0);
  if(total > 0){
    badge.textContent = String(total);
    badge.hidden = false;
  }else{
    badge.hidden = true;
  }
}
function renderFriendSelect(){
  const sel = $('#duelFriendSelect');
  if(!sel) return;
  if(!FRIENDS.length){
    sel.innerHTML = `<option value="">${t('community.duelsNoFriends', CURRENT_LANG)}</option>`;
    return;
  }
  sel.innerHTML = FRIENDS.map(f=>{
    const name = f.display_name || f.username || t('leaderboard.anon', CURRENT_LANG);
    return `<option value="${escapeHtmlAttr(f.user_id || f.id)}">${escapeHtml(name)}</option>`;
  }).join('');
}
async function renderFriends(){
  const list = $('#friendsList');
  if(!list) return;
  if(!currentUser){
    list.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    COMMUNITY_BADGE.friends = 0;
    setCommunityBadge();
    renderFriendSelect();
    return;
  }
  try{
    const [friends, pending] = await Promise.all([apiFriends(), apiFriendPending()]);
    FRIENDS = (Array.isArray(friends) ? friends : []).filter(f=>{
      const uname = String(f.username || '').toLowerCase();
      const dname = String(f.display_name || '').toLowerCase();
      if(uname.startsWith('codex') || uname.startsWith('test') || uname.startsWith('qa') || uname.startsWith('demo')) return false;
      if(dname.startsWith('codex') || dname.startsWith('test') || dname.startsWith('qa') || dname.startsWith('demo')) return false;
      return true;
    });
    FRIEND_REQUESTS = Array.isArray(pending) ? pending : [];
    COMMUNITY_BADGE.friends = 0;
    setCommunityBadge();
    renderFriendSelect();
    list.innerHTML = FRIENDS.length ? FRIENDS.map(f=>{
      const name = f.display_name || f.username || t('leaderboard.anon', CURRENT_LANG);
      const level = Number(f.level || 0);
      const last = formatTimeAgo(f.last_active_at);
      return `
        <div class="item">
          <div class="row" style="justify-content:space-between; gap:8px; align-items:center">
            <div>
              <div style="font-weight:600">${escapeHtml(name)}</div>
              <div class="meta">${t('community.friendLevel', CURRENT_LANG)} ${level} Â· ${t('community.friendLastActive', CURRENT_LANG)} ${escapeHtml(last)}</div>
            </div>
            <button class="btn" data-duel-friend="${escapeHtmlAttr(f.user_id || f.id)}">${t('community.duelsChallenge', CURRENT_LANG)}</button>
          </div>
        </div>
      `;
    }).join('') : `<div class="muted">${t('community.friendsEmpty', CURRENT_LANG)}</div>`;
    list.querySelectorAll('button[data-duel-friend]').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const id = e.currentTarget.dataset.duelFriend;
        const sel = $('#duelFriendSelect');
        if(sel){ sel.value = id; }
        switchTab('community');
      });
    });
  }catch{
    list.innerHTML = `<div class="muted">${t('community.friendLoadErr', CURRENT_LANG)}</div>`;
  }
}
function hideDuelPlay(){
  const play = $('#duelPlay');
  const result = $('#duelResult');
  if(play) play.classList.add('hidden');
  if(result) result.classList.add('hidden');
  DUEL = { id: null, data: null, questions: [], idx: 0, answers: new Map(), questionStart: 0 };
}
function updateDuelHeader(){
  const total = DUEL.questions.length || 0;
  const idx = Math.min(DUEL.idx + 1, total || 1);
  const statusEl = $('#duelStatus');
  const progress = $('#duelProgress');
  const opp = $('#duelOpponent');
  if(progress) progress.textContent = `${idx} / ${total}`;
  if(statusEl) statusEl.textContent = t(`community.duelStatus.${DUEL.data?.status || 'waiting'}`, CURRENT_LANG);
  if(opp){
    const name = DUEL.data?.opponent_name || t('community.duelsOpponentUnknown', CURRENT_LANG);
    opp.textContent = `${t('community.duelsOpponent', CURRENT_LANG)} ${name}`;
  }
}
function nextDuelIndex(state){
  for(let i = state.idx + 1; i < state.questions.length; i++){
    if(!state.answers.has(state.questions[i].id)) return i;
  }
  return -1;
}
function renderDuelQuestion(){
  const q = DUEL.questions[DUEL.idx];
  if(!q) return;
  updateDuelHeader();
  renderQuestionInto($('#duelQuestionWrap'), q, 'duel', { shuffleAnswers:false, selectedIds:new Set(), showColors:false });
  $('#duel-feedback').textContent = '';
  $('#btnDuelAnswer').disabled = false;
  $('#btnDuelNext').disabled = true;
  DUEL.questionStart = performance.now();
}
function renderDuelResult(data){
  const result = $('#duelResult');
  if(!result) return;
  const play = $('#duelPlay');
  if(play) play.classList.add('hidden');
  const me = currentUser?.id;
  const results = Array.isArray(data?.results) ? data.results : [];
  const answers = Array.isArray(data?.answers) ? data.answers : [];
  const myRes = results.find(r => r.user_id === me);
  const otherRes = results.find(r => r.user_id !== me);
  let statusLine = t('community.duelsWaiting', CURRENT_LANG);
  if(data?.status === 'finished' && myRes){
    if(myRes.is_winner === true) statusLine = t('community.duelsWin', CURRENT_LANG);
    else if(myRes.is_winner === false) statusLine = t('community.duelsLose', CURRENT_LANG);
    else statusLine = t('community.duelsDraw', CURRENT_LANG);
  }
  const byUser = new Map();
  for(const a of answers){
    if(!byUser.has(a.user_id)) byUser.set(a.user_id, new Map());
    byUser.get(a.user_id).set(a.question_id, a.is_correct);
  }
  const myMap = byUser.get(me) || new Map();
  const otherMap = byUser.get(otherRes?.user_id) || new Map();
  result.innerHTML = `
    <div class="row" style="justify-content:space-between; gap:8px; align-items:center">
      <div>
        <div style="font-weight:700">${escapeHtml(statusLine)}</div>
        <div class="muted">${escapeHtml(data?.pool_name || '')}</div>
      </div>
      <button class="btn" id="btnDuelResultClose">${t('community.duelsClose', CURRENT_LANG)}</button>
    </div>
    ${myRes ? `
      <div class="row" style="gap:16px; flex-wrap:wrap; margin-top:10px">
        <div class="tag">${t('community.duelsYou', CURRENT_LANG)}: <span class="duel-score">${myRes.correct_count || 0}</span> Â· ${formatDuration(myRes.total_time_ms || 0)}</div>
        ${otherRes ? `<div class="tag">${t('community.duelsOpponentShort', CURRENT_LANG)}: <span class="duel-score">${otherRes.correct_count || 0}</span> Â· ${formatDuration(otherRes.total_time_ms || 0)}</div>` : ''}
      </div>
    ` : ''}
    <div class="hr"></div>
    <div class="list">
      ${DUEL.questions.map(q=>{
        const myOk = myMap.get(q.id);
        const opOk = otherMap.get(q.id);
        return `
          <div class="item">
            <div style="font-weight:600">${escapeHtml(q.frage || '')}</div>
            <div class="meta">${t('community.duelsYou', CURRENT_LANG)}: ${myOk === true ? 'âœ“' : (myOk === false ? 'âœ—' : 'â€“')} Â· ${t('community.duelsOpponentShort', CURRENT_LANG)}: ${opOk === true ? 'âœ“' : (opOk === false ? 'âœ—' : 'â€“')}</div>
          </div>
        `;
      }).join('')}
    </div>
  `;
  result.querySelector('#btnDuelResultClose')?.addEventListener('click', ()=>{
    hideDuelPlay();
  });
  result.classList.remove('hidden');
}
async function startDuelSession(id){
  const play = $('#duelPlay');
  const result = $('#duelResult');
  if(!play) return;
  let data;
  try{ data = await apiDuelGet(id); }
  catch(err){ hideDuelPlay(); throw err; }
  DUEL.id = id;
  DUEL.data = data;
  DUEL.questions = (Array.isArray(data?.questions) ? data.questions : []).map(q=>({
    id: q.id,
    frage: q.text || '',
    kategorie: q.category || '',
    erklaerung: q.explanation || '',
    antworten: Array.isArray(q.answers) ? q.answers.map(a=>({ id: a.id, text: a.text || '', korrekt: false })) : [],
    bilder: Array.isArray(q.images) ? q.images : []
  }));
  DUEL.answers = new Map();
  const myAnswers = (Array.isArray(data?.answers) ? data.answers : []).filter(a => a.user_id === currentUser?.id);
  for(const a of myAnswers){
    DUEL.answers.set(a.question_id, a);
  }
  DUEL.idx = DUEL.questions.findIndex(q => !DUEL.answers.has(q.id));
  play.classList.remove('hidden');
  if(result) result.classList.add('hidden');
  if(DUEL.idx === -1){
    renderDuelResult(data);
    return;
  }
  renderDuelQuestion();
}
async function refreshDuelState(id){
  try{
    const data = await apiDuelGet(id);
    DUEL.data = data;
    if(data?.status === 'finished'){
      renderDuelResult(data);
      await renderDuels();
      return;
    }
    $('#duelQuestionWrap').innerHTML = `<div class="muted">${t('community.duelsWaiting', CURRENT_LANG)}</div>`;
    $('#btnDuelAnswer').disabled = true;
    $('#btnDuelNext').disabled = true;
    await renderDuels();
  }catch{
    $('#duelQuestionWrap').innerHTML = `<div class="muted">${t('community.duelsLoadErr', CURRENT_LANG)}</div>`;
  }
}
async function renderDuels(){
  const incomingList = $('#duelIncomingList');
  const activeList = $('#duelActiveList');
  const finishedList = $('#duelFinishedList');
  if(!incomingList || !activeList || !finishedList) return;
  if(!currentUser){
    incomingList.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    activeList.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    finishedList.innerHTML = `<div class="muted">${t('leaderboard.login', CURRENT_LANG)}</div>`;
    COMMUNITY_BADGE.duels = 0;
    setCommunityBadge();
    setAccountBadge(0);
    return;
  }
  try{
    const [waiting, active, finished, open] = await Promise.all([
      apiDuels('waiting'),
      apiDuels('active'),
      apiDuels('finished'),
      apiDuelsOpen()
    ]);
    DUELS = {
      waiting: Array.isArray(waiting) ? waiting : [],
      active: Array.isArray(active) ? active : [],
      finished: Array.isArray(finished) ? finished : [],
      open: Array.isArray(open) ? open : []
    };
    const incoming = DUELS.waiting.filter(d => d.opponent_id === currentUser?.id);
    const openIncoming = DUELS.open;
    const incomingAll = incoming.concat(openIncoming);
    COMMUNITY_BADGE.duels = incomingAll.length;
    setCommunityBadge();
    setAccountBadge(incomingAll.length);
    incomingList.innerHTML = incomingAll.length ? incomingAll.map(d=>{
      const name = d.opponent_id ? (d.opponent_name || t('leaderboard.anon', CURRENT_LANG)) : (d.challenger_name || t('leaderboard.anon', CURRENT_LANG));
      const pool = d.pool_name || 'â€“';
      return `
        <div class="item">
          <div style="font-weight:600">${escapeHtml(name)}</div>
          <div class="meta">${escapeHtml(pool)} Â· ${d.question_count || 5}</div>
          <div class="row" style="gap:8px; margin-top:6px">
            <button class="btn" data-duel-accept="${escapeHtmlAttr(d.id)}">${t('community.duelsAccept', CURRENT_LANG)}</button>
          </div>
        </div>
      `;
    }).join('') : `<div class="muted">${t('community.duelsIncomingEmpty', CURRENT_LANG)}</div>`;
    const activeCombined = DUELS.active.concat(DUELS.waiting.filter(d => d.opponent_id !== currentUser?.id));
    activeList.innerHTML = activeCombined.length ? activeCombined.map(d=>{
      const name = d.opponent_name || t('leaderboard.anon', CURRENT_LANG);
      const pool = d.pool_name || 'â€“';
      return `
        <div class="item">
          <div style="font-weight:600">${escapeHtml(pool)}</div>
          <div class="meta">${escapeHtml(name)} Â· ${t(`community.duelStatus.${d.status}`, CURRENT_LANG)}</div>
          <div class="row" style="gap:8px; margin-top:6px">
            <button class="btn" data-duel-play="${escapeHtmlAttr(d.id)}">${t('community.duelsPlay', CURRENT_LANG)}</button>
          </div>
        </div>
      `;
    }).join('') : `<div class="muted">${t('community.duelsActiveEmpty', CURRENT_LANG)}</div>`;
    const finishedTrim = DUELS.finished.slice(0, 10);
    finishedList.innerHTML = finishedTrim.length ? finishedTrim.map(d=>{
      const name = d.opponent_name || t('leaderboard.anon', CURRENT_LANG);
      const pool = d.pool_name || 'â€“';
      let result = t('community.duelsDraw', CURRENT_LANG);
      if(d.is_winner === true) result = t('community.duelsWin', CURRENT_LANG);
      if(d.is_winner === false) result = t('community.duelsLose', CURRENT_LANG);
      return `
        <div class="item">
          <div style="font-weight:600">${escapeHtml(pool)}</div>
          <div class="meta">${escapeHtml(name)} Â· ${escapeHtml(result)}</div>
          <div class="row" style="gap:8px; margin-top:6px">
            <button class="btn" data-duel-view="${escapeHtmlAttr(d.id)}">${t('community.duelsView', CURRENT_LANG)}</button>
            <button class="btn" data-duel-delete="${escapeHtmlAttr(d.id)}">${t('community.duelsDelete', CURRENT_LANG)}</button>
          </div>
        </div>
      `;
    }).join('') : `<div class="muted">${t('community.duelsFinishedEmpty', CURRENT_LANG)}</div>`;
    incomingList.querySelectorAll('button[data-duel-accept]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const b = e.currentTarget; b.disabled = true;
        try{
          await apiDuelAccept(b.dataset.duelAccept);
          await startDuelSession(b.dataset.duelAccept);
          await renderDuels();
        }catch(err){ await showAlert(t('community.duelsLoadErr', CURRENT_LANG)+' '+err.message, 'Fehler'); b.disabled = false; }
      });
    });
    activeList.querySelectorAll('button[data-duel-play]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const b = e.currentTarget; b.disabled = true;
        try{ await startDuelSession(b.dataset.duelPlay); }
        catch(err){ await showAlert(t('community.duelsLoadErr', CURRENT_LANG)+' '+err.message, 'Fehler'); b.disabled = false; }
      });
    });
    finishedList.querySelectorAll('button[data-duel-view]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const b = e.currentTarget; b.disabled = true;
        try{ await startDuelSession(b.dataset.duelView); }
        catch(err){ await showAlert(t('community.duelsLoadErr', CURRENT_LANG)+' '+err.message, 'Fehler'); b.disabled = false; }
      });
    });
    finishedList.querySelectorAll('button[data-duel-delete]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const b = e.currentTarget;
        const confirmed = await showConfirm(t('community.duelsDeleteConfirm', CURRENT_LANG), t('community.duelsTitle', CURRENT_LANG));
        if(!confirmed) return;
        b.disabled = true;
        try{
          await apiDuelDelete(b.dataset.duelDelete);
          if(DUEL.id === b.dataset.duelDelete) hideDuelPlay();
          await renderDuels();
        }catch(err){
          await showAlert(t('community.duelsLoadErr', CURRENT_LANG)+' '+err.message, 'Fehler');
          b.disabled = false;
        }
      });
    });
  }catch{
    incomingList.innerHTML = `<div class="muted">${t('community.duelsLoadErr', CURRENT_LANG)}</div>`;
    activeList.innerHTML = `<div class="muted">${t('community.duelsLoadErr', CURRENT_LANG)}</div>`;
    finishedList.innerHTML = `<div class="muted">${t('community.duelsLoadErr', CURRENT_LANG)}</div>`;
    setAccountBadge(0);
  }
}
async function renderExamSessions(){
  const wrap = $('#examSessions');
  if(!wrap) return;
  if(!currentUser){ wrap.textContent = 'â€“'; return; }
  try{
    const sessions = await apiExamSessions(20, 0);
    if(!sessions.length){ wrap.textContent = t('account.examEmpty', CURRENT_LANG); return; }
    wrap.innerHTML = sessions.map(s=>{
      const started = new Date(s.started_at).toLocaleString();
      const finished = s.finished_at ? new Date(s.finished_at).toLocaleString() : 'â€“';
      const total = s.total_questions || 0;
      const correct = s.correct_answers || 0;
      const wrong = s.wrong_answers || Math.max(0, total - correct);
      return `
        <div class="panel" style="padding:12px; margin-bottom:8px">
          <div class="row" style="justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap">
            <div>
              <div style="font-weight:600">${escapeHtml(s.pool_name || 'â€“')}</div>
              <div class="muted">${escapeHtml(started)} â†’ ${escapeHtml(finished)}</div>
              <div class="muted">${t('account.examSummary', CURRENT_LANG)} ${correct}/${total} Â· ${t('account.examWrong', CURRENT_LANG)} ${wrong}</div>
            </div>
            <div class="row" style="gap:8px; flex-wrap:wrap">
              <button class="btn" data-repeat-exam='${JSON.stringify({poolId:s.pool_id,poolName:s.pool_name,count:total,minutes:s.time_limit||30})}' title="PrÃ¼fung wiederholen">ğŸ”„</button>
              <button class="btn" data-mark-wrong="${s.id}">${t('account.examMarkWrong', CURRENT_LANG)}</button>
              <button class="btn warn" data-delete-exam="${s.id}" title="Session lÃ¶schen">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
    wrap.querySelectorAll('button[data-mark-wrong]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const id = e.currentTarget.dataset.markWrong;
        try{
          const res = await apiExamMarkWrong(id);
          await showAlert(`${t('account.examMarked', CURRENT_LANG)} ${res?.marked ?? 0}`, t('account.exam', CURRENT_LANG));
        }catch(err){
          await showAlert('Fehler: ' + err.message, 'Fehler');
        }
      });
    });
    // Repeat exam button
    wrap.querySelectorAll('button[data-repeat-exam]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const dataStr = e.currentTarget.dataset.repeatExam;
        try{
          const params = JSON.parse(dataStr);
          // Switch to exam tab
          showTab('exam');
          // Find and select the pool
          const poolSelect = $('#examPoolSelect');
          if(poolSelect){
            poolSelect.value = params.poolName;
          }
          // Set count
          const countInput = $('#examCount');
          if(countInput){
            countInput.value = params.count || 30;
          }
          // Set time limit
          const minutesInput = $('#examMinutes');
          if(minutesInput){
            minutesInput.value = params.minutes || 30;
          }
          // Start exam
          await startExam();
        }catch(err){
          await showAlert('Fehler beim Wiederholen: ' + err.message, 'Fehler');
        }
      });
    });
    // Delete exam button
    wrap.querySelectorAll('button[data-delete-exam]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const id = e.currentTarget.dataset.deleteExam;
        const confirmed = await showConfirm('Session wirklich lÃ¶schen?', 'LÃ¶schen');
        if(!confirmed) return;
        try{
          await apiExamDelete(id);
          await showAlert('Session gelÃ¶scht', 'LÃ¶schen');
          // Reload sessions
          await renderExamSessions();
        }catch(err){
          await showAlert('Fehler beim LÃ¶schen: ' + err.message, 'Fehler');
        }
      });
    });
  }catch(e){
    wrap.textContent = t('account.examError', CURRENT_LANG);
  }
}
/** ----------------------------
 *  Boot
 *  ---------------------------- */
async function boot(){
  initTheme();
  initTextScale();
  localStorage.setItem(PROFILE_KEY, PROFILE_DEFAULT);
  // Always show footer menu on load; hiding is session-only via toggle.
  localStorage.setItem(MENU_KEY, '0');
  document.body.classList.remove('menus-hidden');
  const header = document.querySelector('.headerbar');
  initApiBaseUi();
  const storedUiLang = localStorage.getItem(LANG_KEY(PROFILE_ID));
  const initialUi = ['de','en','ru'].includes(storedUiLang) ? storedUiLang : 'de';
  localStorage.setItem(LANG_KEY(PROFILE_ID), initialUi);
  applyI18n(initialUi);
  initSwipeGestures();
  const storedPoolLang = localStorage.getItem(POOL_LANG_KEY(PROFILE_ID)) || storedUiLang;
  POOL_LANG = ['de','en','ru'].includes(storedPoolLang) ? storedPoolLang : 'de';
  localStorage.setItem(POOL_LANG_KEY(PROFILE_ID), POOL_LANG);
  const langLabelGate = $('#langLabelGate');
  if(langLabelGate) langLabelGate.textContent = initialUi.toUpperCase();
  const dataTab = $('#tab-data');
  if(dataTab){ dataTab.classList.add('hidden'); }
  setGateMode('login');
  updateAdminUI();
  renderDatasetList();
  window.QALists?.init?.();
  await updateApiStatus();
  if(localStorage.getItem('autoLogin') === null){
    localStorage.setItem('autoLogin','1');
  }
  const autoLogin = localStorage.getItem('autoLogin') === '1';
  localStorage.removeItem(REFRESH_KEY);
  sessionStorage.removeItem(REFRESH_KEY);
  if(autoLogin){
    await refreshAccessToken();
  }
  await refreshMe();
  const params = new URLSearchParams(location.search);
  showProfileGate(!currentUser || params.get('start') === '1');
  if(accessToken){
    await postLoginInit();
  }
  const savedTab = localStorage.getItem(TAB_KEY(PROFILE_ID));
  const allowedTabs = Array.from(document.querySelectorAll('button.tabbtn'))
    .filter(b=>!b.classList.contains('hidden'))
    .map(b=>b.dataset.tab);
  const initialTab = (savedTab && allowedTabs.includes(savedTab)) ? savedTab : 'train';
  if(initialTab){ switchTab(initialTab); }
}

// === Loading & Toast Helpers ===

function showLoader() {
  const overlay = $('#loaderOverlay');
  if (overlay) overlay.classList.remove('hidden');
}

function hideLoader() {
  const overlay = $('#loaderOverlay');
  if (overlay) overlay.classList.add('hidden');
}

function showToast(type = 'info', title = '', message = '', duration = 4000) {
  const container = $('#toastContainer');
  if (!container) return;

  const iconMap = {
    success: icon('check', 'icon--ok'),
    error: icon('x', 'icon--bad'),
    info: icon('info', 'icon--brand')
  };

  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <div class="toast-icon">${iconMap[type] || iconMap.info}</div>
    <div class="toast-content">
      ${title ? `<div class="toast-title">${escapeHtml(title)}</div>` : ''}
      ${message ? `<div class="toast-message">${escapeHtml(message)}</div>` : ''}
    </div>
    <button class="toast-close" aria-label="SchlieÃŸen">Ã—</button>
  `;

  const closeBtn = toast.querySelector('.toast-close');
  const remove = () => {
    toast.classList.add('slideOut');
    setTimeout(() => toast.remove(), 300);
  };

  closeBtn?.addEventListener('click', remove);

  container.appendChild(toast);

  if (duration > 0) {
    setTimeout(remove, duration);
  }
}

// === Modal System ===

function showConfirm(message, title = '') {
  return new Promise((resolve) => {
    const overlay = document.createElement('div');
    overlay.className = 'modal-overlay';

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      ${title ? `<div class="modal-title">${escapeHtml(title)}</div>` : ''}
      <div class="modal-message">${escapeHtml(message)}</div>
      <div class="modal-actions">
        <button class="btn" id="modalCancel">${t('modal.cancel', CURRENT_LANG) || 'Abbrechen'}</button>
        <button class="btn primary" id="modalConfirm">${t('modal.confirm', CURRENT_LANG) || 'BestÃ¤tigen'}</button>
      </div>
    `;

    overlay.appendChild(modal);
    document.body.appendChild(overlay);

    const close = (result) => {
      overlay.style.opacity = '0';
      setTimeout(() => {
        overlay.remove();
        resolve(result);
      }, 200);
    };

    modal.querySelector('#modalConfirm')?.addEventListener('click', () => close(true));
    modal.querySelector('#modalCancel')?.addEventListener('click', () => close(false));
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) close(false);
    });

    // Focus confirm button
    setTimeout(() => modal.querySelector('#modalConfirm')?.focus(), 100);
  });
}

function showAlert(message, title = '') {
  return new Promise((resolve) => {
    const overlay = document.createElement('div');
    overlay.className = 'modal-overlay';

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      ${title ? `<div class="modal-title">${escapeHtml(title)}</div>` : ''}
      <div class="modal-message">${escapeHtml(message)}</div>
      <div class="modal-actions">
        <button class="btn primary" id="modalOk">OK</button>
      </div>
    `;

    overlay.appendChild(modal);
    document.body.appendChild(overlay);

    const close = () => {
      overlay.style.opacity = '0';
      setTimeout(() => {
        overlay.remove();
        resolve();
      }, 200);
    };

    modal.querySelector('#modalOk')?.addEventListener('click', close);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) close();
    });

    // Focus OK button
    setTimeout(() => modal.querySelector('#modalOk')?.focus(), 100);
  });
}

// === Icon Helper ===

function icon(name, className = '') {
  return `<svg class="icon ${className}" width="20" height="20"><use href="#icon-${name}"></use></svg>`;
}

boot();
</script>
</body>
</html>
